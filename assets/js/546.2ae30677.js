(window.webpackJsonp=window.webpackJsonp||[]).push([[546],{861:function(_,v,t){"use strict";t.r(v);var a=t(12),l=function(_){_.options.__data__block__={markmap_1a96284d:"- [栈与过程](#栈与过程)\n  - [x86-32 的程序栈](#x86-32-的程序栈)\n    - [压栈操作](#压栈操作)\n    - [出栈操作](#出栈操作)\n  - [x86-32 的过程调用](#x86-32-的过程调用)\n    - [基于栈的编程语言](#基于栈的编程语言)\n    - [栈帧](#栈帧)\n    - [寄存器使用惯例](#寄存器使用惯例)\n    - [递归调用](#递归调用)\n  - [x86-64 的过程调用](#x86-64-的过程调用)\n    - [x86-64 通用寄存器](#x86-64-通用寄存器)"}},s=Object(a.a)({},(function(){var _=this,v=_.$createElement,t=_._self._c||v;return t("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[t("h1",{attrs:{id:"栈与过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#栈与过程"}},[_._v("#")]),_._v(" 栈与过程")]),_._v(" "),t("Markmap",{attrs:{id:"markmap_1a96284d",code:_.$dataBlock.markmap_1a96284d}}),t("h2",{attrs:{id:"x86-32-的程序栈"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#x86-32-的程序栈"}},[_._v("#")]),_._v(" x86-32 的程序栈")]),_._v(" "),t("ul",[t("li",[_._v("符合“栈(stack)“ 工作原理的一块内存区域\n"),t("ul",[t("li",[_._v("从高地址向低地址”增长“")])])])]),_._v(" "),t("h3",{attrs:{id:"压栈操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#压栈操作"}},[_._v("#")]),_._v(" 压栈操作")]),_._v(" "),t("h3",{attrs:{id:"出栈操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#出栈操作"}},[_._v("#")]),_._v(" 出栈操作")]),_._v(" "),t("h2",{attrs:{id:"x86-32-的过程调用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#x86-32-的过程调用"}},[_._v("#")]),_._v(" x86-32 的过程调用")]),_._v(" "),t("ul",[t("li",[_._v("利用栈支持过程调用与返回")])]),_._v(" "),t("h3",{attrs:{id:"基于栈的编程语言"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基于栈的编程语言"}},[_._v("#")]),_._v(" 基于栈的编程语言")]),_._v(" "),t("ul",[t("li",[t("p",[_._v("代码可重入")]),_._v(" "),t("ul",[t("li",[_._v("同时有同一个过程的多个实例在运行")])])]),_._v(" "),t("li",[t("p",[_._v("因此需要有一块区域来存储每个过程实例的数据")]),_._v(" "),t("ul",[t("li",[_._v("参数")]),_._v(" "),t("li",[_._v("局部变量")]),_._v(" "),t("li",[_._v("返回地址")])])]),_._v(" "),t("li",[t("p",[_._v("每个过程实例的运行时间是有限的，即栈的有效时间有限")]),_._v(" "),t("ul",[t("li",[_._v("From when called to when return")])])]),_._v(" "),t("li",[t("p",[_._v("被调用者先千调用者返回（一般情况下）")])]),_._v(" "),t("li",[t("p",[_._v("每个过程实例在栈中维护一个栈帧 (stack frame)")])])]),_._v(" "),t("h3",{attrs:{id:"栈帧"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#栈帧"}},[_._v("#")]),_._v(" 栈帧")]),_._v(" "),t("ul",[t("li",[_._v("x86-32/Linux 下的栈帧")])]),_._v(" "),t("div",{staticClass:"custom-block note"},[t("p",{staticClass:"custom-block-title"},[_._v('当前栈帧的内容(自"顶"向下)')]),_._v(" "),t("ul",[t("li",[_._v("子过程参数\n"),t("ul",[t("li",[_._v('"Argument build"')])])]),_._v(" "),t("li",[_._v("局部变量\n"),t("ul",[t("li",[_._v("因为通用寄存器个数有限")])])]),_._v(" "),t("li",[_._v("被保存的寄存器的值")]),_._v(" "),t("li",[_._v("父过程的栈帧起始地址("),t("code",[_._v("old %ebp")]),_._v(")")])])]),_._v(" "),t("div",{staticClass:"custom-block note"},[t("p",{staticClass:"custom-block-title"},[_._v("父过程的栈帧中与当前过程相关的内容")]),_._v(" "),t("ul",[t("li",[_._v("返回地址\n"),t("ul",[t("li",[_._v("由 "),t("code",[_._v("call")]),_._v(" 指令存入")]),_._v(" "),t("li",[t("code",[_._v("4(%ebp)")])])])]),_._v(" "),t("li",[_._v("当前过程的输入参数\n"),t("ul",[t("li",[t("code",[_._v("8(%ebp)")]),_._v(" 对应第 1 个输入参数")]),_._v(" "),t("li",[t("code",[_._v("12(%ebp)")]),_._v(" 对应第 2 个输入参数")]),_._v(" "),t("li",[_._v("参数从右向左压")])])])])]),_._v(" "),t("ul",[t("li",[t("p",[_._v("Swap 过程")]),_._v(" "),t("ul",[t("li",[t("code",[_._v("pushl %ebx")]),_._v(" 保存寄存器，防止父过程也要调用")])])]),_._v(" "),t("li",[t("p",[t("code",[_._v("ret")]),_._v(" 要使用 "),t("code",[_._v("esp")])])])]),_._v(" "),t("h3",{attrs:{id:"寄存器使用惯例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#寄存器使用惯例"}},[_._v("#")]),_._v(" 寄存器使用惯例")]),_._v(" "),t("div",{staticClass:"custom-block note"},[t("p",{staticClass:"custom-block-title"},[_._v("寄存器的使用约定")]),_._v(" "),t("ul",[t("li",[_._v("示意图"),t("details",{staticClass:"custom-block details"},[t("summary",[_._v("点击查看")]),_._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20210903093924-2021-09-03-09-39-24.png",alt:"20210903093924-2021-09-03-09-39-24"}})])])]),_._v(" "),t("li",[_._v("两个特殊的寄存器\n"),t("ul",[t("li",[t("code",[_._v("%ebp, %esp")])])])]),_._v(" "),t("li",[_._v("三个由被调用者负责保存\n"),t("ul",[t("li",[t("code",[_._v("%ebx, %esi, %edi")])])])]),_._v(" "),t("li",[_._v("三个由调用者负责保存\n"),t("ul",[t("li",[t("code",[_._v("%eax, %edx, %ecx")])])])]),_._v(" "),t("li",[t("code",[_._v("%eax")]),_._v(" 用于保存过程返回值")])])]),_._v(" "),t("h3",{attrs:{id:"递归调用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#递归调用"}},[_._v("#")]),_._v(" 递归调用")]),_._v(" "),t("ul",[t("li",[t("p",[_._v("运算尽量用寄存器做")])]),_._v(" "),t("li",[t("p",[_._v("实例")])]),_._v(" "),t("li",[t("p",[_._v("使用栈来存储临时变量")])]),_._v(" "),t("li",[t("p",[_._v('带有指针的"阶乘"过程')]),_._v(" "),t("ul",[t("li",[_._v("由于由 "),t("code",[_._v("&")]),_._v(" 取地址，所以变量必须存储于栈中")]),_._v(" "),t("li",[_._v("加 16 byte 是考虑到x86-32 中栈 16 byte 对齐的问题")])])])]),_._v(" "),t("h2",{attrs:{id:"x86-64-的过程调用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#x86-64-的过程调用"}},[_._v("#")]),_._v(" x86-64 的过程调用")]),_._v(" "),t("h3",{attrs:{id:"x86-64-通用寄存器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#x86-64-通用寄存器"}},[_._v("#")]),_._v(" x86-64 通用寄存器")]),_._v(" "),t("ul",[t("li",[t("p",[_._v("寄存器使用惯例(软件上的约定，与硬件无关)")]),_._v(" "),t("details",{staticClass:"custom-block details"},[t("summary",[_._v("点击查看")]),_._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20210903102713-2021-09-03-10-27-13.png",alt:"20210903102713-2021-09-03-10-27-13"}})])]),_._v(" "),t("ul",[t("li",[_._v("Argument 由被调用者保存")])])]),_._v(" "),t("li",[t("p",[_._v("swap 函数示例")]),_._v(" "),t("ul",[t("li",[t("code",[_._v("volatile")])]),_._v(" "),t("li",[t("code",[_._v("%rsp")]),_._v(" 往下 "),t("code",[_._v("128")]),_._v(" 个 byte 是可以安全使用的")])])]),_._v(" "),t("li",[t("p",[t("code",[_._v("swap-3")])]),_._v(" "),t("ul",[t("li",[_._v("x86-64 加入了新的寻址方式 scount(%rip)")])])]),_._v(" "),t("li",[t("p",[_._v("swap-4")]),_._v(" "),t("ul",[t("li",[t("code",[_._v("jmp swap")]),_._v(" "),t("ul",[t("li",[t("code",[_._v("swap")]),_._v(" 调用 "),t("code",[_._v("ret")]),_._v(" 时，相当于返回的是 "),t("code",[_._v("swap_ele")]),_._v(" 这个程序的返回地址")])])])])])])],1)}),[],!1,null,null,null);"function"==typeof l&&l(s);v.default=s.exports}}]);