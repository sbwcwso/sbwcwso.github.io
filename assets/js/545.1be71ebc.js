(window.webpackJsonp=window.webpackJsonp||[]).push([[545],{860:function(t,s,a){"use strict";a.r(s);var e=a(12),r=function(t){t.options.__data__block__={markmap_1a96284d:"- [控制流](#控制流)\n  - [汇编程序员眼中的系统结构(部分)](#汇编程序员眼中的系统结构部分)\n  - [条件码](#条件码)\n  - [比较 (Compare) 指令](#比较-compare-指令)\n  - [测试 (Test) 指令](#测试-test-指令)\n  - [读取条件码 SetX 指令](#读取条件码-setx-指令)\n    - [x86-32 下读取条件码](#x86-32-下读取条件码)\n    - [x86-64 下的读取条件码](#x86-64-下的读取条件码)\n  - [跳转指令 jX](#跳转指令-jx)\n  - [条件传送指令](#条件传送指令)\n    - [条件传送指针替换跳转指令](#条件传送指针替换跳转指令)\n    - [微体系结构背景](#微体系结构背景)\n  - [循环语句 (Loops)](#循环语句-loops)\n    - [do-while 形式](#do-while-形式)\n    - [Jump-to-Middle 模式](#jump-to-middle-模式)\n    - [微体系结构背景](#微体系结构背景-1)\n  - [Switch 语句](#switch-语句)"}},n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"控制流"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#控制流"}},[t._v("#")]),t._v(" 控制流")]),t._v(" "),a("Markmap",{attrs:{id:"markmap_1a96284d",code:t.$dataBlock.markmap_1a96284d}}),a("hr"),t._v(" "),a("h2",{attrs:{id:"汇编程序员眼中的系统结构部分"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#汇编程序员眼中的系统结构部分"}},[t._v("#")]),t._v(" 汇编程序员眼中的系统结构(部分)")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("部分系统结构示意图")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Lijunjie9502/PicBed@master/20210414105348-2021-04-14-10-53-48.png",alt:"20210414105348-2021-04-14-10-53-48"}})]),t._v(" "),a("ul",[a("li",[t._v("反映了当前执行程序的信息\n"),a("ul",[a("li",[t._v("数据\n"),a("ul",[a("li",[t._v("通用寄存器\n"),a("ul",[a("li",[a("code",[t._v("%eax, %edx, %ecx, %ebx, %esi, %edi")])]),t._v(" "),a("li",[a("code",[t._v("%ebp")]),t._v(", "),a("code",[t._v("%esp")]),t._v(" 有特殊用途")])])])])]),t._v(" "),a("li",[t._v("指令地址\n"),a("ul",[a("li",[a("code",[t._v("%eip")]),t._v(" 指向下一条指令的地址")])])]),t._v(" "),a("li",[t._v("运行栈地址\n"),a("ul",[a("li",[a("code",[t._v("%esp")]),t._v(" 当前运行栈的栈顶地址")]),t._v(" "),a("li",[a("code",[t._v("%ebp")]),t._v(' 当前运行栈的 "'),a("strong",[t._v("帧(Frame)")]),t._v('" 地址')]),t._v(" "),a("li",[t._v("具体参照 "),a("RouterLink",{attrs:{to:"/pages/41e121/"}},[t._v("栈与过程")])],1)])]),t._v(" "),a("li",[t._v("条件码\n"),a("ul",[a("li",[a("code",[t._v("CF, ZF, SF, OF")])])])])])])])]),t._v(" "),a("h2",{attrs:{id:"条件码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#条件码"}},[t._v("#")]),t._v(" 条件码")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("条件码由"),a("mark",{staticClass:"c3"},[t._v("算术指令隐含设置")])]),t._v(" "),a("ul",[a("li",[t._v("如："),a("code",[t._v("addl Src,Dest")]),t._v("， "),a("code",[t._v("addq Src,Dest")])]),t._v(" "),a("li",[t._v("类似的C语言表达式: "),a("code",[t._v("t=a+b")]),t._v(" ("),a("code",[t._v("a=Src, b = Dest")]),t._v(")")])])]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("四个条件码")]),t._v(" "),a("ul",[a("li",[t._v("CF 进位标志 (Carry)\n"),a("ul",[a("li",[t._v("可用于检测无符号整数运算的溢出")])])]),t._v(" "),a("li",[t._v("SF 符号位 (Sign)\n"),a("ul",[a("li",[t._v("如果 "),a("code",[t._v("t < 0")]),t._v("， 那么 "),a("code",[t._v("SF=1")]),t._v("; 否则 "),a("code",[t._v("SF=0")])])])]),t._v(" "),a("li",[t._v("ZF (Zero Flag)\n"),a("ul",[a("li",[t._v("如果 "),a("code",[t._v("t == 0")]),t._v("，那么 "),a("code",[t._v("ZF=1")]),t._v("; 否则 "),a("code",[t._v("ZF=0")])])])]),t._v(" "),a("li",[t._v("OF 溢出标志 (Overflow)\n"),a("ul",[a("li",[t._v("如果补码运算溢出，那么 "),a("code",[t._v("OF=1")]),t._v(" "),a("ul",[a("li",[t._v("补码运算即带符号整数运算")])])]),t._v(" "),a("li",[t._v("补码溢出的判断条件\n"),a("ul",[a("li",[a("code",[t._v("(a>0 && b>0 && t<0) || (a<0 && b<0 && t>=0)")])])])])])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("以上均是针对 "),a("code",[t._v("addl/addq")]),t._v(" 指令的取值情况")])])]),t._v(" "),a("h2",{attrs:{id:"比较-compare-指令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#比较-compare-指令"}},[t._v("#")]),t._v(" 比较 (Compare) 指令")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[a("code",[t._v("cmp1 Src2 Src1")]),t._v("        "),a("code",[t._v("cmpq Src2, Src1")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("cmpl b,a")]),t._v(" 类似于计算 "),a("code",[t._v("a-b")]),t._v(" "),a("ul",[a("li",[t._v("但是不改变目的操作数")])])]),t._v(" "),a("li",[t._v("如果向最高位有借位，那么 "),a("code",[t._v("CF=1")]),t._v("; 否则 "),a("code",[t._v("CF=0")]),t._v(" "),a("ul",[a("li",[t._v("可用于无符号数的比较")])])]),t._v(" "),a("li",[t._v("如果 "),a("code",[t._v("a == b")]),t._v("，那么 "),a("code",[t._v("ZF=1")]),t._v("; 否则 "),a("code",[t._v("ZF=0")])]),t._v(" "),a("li",[t._v("如果 "),a("code",[t._v("(a - b) < 0")]),t._v("(指结果的最高位为 "),a("code",[t._v("1")]),t._v(")，那么 "),a("code",[t._v("SF=1")]),t._v("; 否则 "),a("code",[t._v("SF=0")]),t._v(" "),a("ul",[a("li",[t._v("即运算后若结果最高位为 "),a("code",[t._v("1")]),t._v("，那么 "),a("code",[t._v("SF=1")]),t._v("; 否则为 "),a("code",[t._v("0")])])])]),t._v(" "),a("li",[t._v("如果补码运算溢出，那么 "),a("code",[t._v("OF=1")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("(a>0 && b<0 && (a-b)<0) || (a<0 && b>0 && (a-b)>0)")])])])])])]),t._v(" "),a("h2",{attrs:{id:"测试-test-指令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试-test-指令"}},[t._v("#")]),t._v(" 测试 (Test) 指令")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[a("code",[t._v("testl Src2 Src1")]),t._v("       "),a("code",[t._v("testq Src2, Src1")])]),t._v(" "),a("ul",[a("li",[t._v("计算 "),a("code",[t._v("Src1 & Src2")]),t._v(" 并设置相应的条件码，但是不改变目的操作数\n"),a("ul",[a("li",[t._v("如果 "),a("code",[t._v("a&b == 0")]),t._v("，那么 "),a("code",[t._v("ZF=1")]),t._v("; 否则为 "),a("code",[t._v("0")])]),t._v(" "),a("li",[t._v("如果 "),a("code",[t._v("a&b < 0")]),t._v(" ，那么 "),a("code",[t._v("SF=1")]),t._v("; 否则为 "),a("code",[t._v("0")]),t._v(" "),a("ul",[a("li",[t._v("即运算后结果最高位为 "),a("code",[t._v("1")]),t._v("，那么"),a("code",[t._v("SF=1")]),t._v("; 否则为"),a("code",[t._v("0")])])])])])]),t._v(" "),a("li",[a("code",[t._v("test")]),t._v(" 指令会将 "),a("code",[t._v("CF")]),t._v(", "),a("code",[t._v("OF")]),t._v(" 标志位清零")])])]),t._v(" "),a("h2",{attrs:{id:"读取条件码-setx-指令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#读取条件码-setx-指令"}},[t._v("#")]),t._v(" 读取条件码 SetX 指令")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[a("code",[t._v("SetX")]),t._v(" 读取当前的条件码（或者某些条件码的组合），并存入目的字节寄存器")])]),t._v(" "),a("h3",{attrs:{id:"x86-32-下读取条件码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#x86-32-下读取条件码"}},[t._v("#")]),t._v(" x86-32 下读取条件码")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("SetX 指令的具体内容")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("SetX")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("Condition")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("Description")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("sete")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("ZF")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Equal / Zero")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("setne")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("~ZF")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Not Equal / Not Zero")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("sets")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("SF")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Negative")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("setns")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("~SF")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Nonnegative")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("setg")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("~(SF^OF) & ~ZF")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Greater(Signed)")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("setge")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("~(SF^OF)")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Greater or Equal(Signed)")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("setl")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("(SF^OF)")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Less (Signed)")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("setle")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("(SF^OF) | ZF")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Less or Equal(Signed)")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("seta")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("~CF&~ZF")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Above (unsigned)")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("setb")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("CF")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Below (unsigned)")])])])])]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[a("code",[t._v("SetX")]),t._v(" 指令的操作")]),t._v(" "),a("ul",[a("li",[t._v("读取当前的条件码（或者某些条件码的组合)，并存入目的"),a("strong",[t._v("字节")]),t._v("寄存器\n"),a("ul",[a("li",[t._v("余下的三个字节不会修改\n"),a("ul",[a("li",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Lijunjie9502/PicBed@master/20210414121449-2021-04-14-12-14-49.png",alt:"20210414121449-2021-04-14-12-14-49"}})])])]),t._v(" "),a("li",[t._v("通常会使用 "),a("code",[t._v("movzbl")]),t._v(" 指令对目的寄存器进行 "),a("code",[t._v("0")]),t._v(" 扩展")])])])]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("示例")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("C 代码")]),t._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("gt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" y"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" x "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" y"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])])]),t._v(" "),a("li",[a("p",[t._v("汇编码")]),t._v(" "),a("div",{staticClass:"language-nasm line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nasm"}},[a("code",[t._v("movl  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v("("),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("ebp")]),t._v("), "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("eax")]),t._v("  # "),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("eax")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" y\ncmpl  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("eax")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v("("),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("ebp")]),t._v(")   # Compare y, x, calculate x "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" y\nsetg  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("al")]),t._v("             # "),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("al")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" x "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" y\nmovzbl  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("al")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("eax")]),t._v("     # Zero rest of "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("eax")]),t._v(", return "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("eax")]),t._v(" after\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])])])])])]),t._v(" "),a("h3",{attrs:{id:"x86-64-下的读取条件码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#x86-64-下的读取条件码"}},[t._v("#")]),t._v(" x86-64 下的读取条件码")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("SetX 指令的操作")]),t._v(" "),a("ul",[a("li",[t._v("读取当前的条件码（或者某些条件码的组合)，并存入目的"),a("strong",[t._v("字节")]),t._v("寄存器")]),t._v(" "),a("li",[t._v("寄存器中的余下 7 个字节不会被更改")])])]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("示例")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("C 代码")]),t._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("lgt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" y"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" x "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" y"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])])]),t._v(" "),a("li",[a("p",[t._v("汇编码")]),t._v(" "),a("div",{staticClass:"language-nasm line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nasm"}},[a("code",[t._v("xorl  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("eax")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("eax")]),t._v("  # "),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("eax")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\ncmpq  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("rsi")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("rdi")]),t._v("  # Compare x:y\nsetg  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("al")]),t._v("         # "),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("al")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" x "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" y\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("ul",[a("li",[t._v("可以看出汇编码中只对 "),a("code",[t._v("%eax")]),t._v(" 进行了处理(将其各位置 0)， 即 "),a("code",[t._v("%rax")]),t._v(" 的高 32 位\n"),a("ul",[a("li",[t._v("逻辑上应该对整个 "),a("code",[t._v("%rax")]),t._v(" 进行置 0 处理")]),t._v(" "),a("li",[t._v("这是因为 Intel®64 and IA-32 Architectures Software Developer's Manual 中规定如果 32 位的运算产生了 32 位的结果，则自动的在目标通用寄存器的高 32 位进行零扩展\n"),a("ul",[a("li",[t._v("部分原因是为了避免 "),a("a",{attrs:{href:"https://stackoverflow.com/a/41574531/11152760",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("Partial register stalls")]),a("OutboundLink")],1)])])]),t._v(" "),a("li",[a("blockquote",[a("p",[a("RouterLink",{attrs:{to:"/pages/135dcb/#x86-64-的通用寄存器"}},[t._v("x86-64 的通用寄存器")])],1)])])])])])])]),t._v(" "),a("h2",{attrs:{id:"跳转指令-jx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跳转指令-jx"}},[t._v("#")]),t._v(" 跳转指令 jX")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[a("code",[t._v("jX")]),t._v(" 依赖当前的条件码选择下一条执行语句")]),t._v(" "),a("ul",[a("li",[t._v("决定是否顺序执行")])])]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[a("code",[t._v("jX")]),t._v(" 指令的具体内容")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("jX")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("Condition")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("Description")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("je")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("ZF")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Equal / Zero")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("jne")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("~ZF")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Not Equal / Not Zero")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("js")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("SF")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Negative")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("jns")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("~SF")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Nonnegative")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("jg")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("~(SF^OF) & ~ZF")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Greater(Signed)")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("jge")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("~(SF^OF)")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Greater or Equal(Signed)")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("jl")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("(SF^OF)")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Less (Signed)")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("jle")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("(SF^OF) $|$ZF")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Less or Equal(Signed)")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("ja")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("~CF&~ZF")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Above (unsigned)")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("jb")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("CF")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Below (unsigned)")])])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("与 "),a("code",[t._v("setX")]),t._v(" 指令类似")])])]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("跳转指令的实例 "),a("code",[t._v("absdiff")])]),t._v(" "),a("ul",[a("li",[a("p",[t._v("C 代码")]),t._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("absdiff")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" y"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" y"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    result "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" x "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" y"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n    result "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" y "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])])]),t._v(" "),a("li",[a("p",[t._v("将原始的 C 代码变形为 "),a("code",[t._v("goto")]),t._v(" 模式，则其更接近于编译出来的机器语言风格")]),t._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("goto_absdiff")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" y"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" y"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("goto")]),t._v(" Else"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  result "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" x "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" y"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nEXIT"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nElse"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n  result "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" y "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("goto")]),t._v(" Exit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])])]),t._v(" "),a("li",[a("p",[t._v("汇编代码")]),t._v(" "),a("div",{staticClass:"language-nasm line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nasm"}},[a("code",[a("span",{pre:!0,attrs:{class:"token label function"}},[t._v("absdiff:")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("; Setup")]),t._v("\n  pushl   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("ebp")]),t._v("\n  movl    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("esp")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("ebp")]),t._v("\n  movl  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("("),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("ebp")]),t._v("), "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("edx")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("; edx = x")]),t._v("\n  movl  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("("),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("ebp")]),t._v("), "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("eax")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("; eax = y")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(";Body1")]),t._v("\n  cmpl  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("eax")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("edx")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("; calculate edx - eax(x - y)")]),t._v("\n  jle   .L7             "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("; <= Goto Else")]),t._v("\n  subl  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("eax")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("edx")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("; edx = edx - eax (x -= y)")]),t._v("\n  movl  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("edx")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("eax")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("; eax = edx (result = x)")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(";Finish")]),t._v("\n.L8                     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("; Exit:")]),t._v("\n  leave\n  ret\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(";Body 2")]),t._v("\n.L7                     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("; Else: ")]),t._v("\n  subl "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("edx")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("eax")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("; eax = eax - edx (result = y = y - x)")]),t._v("\n  jmp  .L8              "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("; Goto Exit")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br")])])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("ul",[a("li",[t._v("gcc-4.8 只有加上 "),a("code",[t._v("-march=i386")]),t._v(" 可以得到类似的汇编代码，不然出来的是条件传送指令 "),a("code",[t._v("cmovC")])]),t._v(" "),a("li",[a("code",[t._v("absdiff")]),t._v(" 与 C 语言的条件表达式表示\n"),a("ul",[a("li",[a("code",[t._v("val = x > y ? x - y : y - x")])])])])])])]),t._v(" "),a("h2",{attrs:{id:"条件传送指令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#条件传送指令"}},[t._v("#")]),t._v(" 条件传送指令")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[a("code",[t._v("cmovC src, dest")])]),t._v(" "),a("ul",[a("li",[t._v("如果条件 C 成立，将数据从 "),a("code",[t._v("src")]),t._v(" 传送至 "),a("code",[t._v("dest")])])])]),t._v(" "),a("h3",{attrs:{id:"条件传送指针替换跳转指令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#条件传送指针替换跳转指令"}},[t._v("#")]),t._v(" 条件传送指针替换跳转指令")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("条件传送指令可以替换 "),a("code",[t._v("absdiff")]),t._v(" 中的跳转指令")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("c 代码")]),t._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("absdiff")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" y"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" y"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    result "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" x "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" y"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n    result "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" y "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])])]),t._v(" "),a("li",[a("p",[t._v("x86-64 下对于 "),a("code",[t._v("absdiff")]),t._v(" 来说，会用条件传送指令来替换条件跳转指令")]),t._v(" "),a("div",{staticClass:"language-nasm line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nasm"}},[a("code",[a("span",{pre:!0,attrs:{class:"token label function"}},[t._v("absdiff:")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("; x in %edi, y in %esi, result in %eax")]),t._v("\n  movl    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("edi")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("eax")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("; eax = x")]),t._v("\n  movl    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("esi")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("edx")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("; edx = y")]),t._v("\n  subl    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("esi")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("eax")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("; eax -= esi (eax = x - y)")]),t._v("\n  subl    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("edi")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("edx")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("; edx -= edi (edx = y - x)")]),t._v("\n  cmpl    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("esi")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("edi")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("; x - y")]),t._v("\n  cmovle  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("edx")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("eax")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("; if x <= y then eax = dex = y - x")]),t._v("\n  ret\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("ul",[a("li",[t._v("%eax 为最终的返回值")])])]),t._v(" "),a("li",[a("p",[t._v("x86-32 下，如果加上 "),a("code",[t._v("-march=i686")]),t._v(" 选项，也可编译出采用条件传送指令的汇编代码")]),t._v(" "),a("div",{staticClass:"language-nasm line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nasm"}},[a("code",[a("span",{pre:!0,attrs:{class:"token label function"}},[t._v("absdiff:")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(";result = %eax")]),t._v("\n  movl  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v("("),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("ebp")]),t._v("), "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("ecx")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("; ecx = x ")]),t._v("\n  movl  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v("("),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("ebp")]),t._v("), "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("edx")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("; edx = y")]),t._v("\n  movl  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("ecx")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("ebx")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("; ebx = ecx = x")]),t._v("\n  subl  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("edx")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("ebx")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("; ebx = ebx - edx = x - y")]),t._v("\n  movl  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("edx")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("eax")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("; eax = edx = y")]),t._v("\n  subl  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("ecx")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("eax")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("; eax = eax - ecx = y - x")]),t._v("\n  cmpl  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("edx")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("ecx")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("; ecx - edx = x - y")]),t._v("\n  comvg "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("ebx")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("eax")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("; eax = ebx = x - y if x > y")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("从执行的角度看，条件移动指令比一般的条件跳转指令的效率高")]),t._v(" "),a("ul",[a("li",[t._v("从"),a("a",{attrs:{href:"#%E5%BE%AE%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E8%83%8C%E6%99%AF"}},[t._v("微体系结构背景进行解释")])]),t._v(" "),a("li",[t._v("因为其控制流可预测，不会出现跳转执行的情况")])])])]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("局限性")]),t._v(" "),a("ul",[a("li",[t._v('两个分支有 "副作用"\n'),a("ul",[a("li",[t._v("不能分别对两个分支进行计算")])])]),t._v(" "),a("li",[t._v("表达式的计算量比较大\n"),a("ul",[a("li",[t._v("同时计算两个分支的开销可能大于采用跳转指令的开销")])])])])]),t._v(" "),a("h3",{attrs:{id:"微体系结构背景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#微体系结构背景"}},[t._v("#")]),t._v(" 微体系结构背景")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("同时运行五条指令")]),t._v(" "),a("ul",[a("li",[t._v("相当于工厂流水线")])])]),t._v(" "),a("li",[a("p",[t._v("一般不会超过 20 段")]),t._v(" "),a("ul",[a("li",[t._v("条件跳转指令会影响流水线")]),t._v(" "),a("li",[t._v("会出现性能损失，需要尽可能的消除")])])]),t._v(" "),a("li",[a("p",[t._v("一个指令一条流水")])])]),t._v(" "),a("h2",{attrs:{id:"循环语句-loops"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#循环语句-loops"}},[t._v("#")]),t._v(" 循环语句 (Loops)")]),t._v(" "),a("ul",[a("li",[t._v("所有的循环模式 "),a("code",[t._v("(while, do-while, for)")]),t._v(" 都转换为 "),a("code",[t._v("do-while")]),t._v(" 形式")]),t._v(" "),a("li",[t._v('历史上gee采用过多种转换模式，经历了 "否定之否定" 的过程')])]),t._v(" "),a("h3",{attrs:{id:"do-while-形式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#do-while-形式"}},[t._v("#")]),t._v(" do-while 形式")]),t._v(" "),a("h3",{attrs:{id:"jump-to-middle-模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jump-to-middle-模式"}},[t._v("#")]),t._v(" Jump-to-Middle 模式")]),t._v(" "),a("h3",{attrs:{id:"微体系结构背景-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#微体系结构背景-2"}},[t._v("#")]),t._v(" 微体系结构背景")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("通过猜测来看是否跳转，根据历史信息来判断是否需要跳转")])]),t._v(" "),a("li",[a("p",[t._v("Jump-to-middle 减少条件跳转指令")])]),t._v(" "),a("li",[a("p",[t._v("经过发展， Branch Prediction 能够对 loop 进行专门的预测")])])]),t._v(" "),a("h2",{attrs:{id:"switch-语句"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#switch-语句"}},[t._v("#")]),t._v(" Switch 语句")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("跳转表 Jump Table")]),t._v(" "),a("ul",[a("li",[t._v("表结构")]),t._v(" "),a("li",[t._v("表项内容")])])]),t._v(" "),a("li",[a("p",[t._v("指令段")])]),t._v(" "),a("li",[a("p",[t._v("case 值很稀疏")]),t._v(" "),a("ul",[a("li",[t._v("转换为 "),a("code",[t._v("if-then-else")]),t._v(" 语句")]),t._v(" "),a("li",[t._v("以平衡二叉树的结构组织\n"),a("ul",[a("li",[t._v("使得判断次数最少")])])])])])])],1)}),[],!1,null,null,null);"function"==typeof r&&r(n);s.default=n.exports}}]);