(window.webpackJsonp=window.webpackJsonp||[]).push([[263],{812:function(t,s,a){"use strict";a.r(s);var c=a(12),e=function(t){t.options.__data__block__={markmap_382ee168:"- [复用和分用](#复用和分用)\n  - [分用的工作原理](#分用的工作原理)\n    - [无连接的分用](#无连接的分用)\n    - [面向连接的分用](#面向连接的分用)"}},l=Object(c.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"复用和分用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#复用和分用"}},[t._v("#")]),t._v(" 复用和分用")]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("为什么要进行多路复用/分用")]),t._v(" "),a("p",[t._v("如果某层的一个协议对应直接上层的多个协议/实体，则需要复用/分用")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("接收端进行多路分用")]),t._v(" "),a("p",[t._v("传输层依据头部信息将收到的 Segment 交给正确的 Socket，即不同的进程")]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("示意图")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20210830090133-2021-08-30-09-01-33.png",alt:"20210830090133-2021-08-30-09-01-33"}})])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("发送端进行多路复用")]),t._v(" "),a("p",[t._v("从多个 Socket 接收数据，为每块数据封装上头部信息，生成 Segment，交给网络层")])]),t._v(" "),a("Markmap",{attrs:{id:"markmap_382ee168",code:t.$dataBlock.markmap_382ee168}}),a("h2",{attrs:{id:"分用的工作原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分用的工作原理"}},[t._v("#")]),t._v(" 分用的工作原理")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("主机接收到IP数据报(datagram)")]),t._v(" "),a("ul",[a("li",[t._v("每个数据报携带源IP地址、目的IP地址")]),t._v(" "),a("li",[t._v("每个数据报携带一个传输层的段(Segment)")]),t._v(" "),a("li",[t._v("每个段携带源端口号和目的端口号")])]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("TCP/UDP 段格式")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20210830090427-2021-08-30-09-04-27.png",alt:"20210830090427-2021-08-30-09-04-27"}})])])]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("分用的工作原理")]),t._v(" "),a("ul",[a("li",[t._v("主机收到 Segment 之后，传输层协议提取 IP 地址和端口号信息，将 Segment 导向相应的 Socket\n"),a("ul",[a("li",[t._v("TCP做更多处理")])])])])]),t._v(" "),a("h3",{attrs:{id:"无连接的分用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#无连接的分用"}},[t._v("#")]),t._v(" 无连接的分用")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("利用端口号创建Socket")]),t._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[t._v("DatagramSocket mySocket1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" new "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("DatagramSocket")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("99111")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nDatagramSocket mySocket2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" new "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("DatagramSocket")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("99222")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])])]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("UDP 的 Socket 用二元组标识")]),t._v(" "),a("ul",[a("li",[t._v("(目的IP地址，目的端口号)")])])]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("主机收到UDP段后")]),t._v(" "),a("ul",[a("li",[t._v("检查段中的目的端口号")]),t._v(" "),a("li",[t._v("将UDP段导向绑定在该端口号的 Socket")])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("来自不同源 IP 地址和/或源端口号的 IP 数据包被导向同一个 Socket")]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("示例")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20210830090817-2021-08-30-09-08-17.png",alt:"20210830090817-2021-08-30-09-08-17"}})])])]),t._v(" "),a("h3",{attrs:{id:"面向连接的分用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#面向连接的分用"}},[t._v("#")]),t._v(" 面向连接的分用")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("TCP 的 Socket 用四元组标识")]),t._v(" "),a("ul",[a("li",[t._v("源IP地址")]),t._v(" "),a("li",[t._v("源端口号")]),t._v(" "),a("li",[t._v("目的 IP 地址")]),t._v(" "),a("li",[t._v("目的端口号")])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("接收端利用所有的四个值将 Segment 导向合适的 Socket")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("服务器可能同时支持多个 TCP Socket")]),t._v(" "),a("ul",[a("li",[t._v("每个 Socket 用自己的四元组标识")])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("Web 服务器为每个客户端开不同的 Socket")])]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("面向连接的分用示例")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20210830091325-2021-08-30-09-13-25.png",alt:"20210830091325-2021-08-30-09-13-25"}})])]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("多线程 Web 服务器示例")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20210830091351-2021-08-30-09-13-51.png",alt:"20210830091351-2021-08-30-09-13-51"}})]),t._v(" "),a("ul",[a("li",[t._v("一个进程创建多个线程，通过多个线程来进行 TCP 连接")])])])],1)}),[],!1,null,null,null);"function"==typeof e&&e(l);s.default=l.exports}}]);