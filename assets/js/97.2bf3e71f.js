(window.webpackJsonp=window.webpackJsonp||[]).push([[97],{708:function(t,s,a){"use strict";a.r(s);var e=a(12),r=function(t){t.options.__data__block__={markmap_1a96284d:"- [第 3 章 程序的机器级表示](#第-3-章-程序的机器级表示)\n  - [3.1 历史回顾](#31-历史回顾)\n  - [3.2 程序编码](#32-程序编码)\n    - [3.2.1 机器级代码](#321-机器级代码)\n    - [3.2.2 代码示例](#322-代码示例)\n    - [3.2.3 关于格式的注解](#323-关于格式的注解)\n  - [3.3 数据格式](#33-数据格式)\n  - [3.4 访问信息](#34-访问信息)\n    - [3.4.1 操作数指标符](#341-操作数指标符)\n    - [3.4.2 数据传送指令](#342-数据传送指令)\n    - [3.4.3 数据传送示例](#343-数据传送示例)\n    - [3.4.4 压入和弹出栈数据](#344-压入和弹出栈数据)\n  - [3.5 算术和逻辑操作](#35-算术和逻辑操作)\n    - [3.5.1 加载有效地址](#351-加载有效地址)\n    - [3.5.2 一元操作和二元操作](#352-一元操作和二元操作)\n    - [3.5.3 移位操作](#353-移位操作)\n    - [3.5.4 讨论](#354-讨论)\n    - [3.5.5 特殊的算术操作](#355-特殊的算术操作)\n  - [3.6 控制](#36-控制)\n    - [3.6.1 条件码](#361-条件码)\n    - [3.6.2 访问条件码](#362-访问条件码)\n    - [3.6.3 跳转指令](#363-跳转指令)\n    - [3.6.4 跳转指令的编码](#364-跳转指令的编码)\n    - [3.6.5 用条件控制来实现条件分支](#365-用条件控制来实现条件分支)\n    - [3.6.6 用条件传送来实现条件分支](#366-用条件传送来实现条件分支)\n    - [3.6.7 循环](#367-循环)\n    - [3.6.8 <code>switch</code> 语句](#368-switch-语句)\n  - [3.7 过程](#37-过程)\n    - [3.7.1 运行时栈](#371-运行时栈)\n    - [3.7.2 转移控制](#372-转移控制)\n    - [3.7.3 数据传送](#373-数据传送)\n    - [3.7.4 栈上的局部存储](#374-栈上的局部存储)\n    - [3.7.5 寄存器中的局部存储空间](#375-寄存器中的局部存储空间)\n    - [3.7.6 递归过程](#376-递归过程)\n  - [3.8 数组的分配和访问](#38-数组的分配和访问)\n    - [3.8.1 基本原则](#381-基本原则)\n    - [3.8.2 指针运算](#382-指针运算)\n    - [3.8.3 嵌套的数组](#383-嵌套的数组)\n    - [3.8.4 定长数组](#384-定长数组)\n    - [3.8.5 变长数组](#385-变长数组)\n  - [3.9 异质的数据结构](#39-异质的数据结构)\n    - [3.9.1 结构](#391-结构)\n    - [3.9.2 联合](#392-联合)\n    - [3.9.3 数据对齐](#393-数据对齐)\n  - [3.10 在机器级程序中将控制与数据结合起来](#310-在机器级程序中将控制与数据结合起来)\n    - [3.10.1 理解指针](#3101-理解指针)\n    - [3.10.2 使用 GDB 调试器](#3102-使用-gdb-调试器)\n    - [3.10.3 内存越界引用和缓冲区溢出](#3103-内存越界引用和缓冲区溢出)\n    - [3.10.4 对抗缓冲区溢出攻击](#3104-对抗缓冲区溢出攻击)\n    - [3.10.5 支持可变长栈帧](#3105-支持可变长栈帧)\n  - [3.11 浮点代码](#311-浮点代码)\n    - [3.11.1 浮点传送和转换操作](#3111-浮点传送和转换操作)\n    - [3.11.2 过程中的浮点代码](#3112-过程中的浮点代码)\n    - [3.11.3 浮点运算操作](#3113-浮点运算操作)\n    - [3.11.4 定义和使用浮点常数](#3114-定义和使用浮点常数)\n    - [3.11.5 在浮点代码中使用位级操作](#3115-在浮点代码中使用位级操作)\n    - [3.11.6 浮点比较操作](#3116-浮点比较操作)\n    - [3.11.7 对浮点代码的观察结论](#3117-对浮点代码的观察结论)"}},l=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"第-3-章-程序的机器级表示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第-3-章-程序的机器级表示"}},[t._v("#")]),t._v(" 第 3 章 程序的机器级表示")]),t._v(" "),a("Markmap",{attrs:{id:"markmap_1a96284d",code:t.$dataBlock.markmap_1a96284d}}),a("h2",{attrs:{id:"31-历史回顾"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#31-历史回顾"}},[t._v("#")]),t._v(" 3.1 历史回顾")]),t._v(" "),a("h2",{attrs:{id:"32-程序编码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#32-程序编码"}},[t._v("#")]),t._v(" 3.2 程序编码")]),t._v(" "),a("h3",{attrs:{id:"321-机器级代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#321-机器级代码"}},[t._v("#")]),t._v(" 3.2.1 机器级代码")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("gcc 产生汇编代码")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("gcc -Og -S mstore.c\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("ul",[a("li",[a("code",[t._v("-Og")]),t._v(" 是告诉编译器使用会生成原始 C 代码整体结构的机器代码的优化等级")])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("反汇编器 OBJDUMP")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("objdump -d mstore.o\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])])]),t._v(" "),a("h3",{attrs:{id:"322-代码示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#322-代码示例"}},[t._v("#")]),t._v(" 3.2.2 代码示例")]),t._v(" "),a("h3",{attrs:{id:"323-关于格式的注解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#323-关于格式的注解"}},[t._v("#")]),t._v(" 3.2.3 关于格式的注解")]),t._v(" "),a("h2",{attrs:{id:"33-数据格式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#33-数据格式"}},[t._v("#")]),t._v(" 3.3 数据格式")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("ul",[a("li",[t._v('Intel 用术语 "字(word)" 来表示 16 位数据类型，后缀用 '),a("code",[t._v("w")]),t._v(" 来表示")]),t._v(" "),a("li",[t._v('32 位被看作 "长字(long word)"，因此后缀用 '),a("code",[t._v("l")]),t._v(" 表示")]),t._v(" "),a("li",[t._v('64 位被称为 "四字 (quad words)"，因此后缀用 '),a("code",[t._v("q")]),t._v(" 表示")])])]),t._v(" "),a("h2",{attrs:{id:"34-访问信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#34-访问信息"}},[t._v("#")]),t._v(" 3.4 访问信息")]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("x86-64 的整数寄存器")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20210923154700-2021-09-23-15-47-00.png",alt:"20210923154700-2021-09-23-15-47-00"}})])]),t._v(" "),a("h3",{attrs:{id:"341-操作数指标符"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#341-操作数指标符"}},[t._v("#")]),t._v(" 3.4.1 操作数指标符")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("三种操作数类")]),t._v(" "),a("ul",[a("li",[t._v("立即数\n"),a("ul",[a("li",[a("code",[t._v("$")]),t._v(" 后面跟一个用标准 C 表示法表示的整数")])])]),t._v(" "),a("li",[t._v("寄存器\n"),a("ul",[a("li",[t._v("表示某个寄存器的内容")])])]),t._v(" "),a("li",[t._v("内存引用\n"),a("ul",[a("li",[t._v("根据计算出来的地址访问某个内存位置")])])])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("比例变址寻址")]),t._v(" "),a("ul",[a("li",[a("mjx-container",{staticClass:"MathJax",attrs:{jax:"SVG"}},[a("svg",{staticStyle:{"vertical-align":"-0.566ex"},attrs:{xmlns:"http://www.w3.org/2000/svg",width:"13.738ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 6072.3 1000","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[a("defs",[a("path",{attrs:{id:"MJX-1189-TEX-I-1D43C",d:"M43 1Q26 1 26 10Q26 12 29 24Q34 43 39 45Q42 46 54 46H60Q120 46 136 53Q137 53 138 54Q143 56 149 77T198 273Q210 318 216 344Q286 624 286 626Q284 630 284 631Q274 637 213 637H193Q184 643 189 662Q193 677 195 680T209 683H213Q285 681 359 681Q481 681 487 683H497Q504 676 504 672T501 655T494 639Q491 637 471 637Q440 637 407 634Q393 631 388 623Q381 609 337 432Q326 385 315 341Q245 65 245 59Q245 52 255 50T307 46H339Q345 38 345 37T342 19Q338 6 332 0H316Q279 2 179 2Q143 2 113 2T65 2T43 1Z"}}),a("path",{attrs:{id:"MJX-1189-TEX-I-1D45A",d:"M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"}}),a("path",{attrs:{id:"MJX-1189-TEX-N-28",d:"M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"}}),a("path",{attrs:{id:"MJX-1189-TEX-I-1D45F",d:"M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"}}),a("path",{attrs:{id:"MJX-1189-TEX-I-1D44F",d:"M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"}}),a("path",{attrs:{id:"MJX-1189-TEX-N-2C",d:"M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"}}),a("path",{attrs:{id:"MJX-1189-TEX-I-1D456",d:"M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"}}),a("path",{attrs:{id:"MJX-1189-TEX-I-1D460",d:"M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"}}),a("path",{attrs:{id:"MJX-1189-TEX-N-29",d:"M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"}})]),a("g",{attrs:{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"}},[a("g",{attrs:{"data-mml-node":"math"}},[a("g",{attrs:{"data-mml-node":"mi"}},[a("use",{attrs:{"data-c":"1D43C","xlink:href":"#MJX-1189-TEX-I-1D43C"}})]),a("g",{attrs:{"data-mml-node":"mi",transform:"translate(504,0)"}},[a("use",{attrs:{"data-c":"1D45A","xlink:href":"#MJX-1189-TEX-I-1D45A"}})]),a("g",{attrs:{"data-mml-node":"mi",transform:"translate(1382,0)"}},[a("use",{attrs:{"data-c":"1D45A","xlink:href":"#MJX-1189-TEX-I-1D45A"}})]),a("g",{attrs:{"data-mml-node":"mo",transform:"translate(2260,0)"}},[a("use",{attrs:{"data-c":"28","xlink:href":"#MJX-1189-TEX-N-28"}})]),a("g",{attrs:{"data-mml-node":"mi",transform:"translate(2649,0)"}},[a("use",{attrs:{"data-c":"1D45F","xlink:href":"#MJX-1189-TEX-I-1D45F"}})]),a("g",{attrs:{"data-mml-node":"mi",transform:"translate(3100,0)"}},[a("use",{attrs:{"data-c":"1D44F","xlink:href":"#MJX-1189-TEX-I-1D44F"}})]),a("g",{attrs:{"data-mml-node":"mo",transform:"translate(3529,0)"}},[a("use",{attrs:{"data-c":"2C","xlink:href":"#MJX-1189-TEX-N-2C"}})]),a("g",{attrs:{"data-mml-node":"mi",transform:"translate(3973.7,0)"}},[a("use",{attrs:{"data-c":"1D45F","xlink:href":"#MJX-1189-TEX-I-1D45F"}})]),a("g",{attrs:{"data-mml-node":"mi",transform:"translate(4424.7,0)"}},[a("use",{attrs:{"data-c":"1D456","xlink:href":"#MJX-1189-TEX-I-1D456"}})]),a("g",{attrs:{"data-mml-node":"mo",transform:"translate(4769.7,0)"}},[a("use",{attrs:{"data-c":"2C","xlink:href":"#MJX-1189-TEX-N-2C"}})]),a("g",{attrs:{"data-mml-node":"mi",transform:"translate(5214.3,0)"}},[a("use",{attrs:{"data-c":"1D460","xlink:href":"#MJX-1189-TEX-I-1D460"}})]),a("g",{attrs:{"data-mml-node":"mo",transform:"translate(5683.3,0)"}},[a("use",{attrs:{"data-c":"29","xlink:href":"#MJX-1189-TEX-N-29"}})])])])])]),t._v(" "),a("ul",[a("li",[t._v("对应的操作数值为 "),a("mjx-container",{staticClass:"MathJax",attrs:{jax:"SVG"}},[a("svg",{staticStyle:{"vertical-align":"-0.566ex"},attrs:{xmlns:"http://www.w3.org/2000/svg",width:"27.083ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 11970.6 1000","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[a("defs",[a("path",{attrs:{id:"MJX-1190-TEX-I-1D440",d:"M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"}}),a("path",{attrs:{id:"MJX-1190-TEX-N-5B",d:"M118 -250V750H255V710H158V-210H255V-250H118Z"}}),a("path",{attrs:{id:"MJX-1190-TEX-I-1D43C",d:"M43 1Q26 1 26 10Q26 12 29 24Q34 43 39 45Q42 46 54 46H60Q120 46 136 53Q137 53 138 54Q143 56 149 77T198 273Q210 318 216 344Q286 624 286 626Q284 630 284 631Q274 637 213 637H193Q184 643 189 662Q193 677 195 680T209 683H213Q285 681 359 681Q481 681 487 683H497Q504 676 504 672T501 655T494 639Q491 637 471 637Q440 637 407 634Q393 631 388 623Q381 609 337 432Q326 385 315 341Q245 65 245 59Q245 52 255 50T307 46H339Q345 38 345 37T342 19Q338 6 332 0H316Q279 2 179 2Q143 2 113 2T65 2T43 1Z"}}),a("path",{attrs:{id:"MJX-1190-TEX-I-1D45A",d:"M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"}}),a("path",{attrs:{id:"MJX-1190-TEX-N-2B",d:"M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"}}),a("path",{attrs:{id:"MJX-1190-TEX-I-1D445",d:"M230 637Q203 637 198 638T193 649Q193 676 204 682Q206 683 378 683Q550 682 564 680Q620 672 658 652T712 606T733 563T739 529Q739 484 710 445T643 385T576 351T538 338L545 333Q612 295 612 223Q612 212 607 162T602 80V71Q602 53 603 43T614 25T640 16Q668 16 686 38T712 85Q717 99 720 102T735 105Q755 105 755 93Q755 75 731 36Q693 -21 641 -21H632Q571 -21 531 4T487 82Q487 109 502 166T517 239Q517 290 474 313Q459 320 449 321T378 323H309L277 193Q244 61 244 59Q244 55 245 54T252 50T269 48T302 46H333Q339 38 339 37T336 19Q332 6 326 0H311Q275 2 180 2Q146 2 117 2T71 2T50 1Q33 1 33 10Q33 12 36 24Q41 43 46 45Q50 46 61 46H67Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628Q287 635 230 637ZM630 554Q630 586 609 608T523 636Q521 636 500 636T462 637H440Q393 637 386 627Q385 624 352 494T319 361Q319 360 388 360Q466 361 492 367Q556 377 592 426Q608 449 619 486T630 554Z"}}),a("path",{attrs:{id:"MJX-1190-TEX-I-1D45F",d:"M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"}}),a("path",{attrs:{id:"MJX-1190-TEX-I-1D44F",d:"M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"}}),a("path",{attrs:{id:"MJX-1190-TEX-N-5D",d:"M22 710V750H159V-250H22V-210H119V710H22Z"}}),a("path",{attrs:{id:"MJX-1190-TEX-I-1D456",d:"M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"}}),a("path",{attrs:{id:"MJX-1190-TEX-N-2217",d:"M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"}}),a("path",{attrs:{id:"MJX-1190-TEX-I-1D460",d:"M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"}})]),a("g",{attrs:{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"}},[a("g",{attrs:{"data-mml-node":"math"}},[a("g",{attrs:{"data-mml-node":"mi"}},[a("use",{attrs:{"data-c":"1D440","xlink:href":"#MJX-1190-TEX-I-1D440"}})]),a("g",{attrs:{"data-mml-node":"mo",transform:"translate(1051,0)"}},[a("use",{attrs:{"data-c":"5B","xlink:href":"#MJX-1190-TEX-N-5B"}})]),a("g",{attrs:{"data-mml-node":"mi",transform:"translate(1329,0)"}},[a("use",{attrs:{"data-c":"1D43C","xlink:href":"#MJX-1190-TEX-I-1D43C"}})]),a("g",{attrs:{"data-mml-node":"mi",transform:"translate(1833,0)"}},[a("use",{attrs:{"data-c":"1D45A","xlink:href":"#MJX-1190-TEX-I-1D45A"}})]),a("g",{attrs:{"data-mml-node":"mi",transform:"translate(2711,0)"}},[a("use",{attrs:{"data-c":"1D45A","xlink:href":"#MJX-1190-TEX-I-1D45A"}})]),a("g",{attrs:{"data-mml-node":"mo",transform:"translate(3811.2,0)"}},[a("use",{attrs:{"data-c":"2B","xlink:href":"#MJX-1190-TEX-N-2B"}})]),a("g",{attrs:{"data-mml-node":"mi",transform:"translate(4811.4,0)"}},[a("use",{attrs:{"data-c":"1D445","xlink:href":"#MJX-1190-TEX-I-1D445"}})]),a("g",{attrs:{"data-mml-node":"mo",transform:"translate(5570.4,0)"}},[a("use",{attrs:{"data-c":"5B","xlink:href":"#MJX-1190-TEX-N-5B"}})]),a("g",{attrs:{"data-mml-node":"msub",transform:"translate(5848.4,0)"}},[a("g",{attrs:{"data-mml-node":"mi"}},[a("use",{attrs:{"data-c":"1D45F","xlink:href":"#MJX-1190-TEX-I-1D45F"}})]),a("g",{attrs:{"data-mml-node":"mi",transform:"translate(484,-150) scale(0.707)"}},[a("use",{attrs:{"data-c":"1D44F","xlink:href":"#MJX-1190-TEX-I-1D44F"}})])]),a("g",{attrs:{"data-mml-node":"mo",transform:"translate(6685.8,0)"}},[a("use",{attrs:{"data-c":"5D","xlink:href":"#MJX-1190-TEX-N-5D"}})]),a("g",{attrs:{"data-mml-node":"mo",transform:"translate(7186,0)"}},[a("use",{attrs:{"data-c":"2B","xlink:href":"#MJX-1190-TEX-N-2B"}})]),a("g",{attrs:{"data-mml-node":"mi",transform:"translate(8186.2,0)"}},[a("use",{attrs:{"data-c":"1D445","xlink:href":"#MJX-1190-TEX-I-1D445"}})]),a("g",{attrs:{"data-mml-node":"mo",transform:"translate(8945.2,0)"}},[a("use",{attrs:{"data-c":"5B","xlink:href":"#MJX-1190-TEX-N-5B"}})]),a("g",{attrs:{"data-mml-node":"msub",transform:"translate(9223.2,0)"}},[a("g",{attrs:{"data-mml-node":"mi"}},[a("use",{attrs:{"data-c":"1D45F","xlink:href":"#MJX-1190-TEX-I-1D45F"}})]),a("g",{attrs:{"data-mml-node":"mi",transform:"translate(484,-150) scale(0.707)"}},[a("use",{attrs:{"data-c":"1D456","xlink:href":"#MJX-1190-TEX-I-1D456"}})])]),a("g",{attrs:{"data-mml-node":"mo",transform:"translate(10001.2,0)"}},[a("use",{attrs:{"data-c":"5D","xlink:href":"#MJX-1190-TEX-N-5D"}})]),a("g",{attrs:{"data-mml-node":"mo",transform:"translate(10501.4,0)"}},[a("use",{attrs:{"data-c":"2217","xlink:href":"#MJX-1190-TEX-N-2217"}})]),a("g",{attrs:{"data-mml-node":"mi",transform:"translate(11223.6,0)"}},[a("use",{attrs:{"data-c":"1D460","xlink:href":"#MJX-1190-TEX-I-1D460"}})]),a("g",{attrs:{"data-mml-node":"mo",transform:"translate(11692.6,0)"}},[a("use",{attrs:{"data-c":"5D","xlink:href":"#MJX-1190-TEX-N-5D"}})])])])])])],1),t._v(" "),a("li",[a("mjx-container",{staticClass:"MathJax",attrs:{jax:"SVG"}},[a("svg",{staticStyle:{"vertical-align":"-0.048ex"},attrs:{xmlns:"http://www.w3.org/2000/svg",width:"1.717ex",height:"1.593ex",role:"img",focusable:"false",viewBox:"0 -683 759 704","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[a("defs",[a("path",{attrs:{id:"MJX-379-TEX-I-1D445",d:"M230 637Q203 637 198 638T193 649Q193 676 204 682Q206 683 378 683Q550 682 564 680Q620 672 658 652T712 606T733 563T739 529Q739 484 710 445T643 385T576 351T538 338L545 333Q612 295 612 223Q612 212 607 162T602 80V71Q602 53 603 43T614 25T640 16Q668 16 686 38T712 85Q717 99 720 102T735 105Q755 105 755 93Q755 75 731 36Q693 -21 641 -21H632Q571 -21 531 4T487 82Q487 109 502 166T517 239Q517 290 474 313Q459 320 449 321T378 323H309L277 193Q244 61 244 59Q244 55 245 54T252 50T269 48T302 46H333Q339 38 339 37T336 19Q332 6 326 0H311Q275 2 180 2Q146 2 117 2T71 2T50 1Q33 1 33 10Q33 12 36 24Q41 43 46 45Q50 46 61 46H67Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628Q287 635 230 637ZM630 554Q630 586 609 608T523 636Q521 636 500 636T462 637H440Q393 637 386 627Q385 624 352 494T319 361Q319 360 388 360Q466 361 492 367Q556 377 592 426Q608 449 619 486T630 554Z"}})]),a("g",{attrs:{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"}},[a("g",{attrs:{"data-mml-node":"math"}},[a("g",{attrs:{"data-mml-node":"mi"}},[a("use",{attrs:{"data-c":"1D445","xlink:href":"#MJX-379-TEX-I-1D445"}})])])])])]),t._v(" 表示取寄存器值")],1)])],1)])]),t._v(" "),a("h3",{attrs:{id:"342-数据传送指令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#342-数据传送指令"}},[t._v("#")]),t._v(" 3.4.2 数据传送指令")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("笔记")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("movl")]),t._v(" 指令以寄存器作为目的时，会将寄存器的高位 4 字节设置为 0\n"),a("ul",[a("li",[a("code",[t._v("x86-64")]),t._v(" 采用的惯例，任何为寄存器生成 32 位值的指令都会把该寄存器的高位部分置为 0")]),t._v(" "),a("li",[t._v("不存在 "),a("code",[t._v("movzlq")]),t._v(" 指令，其可以通过 "),a("code",[t._v("movl")]),t._v(" 指令来实现")])])]),t._v(" "),a("li",[t._v("常规的 "),a("code",[t._v("movq")]),t._v(" 只能以表示为 32 位补码数字的立即数作为源操作数，然后将这个值符号扩展到 64 位\n"),a("ul",[a("li",[a("code",[t._v("movabsq")]),t._v(" 指令能以任意 64 位立即数作为源操作数，但其只能以寄存器作为目的")])])]),t._v(" "),a("li",[a("code",[t._v("MOVZ")]),t._v(" 类零扩展， "),a("code",[t._v("MOVS")]),t._v(" 类符号扩展")]),t._v(" "),a("li",[a("code",[t._v("cltq")]),t._v(" 指令\n"),a("ul",[a("li",[t._v("没有操作数")]),t._v(" "),a("li",[t._v("以寄存器 "),a("code",[t._v("%eax")]),t._v(" 作为源，"),a("code",[t._v("%rax")]),t._v(" 作为符号扩展结果的目标寄存器")])])])])]),t._v(" "),a("h3",{attrs:{id:"343-数据传送示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#343-数据传送示例"}},[t._v("#")]),t._v(" 3.4.3 数据传送示例")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("笔记")]),t._v(" "),a("ul",[a("li",[t._v("C 中指针的间接引用 "),a("code",[t._v("*p")]),t._v(" 既可以当左值，又可以当右值\n"),a("ul",[a("li",[t._v("与汇编中内存地址，如 "),a("code",[t._v("(%rdi)")]),t._v("，即能当 "),a("code",[t._v("mov")]),t._v(" 指令的 "),a("code",[t._v("Source")]),t._v("，又能当 "),a("code",[t._v("mov")]),t._v(" 指令的 "),a("code",[t._v("Dest")]),t._v(" 相对应")]),t._v(" "),a("li",[t._v("当 "),a("code",[t._v("Source")]),t._v(" 时，即为右值")]),t._v(" "),a("li",[t._v("当 "),a("code",[t._v("Dest")]),t._v(" 时，即为左值")]),t._v(" "),a("li",[a("blockquote",[a("p",[a("RouterLink",{attrs:{to:"/pages/6183ad/#操作符的属性----优先级及结合性"}},[t._v("左值和右值的含义")])],1)])])])]),t._v(" "),a("li",[t._v("局部变量通常保存在寄存器中，而不是内存中\n"),a("ul",[a("li",[t._v("访问寄存器比访问内存要快很多")])])])])]),t._v(" "),a("h3",{attrs:{id:"344-压入和弹出栈数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#344-压入和弹出栈数据"}},[t._v("#")]),t._v(" 3.4.4 压入和弹出栈数据")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("%rsp")]),t._v(" 保存着栈顶元素的地址")]),t._v(" "),a("li",[t._v("栈是向下增长的")])])]),t._v(" "),a("h2",{attrs:{id:"35-算术和逻辑操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#35-算术和逻辑操作"}},[t._v("#")]),t._v(" 3.5 算术和逻辑操作")]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("整数算术操作")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/sbwcwso/PicBed/master/20220108105012.png",alt:"20220108105012"}})])]),t._v(" "),a("h3",{attrs:{id:"351-加载有效地址"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#351-加载有效地址"}},[t._v("#")]),t._v(" 3.5.1 加载有效地址")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("lea(load effective address): 加载有效地址")]),t._v(" "),a("ul",[a("li",[t._v("并不从指定的位置读入数据，而是将有效地址写入到目的操作数")]),t._v(" "),a("li",[t._v("也可以简洁的描述普通的算术操作")]),t._v(" "),a("li",[t._v("目的操作数必须是一个寄存器")])])]),t._v(" "),a("h3",{attrs:{id:"352-一元操作和二元操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#352-一元操作和二元操作"}},[t._v("#")]),t._v(" 3.5.2 一元操作和二元操作")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("笔记")]),t._v(" "),a("ul",[a("li",[t._v("一元操作只有一个操作数，既是源又是目的")]),t._v(" "),a("li",[t._v("二元操作中，第二个操作数即是源又是目的")])])]),t._v(" "),a("h3",{attrs:{id:"353-移位操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#353-移位操作"}},[t._v("#")]),t._v(" 3.5.3 移位操作")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("笔记")]),t._v(" "),a("ul",[a("li",[t._v("移位量要么是一个立即数，要么放在单字节寄存器 "),a("code",[t._v("%cl")]),t._v(" 中")]),t._v(" "),a("li",[t._v("x86-64 中，对 "),a("code",[t._v("w")]),t._v(" 位长的数据进行移位操作时\n"),a("ul",[a("li",[t._v("移位量由 "),a("code",[t._v("%cl")]),t._v(" 寄存器的低 "),a("code",[t._v("m")]),t._v(" 位决定， "),a("mjx-container",{staticClass:"MathJax",attrs:{jax:"SVG"}},[a("svg",{staticStyle:{"vertical-align":"-0.186ex"},attrs:{xmlns:"http://www.w3.org/2000/svg",width:"7.361ex",height:"1.714ex",role:"img",focusable:"false",viewBox:"0 -675.5 3253.4 757.5","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[a("defs",[a("path",{attrs:{id:"MJX-1191-TEX-I-1D464",d:"M580 385Q580 406 599 424T641 443Q659 443 674 425T690 368Q690 339 671 253Q656 197 644 161T609 80T554 12T482 -11Q438 -11 404 5T355 48Q354 47 352 44Q311 -11 252 -11Q226 -11 202 -5T155 14T118 53T104 116Q104 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Q21 293 29 315T52 366T96 418T161 441Q204 441 227 416T250 358Q250 340 217 250T184 111Q184 65 205 46T258 26Q301 26 334 87L339 96V119Q339 122 339 128T340 136T341 143T342 152T345 165T348 182T354 206T362 238T373 281Q402 395 406 404Q419 431 449 431Q468 431 475 421T483 402Q483 389 454 274T422 142Q420 131 420 107V100Q420 85 423 71T442 42T487 26Q558 26 600 148Q609 171 620 213T632 273Q632 306 619 325T593 357T580 385Z"}}),a("path",{attrs:{id:"MJX-1191-TEX-N-3D",d:"M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"}}),a("path",{attrs:{id:"MJX-1191-TEX-N-32",d:"M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"}}),a("path",{attrs:{id:"MJX-1191-TEX-I-1D45A",d:"M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"}})]),a("g",{attrs:{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"}},[a("g",{attrs:{"data-mml-node":"math"}},[a("g",{attrs:{"data-mml-node":"mi"}},[a("use",{attrs:{"data-c":"1D464","xlink:href":"#MJX-1191-TEX-I-1D464"}})]),a("g",{attrs:{"data-mml-node":"mo",transform:"translate(993.8,0)"}},[a("use",{attrs:{"data-c":"3D","xlink:href":"#MJX-1191-TEX-N-3D"}})]),a("g",{attrs:{"data-mml-node":"msup",transform:"translate(2049.6,0)"}},[a("g",{attrs:{"data-mml-node":"mn"}},[a("use",{attrs:{"data-c":"32","xlink:href":"#MJX-1191-TEX-N-32"}})]),a("g",{attrs:{"data-mml-node":"mi",transform:"translate(533,363) scale(0.707)"}},[a("use",{attrs:{"data-c":"1D45A","xlink:href":"#MJX-1191-TEX-I-1D45A"}})])])])])])]),t._v("，高位会被忽略")],1)])]),t._v(" "),a("li",[t._v("SAL 和 SHL\n"),a("ul",[a("li",[t._v("算术左移和逻辑左移，两者效果相同")])])]),t._v(" "),a("li",[t._v("SAR 和 SHR\n"),a("ul",[a("li",[t._v("算术右移和逻辑右移")]),t._v(" "),a("li",[t._v("算术右移会填上符号位")])])])])]),t._v(" "),a("h3",{attrs:{id:"354-讨论"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#354-讨论"}},[t._v("#")]),t._v(" 3.5.4 讨论")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("ul",[a("li",[t._v("整数的算术操作符中，只有算术右移需要区分有符号数和无符号数")]),t._v(" "),a("li",[t._v("其它指令既可用于无符号运算，也可用于补码运算")])])]),t._v(" "),a("h3",{attrs:{id:"355-特殊的算术操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#355-特殊的算术操作"}},[t._v("#")]),t._v(" 3.5.5 特殊的算术操作")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("笔记")]),t._v(" "),a("ul",[a("li",[t._v("16 字节数(128 位)称为八字(oct word)，简写为 "),a("code",[t._v("o")])]),t._v(" "),a("li",[a("code",[t._v("imulq")]),t._v(" 根据操作数的数量，有两种不同的乘法指令，分别对应 64 位的乘法和 128 位的乘法\n"),a("ul",[a("li",[t._v("两个操作数，则对应于 64 位的乘法\n"),a("ul",[a("li",[t._v("从两个 64 位的操作数产生 64 位的乘法")])])]),t._v(" "),a("li",[t._v("一个操作数，则对应于 128 位乘法\n"),a("ul",[a("li",[t._v("另一个参数必须位于寄存器 "),a("code",[t._v("%rax")]),t._v(" 中")]),t._v(" "),a("li",[t._v("乘积的高 64 位存放在寄存器 "),a("code",[t._v("%rdx")]),t._v(" 中，低 64 位存放在寄存器 "),a("code",[t._v("%rax")]),t._v(" 中")])])])])]),t._v(" "),a("li",[t._v("有符号除法指令 "),a("code",[t._v("idivl")]),t._v(" "),a("ul",[a("li",[t._v("将寄存器中 "),a("code",[t._v("%rdx")]),t._v("（高 64 位）和 "),a("code",[t._v("%rax")]),t._v(" （低 64 位) 中的 128 位作为被除数")]),t._v(" "),a("li",[t._v("除数作为指令的操作数给出")]),t._v(" "),a("li",[t._v("商储存在寄存器 "),a("code",[t._v("%rax")]),t._v(" 中，而余数储存在寄存器 "),a("code",[t._v("%rdx")]),t._v(" 中")])])]),t._v(" "),a("li",[a("code",[t._v("cqto")]),t._v(" 指令\n"),a("ul",[a("li",[t._v("读出 "),a("code",[t._v("%rax")]),t._v(" 的符号位，并将其复制到 "),a("code",[t._v("%rdx")]),t._v(" 的所有位")])])])])]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("图示")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/sbwcwso/PicBed/master/20220108120151.png",alt:"20220108120151"}})])]),t._v(" "),a("h2",{attrs:{id:"36-控制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#36-控制"}},[t._v("#")]),t._v(" 3.6 控制")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("ul",[a("li",[t._v("机器代码提供两种基本的低级机制来实现有条件的行为\n"),a("ul",[a("li",[t._v("测试数据值")]),t._v(" "),a("li",[t._v("根据测试的结果来改变控制流或数据流")])])])])]),t._v(" "),a("h3",{attrs:{id:"361-条件码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#361-条件码"}},[t._v("#")]),t._v(" 3.6.1 条件码")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("条件码寄存器")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("CF")]),t._v(" 进位标志\n"),a("ul",[a("li",[t._v("可以用来检查无符号操作的溢出")])])]),t._v(" "),a("li",[a("code",[t._v("ZF")]),t._v(" 零标志")]),t._v(" "),a("li",[a("code",[t._v("SF")]),t._v(" 符号标志")]),t._v(" "),a("li",[a("code",[t._v("OF")]),t._v(" 溢出标志\n"),a("ul",[a("li",[t._v("补码溢出")])])])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("leaq")]),t._v(" 指令不改变任何条件码，其只被用来进行地址计算")]),t._v(" "),a("li",[t._v("逻辑操作，进位标志和溢出标志均被设为0")]),t._v(" "),a("li",[t._v("移位操作，进位标志将设置为最后一个被移出的位，而溢出标志被置为 0")]),t._v(" "),a("li",[t._v("INC 和 DEC 会设置溢出和零标志，但是不会改变进位标志")])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("CMP 指令和 TEST 指令")]),t._v(" "),a("ul",[a("li",[t._v("只设置条件码，不改变其它任何寄存器")]),t._v(" "),a("li",[a("code",[t._v("CMP S1, S2")]),t._v(" "),a("ul",[a("li",[t._v("根据 "),a("code",[t._v("S2 - S1")]),t._v(" 的值来设置条件码")])])]),t._v(" "),a("li",[a("code",[t._v("TEST S1, S2")]),t._v(" "),a("ul",[a("li",[t._v("根据 "),a("code",[t._v("S1 & S2")]),t._v(" 的值来设置条件码")]),t._v(" "),a("li",[t._v("与 "),a("code",[t._v("AND")]),t._v(" 指令的行为一样，但是其不会改变寄存器的值")]),t._v(" "),a("li",[a("code",[t._v("testq %rax, %rax")]),t._v(" 用来测试 "),a("code",[t._v("%rax")]),t._v(" 的符号")])])])])]),t._v(" "),a("h3",{attrs:{id:"362-访问条件码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#362-访问条件码"}},[t._v("#")]),t._v(" 3.6.2 访问条件码")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[a("code",[t._v("SET")]),t._v(" 指令")]),t._v(" "),a("ul",[a("li",[t._v("根据条件码的某种组合，将一个字节设置为 0 或 1")])]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("所有的 "),a("code",[t._v("SET")]),t._v(" 指令")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/sbwcwso/PicBed/master/20220108120242.png",alt:"20220108120242"}})]),t._v(" "),a("ul",[a("li",[a("code",[t._v("g")]),t._v(" 和 "),a("code",[t._v("l")]),t._v(" 对应于有符号数")]),t._v(" "),a("li",[a("code",[t._v("a")]),t._v(" 和 "),a("code",[t._v("b")]),t._v(" 对应于无符号数")])])])]),t._v(" "),a("h3",{attrs:{id:"363-跳转指令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#363-跳转指令"}},[t._v("#")]),t._v(" 3.6.3 跳转指令")]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("所有跳转指令")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/sbwcwso/PicBed/master/20220108121048.png",alt:"20220108121048"}})]),t._v(" "),a("ul",[a("li",[t._v("间接跳转中的 "),a("code",[t._v("*")]),t._v(" 相当于 C 语言与指针配对的间接访问操作符")])])]),t._v(" "),a("h3",{attrs:{id:"364-跳转指令的编码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#364-跳转指令的编码"}},[t._v("#")]),t._v(" 3.6.4 跳转指令的编码")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("笔记")]),t._v(" "),a("ul",[a("li",[t._v("一个字节表示为跳转指令，其它字节作为偏移地址")]),t._v(" "),a("li",[t._v("偏移地址计算时，采取的基址是跳转指令下一条指令的地址")])])]),t._v(" "),a("h3",{attrs:{id:"365-用条件控制来实现条件分支"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#365-用条件控制来实现条件分支"}},[t._v("#")]),t._v(" 3.6.5 用条件控制来实现条件分支")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("%rip")]),t._v(" 寄存器与全局变量相关")]),t._v(" "),a("li",[a("code",[t._v("rep")]),t._v(" 与 "),a("code",[t._v("repz")]),t._v(" 指令相当于空操作\n"),a("ul",[a("li",[t._v("具体作用参照 P141")])])])])]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("C 语言中的 "),a("code",[t._v("if-else")]),t._v(" 语句")]),t._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("expr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  then"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("statement\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("statement\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])])]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[a("code",[t._v("if-else")]),t._v(" 语句的汇编实现")]),t._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[t._v("t "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("expr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("goto")]),t._v(" false"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nthen"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("statement\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("goto")]),t._v(" done"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nfalse"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("statement\ndone"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("ul",[a("li",[t._v("如果没有 "),a("code",[t._v("else")]),t._v(" 语句，则可以将 "),a("code",[t._v("false")]),t._v(" 标签合并到 "),a("code",[t._v("done")]),t._v(" 标签")])])]),t._v(" "),a("h3",{attrs:{id:"366-用条件传送来实现条件分支"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#366-用条件传送来实现条件分支"}},[t._v("#")]),t._v(" 3.6.6 用条件传送来实现条件分支")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("笔记")]),t._v(" "),a("ul",[a("li",[a("em",[t._v("控制")]),t._v(" 的条件转移在现代处理器上，可能非常低效")]),t._v(" "),a("li",[t._v("替代策略是 "),a("em",[t._v("数据")]),t._v(" 的条件转移\n"),a("ul",[a("li",[t._v("计算一个条件操作的两种结果，然后再根据条件是否满足从中选取一个")]),t._v(" "),a("li",[t._v("可以使用 "),a("em",[t._v("条件传送")]),t._v(" 指令来实现")]),t._v(" "),a("li",[t._v("条件传送指令更加符合现代处理器的性能特征")])])])])]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("条件传送指令")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/sbwcwso/PicBed/master/20220108135918.png",alt:"20220108135918"}})])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("ul",[a("li",[t._v("使用条件传送指令与流水线相关\n"),a("ul",[a("li",[t._v("条件传送指令使得控制流不依赖于数据，使得处理器更容易保持流水线是满的")])])]),t._v(" "),a("li",[t._v("使用条件传送指令的前提条件是分支没有副作用")]),t._v(" "),a("li",[t._v("需要综合考虑使用条件分支浪费的计算和由于分支预测错误所造成的性能处罚之间的相对性能")])])]),t._v(" "),a("h3",{attrs:{id:"367-循环"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#367-循环"}},[t._v("#")]),t._v(" 3.6.7 循环")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[a("code",[t._v("do-while")]),t._v(" 循环")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("通用形式")]),t._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n  body"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("statement\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("expr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])])]),t._v(" "),a("li",[a("p",[t._v("翻译成 "),a("code",[t._v("goto")]),t._v(" 语句")]),t._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[t._v("loop"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n  body"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("statement\n  t "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("expr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("goto")]),t._v(" loop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])])])])]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[a("code",[t._v("while")]),t._v(" 循环")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("通用形式")]),t._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("expr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  body"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("statement\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])])]),t._v(" "),a("li",[a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("跳转到中间 (jump to middle) 翻译方法")]),t._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("goto")]),t._v(" test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nloop"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n  body"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("statement\ntest"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n  t "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("expr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("goto")]),t._v(" loop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])])])]),t._v(" "),a("li",[a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("guarded-do 翻译方法")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("翻译为 "),a("code",[t._v("do-while")]),t._v(" 循环的形式")]),t._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[t._v("t "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("expr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("goto")]),t._v(" done"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n  body"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("statement\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("expr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndone"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("goto")]),t._v(" 代码如下")]),t._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[t._v("t "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("expr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("goto")]),t._v(" done"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nloop"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n  body"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("statement\n  t "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("expr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("goto")]),t._v(" loop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndone"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])])]),t._v(" "),a("li",[a("p",[t._v("使用较高优化等级编译时，如 "),a("code",[t._v("gcc")]),t._v(" 使用选项 "),a("code",[t._v("-O1")]),t._v("，会采用这种策略")]),t._v(" "),a("ul",[a("li",[t._v("利用这种实现策略，编译器常常可以优化循环内的初始测试，参照 图 3-21（P154）")])])])])])])])]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[a("code",[t._v("for")]),t._v(" 循环")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("通用形式")]),t._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("init"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("expr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("expr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" update"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("expr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  body"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("statement\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])])]),t._v(" "),a("li",[a("p",[t._v("基本等价于如下 "),a("code",[t._v("while")]),t._v(" 循环")]),t._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[t._v("init"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("expr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("expr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  body"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("statement\n  update"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("expr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("ul",[a("li",[a("code",[t._v("continue")]),t._v(" 语句是个例外\n"),a("ul",[a("li",[t._v("此时需用 "),a("code",[t._v("goto")]),t._v(" 替代 "),a("code",[t._v("continue")]),t._v("，直接跳至 "),a("code",[t._v("update")]),t._v(" 部分")]),t._v(" "),a("li",[t._v("参照练习 3-29 (P159)")])])])])])])]),t._v(" "),a("h3",{attrs:{id:"368-switch-语句"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#368-switch-语句"}},[t._v("#")]),t._v(" 3.6.8 "),a("code",[t._v("switch")]),t._v(" 语句")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("笔记")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("switch")]),t._v(" 语句可以根据一个整数索引值进行多重分支")]),t._v(" "),a("li",[a("code",[t._v("switch")]),t._v(" 可以提高 C 代码的可读性")]),t._v(" "),a("li",[t._v("通过使用 "),a("em",[t._v("跳转表")]),t._v(" (jump table)这种数据结构可以让实现更加高效")])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("跳转表")]),t._v(" "),a("ul",[a("li",[t._v("使用跳转表的优点是执行开关语句的时间与开关情况的数量无关")]),t._v(" "),a("li",[t._v("GCC 会根据开关情况的数量和开关情况值的稀疏程度来翻译开关语句")]),t._v(" "),a("li",[t._v("当开关情况数量比较多，并且值的范围跨度比较小时，会使用开关表")]),t._v(" "),a("li",[t._v("GCC 中有一个新的运算符 "),a("code",[t._v("&&")]),t._v("，这个运算符创建一个指向代码位置的指针")])])]),t._v(" "),a("h2",{attrs:{id:"37-过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#37-过程"}},[t._v("#")]),t._v(" 3.7 过程")]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("假设过程 "),a("code",[t._v("P")]),t._v(" 调用过程 "),a("code",[t._v("Q")]),t._v("，"),a("code",[t._v("Q")]),t._v(" 执行后返回到 "),a("code",[t._v("P")])])]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("设计良好的软件用过程作为抽象机制")]),t._v(" "),a("ul",[a("li",[t._v("隐藏某个行为的具体实现")]),t._v(" "),a("li",[t._v("提供清晰简洁的接口定义\n"),a("ul",[a("li",[t._v("说明要计算的是哪些值")]),t._v(" "),a("li",[t._v("过程会对程序状态产生怎样的影响")])])])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("要提供对过程的机器级支持，需要处理许多不同的属性")]),t._v(" "),a("ul",[a("li",[t._v("传递控制\n"),a("ul",[a("li",[t._v("进入 "),a("code",[t._v("Q")]),t._v(" 时，程序计数器必须设置为 "),a("code",[t._v("Q")]),t._v(" 的代码的起始地址")]),t._v(" "),a("li",[t._v("在返回时，要把程序计数器设置为 "),a("code",[t._v("P")]),t._v(" 中调用 "),a("code",[t._v("Q")]),t._v(" 后面那条指令的地址")])])]),t._v(" "),a("li",[t._v("传递数据\n"),a("ul",[a("li",[a("code",[t._v("P")]),t._v(" 必须能向 "),a("code",[t._v("Q")]),t._v(" 提供一个或多个参数")]),t._v(" "),a("li",[a("code",[t._v("Q")]),t._v(" 必须能向 "),a("code",[t._v("P")]),t._v(" 返回一个值")])])]),t._v(" "),a("li",[t._v("分配和释放内存\n"),a("ul",[a("li",[t._v("在开始时， "),a("code",[t._v("Q")]),t._v(" 可能需要为局部变量分配空间")]),t._v(" "),a("li",[t._v("在返回前，必须释放这些存储空间")])])])])]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("X86-64 的过程实现包括一组特殊的指令和一些对于机器资源使用的约定规则")]),t._v(" "),a("ul",[a("li",[t._v("特殊的指令包括 "),a("code",[t._v("call(callq)")]),t._v(" 和 "),a("code",[t._v("ret(retq)")])]),t._v(" "),a("li",[t._v("机器资源包括寄存器和程序内存\n"),a("ul",[a("li",[t._v("约定的规则即为 ABI(二进制程序接口)")])])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("目的是为了尽量的减少过程调用的开销")])])]),t._v(" "),a("h3",{attrs:{id:"371-运行时栈"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#371-运行时栈"}},[t._v("#")]),t._v(" 3.7.1 运行时栈")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("栈数据结构提供的后进先出的内存管理规则与过程的调用-返回顺序匹配")]),t._v(" "),a("ul",[a("li",[t._v("将栈指针 "),a("code",[t._v("%rsp")]),t._v(" 减小一个适当的量可以为没有指定初始值的数据在栈上分配空间")]),t._v(" "),a("li",[t._v("同样，可以增加栈指针来释放空间")])])]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("过程的栈帧(stack frame)")]),t._v(" "),a("ul",[a("li",[t._v("当 x86-64 过程需要的储存空间超出寄存器能存放的大小时，就会在栈上分配空间\n"),a("ul",[a("li",[a("details",{staticClass:"custom-block details"},[a("summary",[t._v("通用的栈帧结构")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/sbwcwso/PicBed/master/20220111065532.png",alt:"20220111065532"}})])])]),t._v(" "),a("li",[t._v("许多函数不需要栈帧\n"),a("ul",[a("li",[t._v("当所有的局部变量都可以保存在寄存器中，而且该函数不会调用任何其他函数时，则不需要栈帧\n"),a("ul",[a("li",[t._v("这种过程被称为叶子过程，可以将过程调用看做树结构")])])])])])])])])]),t._v(" "),a("h3",{attrs:{id:"372-转移控制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#372-转移控制"}},[t._v("#")]),t._v(" 3.7.2 转移控制")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[a("code",[t._v("call")]),t._v(" 和 "),a("code",[t._v("ret")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("call Q")]),t._v(" 会将地址 "),a("code",[t._v("A")]),t._v(" 压入栈中，并将 PC 设置为 "),a("code",[t._v("Q")]),t._v(" 的起始地址\n"),a("ul",[a("li",[t._v("地址 "),a("code",[t._v("A")]),t._v(" 为返回地址，是紧跟在 "),a("code",[t._v("call")]),t._v(" 指令后的那条指令的地址\n"),a("ul",[a("li",[t._v("属于 "),a("code",[t._v("P")]),t._v(" 的栈帧")])])])])]),t._v(" "),a("li",[t._v("栈指令 "),a("code",[t._v("ret")]),t._v(" 会从栈中弹出地址 "),a("code",[t._v("A")]),t._v("，并将 PC 设置为 "),a("code",[t._v("A")])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("callq")]),t._v(" 的 "),a("code",[t._v("retq")]),t._v(" 后的 "),a("code",[t._v("q")]),t._v(" 是为了强调是 x86-64 版本的调用和返回")]),t._v(" "),a("li",[t._v("PC(程序寄存器) 的值存储在寄存器 "),a("code",[t._v("%rip")]),t._v(" 中")]),t._v(" "),a("li",[t._v("把返回地址压入栈的简单的机制能够让函数 在稍后返回到程序中正确的点")])])])]),t._v(" "),a("h3",{attrs:{id:"373-数据传送"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#373-数据传送"}},[t._v("#")]),t._v(" 3.7.3 数据传送")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("通过寄存器传递函数参数")]),t._v(" "),a("ul",[a("li",[t._v("通过寄存器最多能传递 6 个整形(即整数和指针)参数")]),t._v(" "),a("li",[a("details",{staticClass:"custom-block details"},[a("summary",[t._v("传递整型函数参数的寄存器")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/sbwcwso/PicBed/master/20220111071536.png",alt:"20220111071536"}})])])]),t._v(" "),a("li",[t._v("整型参数超出 6 个的部分需要通过栈来传递\n"),a("ul",[a("li",[t._v("参数 7~n 放置在栈上，而参数 7 位于栈顶\n"),a("ul",[a("li",[t._v("通过栈传递参数时，所有的数据大小都向 8 的倍数对齐\n"),a("ul",[a("li",[a("details",{staticClass:"custom-block details"},[a("summary",[t._v("参数 "),a("code",[t._v("a4")]),t._v(" 即为对齐后的结果")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/sbwcwso/PicBed/master/20220111072134.png",alt:"20220111072134"}})])])])])])])])])])])]),t._v(" "),a("h3",{attrs:{id:"374-栈上的局部存储"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#374-栈上的局部存储"}},[t._v("#")]),t._v(" 3.7.4 栈上的局部存储")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("有些时候，局部数据必须存放在内存中")]),t._v(" "),a("ul",[a("li",[t._v("寄存器不足够存放所有的本地数据")]),t._v(" "),a("li",[t._v("对一个局部变量使用地址运算符 "),a("code",[t._v("&")]),t._v(" "),a("ul",[a("li",[t._v("必须为它产生一个地址")])])]),t._v(" "),a("li",[t._v("某些局部变量是数组或结构\n"),a("ul",[a("li",[t._v("必须能够通过数组或结构引用被访问到")])])])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("运行时栈提供了一种简单的、在需要时分配、函数完成时释放的局部存储的机制")])]),t._v(" "),a("h3",{attrs:{id:"375-寄存器中的局部存储空间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#375-寄存器中的局部存储空间"}},[t._v("#")]),t._v(" 3.7.5 寄存器中的局部存储空间")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("笔记")]),t._v(" "),a("ul",[a("li",[t._v("寄存器是唯一被所有过程共享的资源")]),t._v(" "),a("li",[t._v("虽然在给定的时刻只有一个过程是活动的，但必须确保当一个过程调用另一个过程时\n"),a("ul",[a("li",[t._v("被调用者不会覆盖调用者稍后会使用的寄存器值")])])]),t._v(" "),a("li",[t._v("为此， x86-64 采用了一组统一的寄存器使用惯例，所有的过程都必须遵守")])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("寄存器使用惯例")]),t._v(" "),a("ul",[a("li",[t._v("被调用者保存寄存器\n"),a("ul",[a("li",[a("code",[t._v("%rbx, %rbp")]),t._v(" 和 "),a("code",[t._v("%r12 ~ %r15")])])])]),t._v(" "),a("li",[t._v("调用者保存寄存器\n"),a("ul",[a("li",[t._v("所有其他的寄存器，除了栈指针 "),a("code",[t._v("%rsp")]),t._v("，都被分类为调用者保存寄存器")])])])]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("如果没有使用，则不需要保存")])])]),t._v(" "),a("h3",{attrs:{id:"376-递归过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#376-递归过程"}},[t._v("#")]),t._v(" 3.7.6 递归过程")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("寄存器和栈的使用惯例使得 x86-64 过程能够递归的调用其自身")])]),t._v(" "),a("h2",{attrs:{id:"38-数组的分配和访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#38-数组的分配和访问"}},[t._v("#")]),t._v(" 3.8 数组的分配和访问")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("ul",[a("li",[t._v("参照 "),a("RouterLink",{attrs:{to:"/pages/606dd4/"}},[t._v("C 和指针 -- 数组")])],1)])]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("笔记")]),t._v(" "),a("ul",[a("li",[t._v("C 语言可以产生指向数组中元素的指针，并对这些指针进行运算")]),t._v(" "),a("li",[t._v("优化编译器非常善于简化数组索引所使用的地址计算\n"),a("ul",[a("li",[t._v("如尽量减少乘法的使用")])])])])]),t._v(" "),a("h3",{attrs:{id:"381-基本原则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#381-基本原则"}},[t._v("#")]),t._v(" 3.8.1 基本原则")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("ul",[a("li",[t._v("x86-64 的内存引用指令可以简化数组访问\n"),a("ul",[a("li",[t._v("伸缩因子 "),a("code",[t._v("1, 2, 4, 8")]),t._v(" 覆盖了所有基本简单数据类型的大小")])])])])]),t._v(" "),a("h3",{attrs:{id:"382-指针运算"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#382-指针运算"}},[t._v("#")]),t._v(" 3.8.2 指针运算")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("ul",[a("li",[t._v("参照 "),a("RouterLink",{attrs:{to:"/pages/17a638/#指针运算"}},[t._v("指针运算")])],1)])]),t._v(" "),a("h3",{attrs:{id:"383-嵌套的数组"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#383-嵌套的数组"}},[t._v("#")]),t._v(" 3.8.3 嵌套的数组")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("ul",[a("li",[t._v("参照 "),a("RouterLink",{attrs:{to:"/pages/606dd4/#多维数组"}},[t._v("多维数组")])],1),t._v(" "),a("li",[t._v('数组元素在内存中按照 "行优先" 的顺序排列')])])]),t._v(" "),a("h3",{attrs:{id:"384-定长数组"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#384-定长数组"}},[t._v("#")]),t._v(" 3.8.4 定长数组")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("ul",[a("li",[t._v("编译器会借助已知的信息对数组的下标索引进行优化\n"),a("ul",[a("li",[t._v("参照 P180 页的示例")])])])])]),t._v(" "),a("h3",{attrs:{id:"385-变长数组"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#385-变长数组"}},[t._v("#")]),t._v(" 3.8.5 变长数组")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("C99 允许数组的维度是表达式，在数组被分配的时候才计算出来")])]),t._v(" "),a("li",[a("p",[t._v("一般用于函数中")]),t._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("var_ele")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" A"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" j"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" A"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("j"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("ul",[a("li",[t._v("参数 "),a("code",[t._v("n")]),t._v(" 必须出现在 "),a("code",[t._v("A[n][n]")]),t._v(" 之前")])])]),t._v(" "),a("li",[a("p",[t._v("在一个循环中引用变长数组时，编译器常利用访问模式的规律性来优化索引的计算")]),t._v(" "),a("ul",[a("li",[t._v("GCC 能识别出程序访问多维数组元素的元素的步长，然后生成代码来避免使用乘法")])])])])]),t._v(" "),a("h2",{attrs:{id:"39-异质的数据结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#39-异质的数据结构"}},[t._v("#")]),t._v(" 3.9 异质的数据结构")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("ul",[a("li",[t._v("参照 "),a("RouterLink",{attrs:{to:"/pages/a36051/"}},[t._v("C 和指针 -- 结构和联合")])],1),t._v(" "),a("li",[t._v("异质的数据结构指将不同类型的对象组合到一起创建数据类型")])])]),t._v(" "),a("h3",{attrs:{id:"391-结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#391-结构"}},[t._v("#")]),t._v(" 3.9.1 结构")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("结构的特点")]),t._v(" "),a("ul",[a("li",[t._v("结构的所有组成部分都放在内存中的一段连续的区域内")]),t._v(" "),a("li",[t._v("指向结构的指针就是结构第一个字节的地址")]),t._v(" "),a("li",[t._v("编译器维护关于每个结构类型的信息，指示每个字段 (field) 的字节偏移\n"),a("ul",[a("li",[t._v("以这些偏移作为内存引用指令中的位移，从而产生对结构元素的引用")]),t._v(" "),a("li",[t._v("结构各个字段的选取完全是在编译器处理的，机器代码不包含关于字段声明或字段名字的信息")])])])])]),t._v(" "),a("h3",{attrs:{id:"392-联合"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#392-联合"}},[t._v("#")]),t._v(" 3.9.2 联合")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("联合的特点")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("联合用不同的字段引用相同的内存块")])]),t._v(" "),a("li",[a("p",[t._v("一个联合总的大小等于它最大字段的大小")])]),t._v(" "),a("li",[a("p",[t._v("当结构中两个字段的使用是互斥的时候，使用联合可以减小分配空间的问题")])]),t._v(" "),a("li",[a("p",[t._v("联合通常的使用方法是引入一个枚举类型，定义这个联合中可能的不同选择，然后再创建一个结构，包含一个标签字段和这个联合")]),t._v(" "),a("ul",[a("li",[a("details",{staticClass:"custom-block details"},[a("summary",[t._v("示例：二叉树结点，内部节点不含数据，叶子节点含有两个 "),a("code",[t._v("double")]),t._v(" 类型的数据")]),t._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typedef")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("enum")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" N_LEAF"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" N_INTERNAL "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("nodetype_t")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("node_t")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("nodetype_t")]),t._v(" type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("union")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("node_t")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("left"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("node_t")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("right"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" internal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("double")]),t._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])])])])])]),t._v(" "),a("li",[a("p",[t._v("联合可以用来访问不同数据类型的位模式")])]),t._v(" "),a("li",[a("p",[t._v("当用联合将各种不同大小的数据类型结合到一起时，需要注意字节顺序的问题")])])])]),t._v(" "),a("h3",{attrs:{id:"393-数据对齐"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#393-数据对齐"}},[t._v("#")]),t._v(" 3.9.3 数据对齐")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("笔记")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("许多计算机系统对"),a("strong",[t._v("基本数据类型")]),t._v("的合法地址做了一些限制，要求某种类型对象的地址必须是某个值 "),a("mjx-container",{staticClass:"MathJax",attrs:{jax:"SVG"}},[a("svg",{staticStyle:{"vertical-align":"0"},attrs:{xmlns:"http://www.w3.org/2000/svg",width:"2.011ex",height:"1.545ex",role:"img",focusable:"false",viewBox:"0 -683 889 683","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[a("defs",[a("path",{attrs:{id:"MJX-1192-TEX-I-1D43E",d:"M285 628Q285 635 228 637Q205 637 198 638T191 647Q191 649 193 661Q199 681 203 682Q205 683 214 683H219Q260 681 355 681Q389 681 418 681T463 682T483 682Q500 682 500 674Q500 669 497 660Q496 658 496 654T495 648T493 644T490 641T486 639T479 638T470 637T456 637Q416 636 405 634T387 623L306 305Q307 305 490 449T678 597Q692 611 692 620Q692 635 667 637Q651 637 651 648Q651 650 654 662T659 677Q662 682 676 682Q680 682 711 681T791 680Q814 680 839 681T869 682Q889 682 889 672Q889 650 881 642Q878 637 862 637Q787 632 726 586Q710 576 656 534T556 455L509 418L518 396Q527 374 546 329T581 244Q656 67 661 61Q663 59 666 57Q680 47 717 46H738Q744 38 744 37T741 19Q737 6 731 0H720Q680 3 625 3Q503 3 488 0H478Q472 6 472 9T474 27Q478 40 480 43T491 46H494Q544 46 544 71Q544 75 517 141T485 216L427 354L359 301L291 248L268 155Q245 63 245 58Q245 51 253 49T303 46H334Q340 37 340 35Q340 19 333 5Q328 0 317 0Q314 0 280 1T180 2Q118 2 85 2T49 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Z"}})]),a("g",{attrs:{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"}},[a("g",{attrs:{"data-mml-node":"math"}},[a("g",{attrs:{"data-mml-node":"mi"}},[a("use",{attrs:{"data-c":"1D43E","xlink:href":"#MJX-1192-TEX-I-1D43E"}})])])])])]),t._v(" 的(通常是 2， 4， 8) 倍数")],1),t._v(" "),a("ul",[a("li",[t._v("处理器一般一次从内存中取出多个字节")]),t._v(" "),a("li",[t._v("如果没有按要求对齐，则为了读取一个基本数据类型，可能需要执行两次内存访问")]),t._v(" "),a("li",[t._v("数据对齐可以提升内存系统的性能")])])]),t._v(" "),a("li",[a("p",[t._v("x86-64 硬件的对齐原则是作为任何 "),a("mjx-container",{staticClass:"MathJax",attrs:{jax:"SVG"}},[a("svg",{staticStyle:{"vertical-align":"0"},attrs:{xmlns:"http://www.w3.org/2000/svg",width:"2.011ex",height:"1.545ex",role:"img",focusable:"false",viewBox:"0 -683 889 683","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[a("defs",[a("path",{attrs:{id:"MJX-1192-TEX-I-1D43E",d:"M285 628Q285 635 228 637Q205 637 198 638T191 647Q191 649 193 661Q199 681 203 682Q205 683 214 683H219Q260 681 355 681Q389 681 418 681T463 682T483 682Q500 682 500 674Q500 669 497 660Q496 658 496 654T495 648T493 644T490 641T486 639T479 638T470 637T456 637Q416 636 405 634T387 623L306 305Q307 305 490 449T678 597Q692 611 692 620Q692 635 667 637Q651 637 651 648Q651 650 654 662T659 677Q662 682 676 682Q680 682 711 681T791 680Q814 680 839 681T869 682Q889 682 889 672Q889 650 881 642Q878 637 862 637Q787 632 726 586Q710 576 656 534T556 455L509 418L518 396Q527 374 546 329T581 244Q656 67 661 61Q663 59 666 57Q680 47 717 46H738Q744 38 744 37T741 19Q737 6 731 0H720Q680 3 625 3Q503 3 488 0H478Q472 6 472 9T474 27Q478 40 480 43T491 46H494Q544 46 544 71Q544 75 517 141T485 216L427 354L359 301L291 248L268 155Q245 63 245 58Q245 51 253 49T303 46H334Q340 37 340 35Q340 19 333 5Q328 0 317 0Q314 0 280 1T180 2Q118 2 85 2T49 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Z"}})]),a("g",{attrs:{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"}},[a("g",{attrs:{"data-mml-node":"math"}},[a("g",{attrs:{"data-mml-node":"mi"}},[a("use",{attrs:{"data-c":"1D43E","xlink:href":"#MJX-1192-TEX-I-1D43E"}})])])])])]),t._v(" 字节的基本对象的地址必须是 "),a("mjx-container",{staticClass:"MathJax",attrs:{jax:"SVG"}},[a("svg",{staticStyle:{"vertical-align":"0"},attrs:{xmlns:"http://www.w3.org/2000/svg",width:"2.011ex",height:"1.545ex",role:"img",focusable:"false",viewBox:"0 -683 889 683","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[a("defs",[a("path",{attrs:{id:"MJX-1192-TEX-I-1D43E",d:"M285 628Q285 635 228 637Q205 637 198 638T191 647Q191 649 193 661Q199 681 203 682Q205 683 214 683H219Q260 681 355 681Q389 681 418 681T463 682T483 682Q500 682 500 674Q500 669 497 660Q496 658 496 654T495 648T493 644T490 641T486 639T479 638T470 637T456 637Q416 636 405 634T387 623L306 305Q307 305 490 449T678 597Q692 611 692 620Q692 635 667 637Q651 637 651 648Q651 650 654 662T659 677Q662 682 676 682Q680 682 711 681T791 680Q814 680 839 681T869 682Q889 682 889 672Q889 650 881 642Q878 637 862 637Q787 632 726 586Q710 576 656 534T556 455L509 418L518 396Q527 374 546 329T581 244Q656 67 661 61Q663 59 666 57Q680 47 717 46H738Q744 38 744 37T741 19Q737 6 731 0H720Q680 3 625 3Q503 3 488 0H478Q472 6 472 9T474 27Q478 40 480 43T491 46H494Q544 46 544 71Q544 75 517 141T485 216L427 354L359 301L291 248L268 155Q245 63 245 58Q245 51 253 49T303 46H334Q340 37 340 35Q340 19 333 5Q328 0 317 0Q314 0 280 1T180 2Q118 2 85 2T49 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Z"}})]),a("g",{attrs:{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"}},[a("g",{attrs:{"data-mml-node":"math"}},[a("g",{attrs:{"data-mml-node":"mi"}},[a("use",{attrs:{"data-c":"1D43E","xlink:href":"#MJX-1192-TEX-I-1D43E"}})])])])])]),t._v(" 的倍数")],1)]),t._v(" "),a("li",[a("p",[t._v("汇编代码")]),t._v(" "),a("div",{staticClass:"language-nasm line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nasm"}},[a("code",[t._v(".align "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("ul",[a("li",[t._v("保证了它后面的数据的起始地址是 8 的倍数")])])]),t._v(" "),a("li",[a("p",[t._v("结构中的基本数据结构都要满足对齐的要求")])]),t._v(" "),a("li",[a("p",[t._v("为了保证结构数组中的每个元素都满足它的对齐要求，结构的末尾可能需要一些填充")]),t._v(" "),a("ul",[a("li",[t._v("保证结构的首字节是满足对齐要求的")])])]),t._v(" "),a("li",[a("p",[t._v("当结构中所有数据元素的长度都是 2 的幂时")]),t._v(" "),a("ul",[a("li",[t._v("一种行之有效的策略是按照大小的降序排列结构中的元素")]),t._v(" "),a("li",[t._v("以减少空间的占用")])])])])]),t._v(" "),a("h2",{attrs:{id:"310-在机器级程序中将控制与数据结合起来"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#310-在机器级程序中将控制与数据结合起来"}},[t._v("#")]),t._v(" 3.10 在机器级程序中将控制与数据结合起来")]),t._v(" "),a("h3",{attrs:{id:"3101-理解指针"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#3101-理解指针"}},[t._v("#")]),t._v(" 3.10.1 理解指针")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("笔记")]),t._v(" "),a("ul",[a("li",[t._v("每个指针都对应一个类型\n"),a("ul",[a("li",[t._v("指针类型不是机器代码的一部分，只是 C 语言提供的一个抽象")])])]),t._v(" "),a("li",[t._v("每个指针都有一个值\n"),a("ul",[a("li",[t._v("这个值是某个指定类型的对象的地址")]),t._v(" "),a("li",[a("code",[t._v("NULL(0)")]),t._v(" 值表示指针没有指向任何地方")])])]),t._v(" "),a("li",[t._v("指针用 "),a("code",[t._v("&")]),t._v(" 运算符创建\n"),a("ul",[a("li",[t._v("此运算符的机器代码实现常用 "),a("code",[t._v("lea")]),t._v(" 指令实现")])])]),t._v(" "),a("li",[a("code",[t._v("*")]),t._v(" 操作符用于间接引用指针\n"),a("ul",[a("li",[t._v("通过内存引用来实现")])])]),t._v(" "),a("li",[t._v("数组与指针紧密联系\n"),a("ul",[a("li",[t._v("一个数组名可以像一个指针变量一样使用(但不能被修改)")])])]),t._v(" "),a("li",[t._v("指针的强制类型转换，只改变类型，不改变值")]),t._v(" "),a("li",[t._v("指针也可以指向函数\n"),a("ul",[a("li",[a("code",[t._v("int (*f)(int *)")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("f")]),t._v(" 是指向以 "),a("code",[t._v("int *")]),t._v(" 为参数，并返回 "),a("code",[t._v("int")]),t._v(" 的函数的指针")])])]),t._v(" "),a("li",[a("code",[t._v("int *f(int *)")]),t._v(" "),a("ul",[a("li",[t._v("会被解释为一个函数原型")])])])])])])]),t._v(" "),a("h3",{attrs:{id:"3102-使用-gdb-调试器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#3102-使用-gdb-调试器"}},[t._v("#")]),t._v(" 3.10.2 使用 GDB 调试器")]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("常用的 GDB 命令")]),t._v(" "),a("iframe",{attrs:{src:t.$withBase("/pdf/gdbnotes-x86-64.pdf"),width:"100%",height:"600"}})]),t._v(" "),a("h3",{attrs:{id:"3103-内存越界引用和缓冲区溢出"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#3103-内存越界引用和缓冲区溢出"}},[t._v("#")]),t._v(" 3.10.3 内存越界引用和缓冲区溢出")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("内存越界引用发生的原因")]),t._v(" "),a("ul",[a("li",[t._v("C 对数组引不进行任何边界检查")]),t._v(" "),a("li",[t._v("局部变量和状态信息(如保存的寄存器值和返回地址)都存放在栈中")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("后果")]),t._v(" "),a("ul",[a("li",[t._v("对越界的数组元素的写操作会破坏存储在栈中的状态信息")]),t._v(" "),a("li",[t._v("当程序试图重新加载寄存器或执行 "),a("code",[t._v("ret")]),t._v(" 指令时，就会发生严重的错误")])])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("缓冲区溢出")]),t._v(" "),a("ul",[a("li",[t._v("可以利用缓冲区溢出让程序执行攻击者注入的代码")]),t._v(" "),a("li",[t._v("任何到外部环境的接口都应该是“防弹的”\n"),a("ul",[a("li",[t._v("能够避免外部代理行为导致的系统错误")])])]),t._v(" "),a("li",[a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("蠕虫与病毒")]),t._v(" "),a("ul",[a("li",[t._v("蠕虫可以自己运行，并能够将自己的等效副本传播到其他机器")]),t._v(" "),a("li",[t._v("病毒能将自己添加到包括操作系统在内的其它程序中，但它不能独立运行")])])])])])]),t._v(" "),a("h3",{attrs:{id:"3104-对抗缓冲区溢出攻击"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#3104-对抗缓冲区溢出攻击"}},[t._v("#")]),t._v(" 3.10.4 对抗缓冲区溢出攻击")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("栈随机化")]),t._v(" "),a("ul",[a("li",[t._v("使栈的位置在每次运行时都有变化\n"),a("ul",[a("li",[t._v("在程序开始时，在栈上分配一段 "),a("code",[t._v("0~n")]),t._v(" 字节的随机大小的空间")])])]),t._v(" "),a("li",[t._v("在 Linux 系统中，栈随机化已成为标准化行为\n"),a("ul",[a("li",[t._v("属于"),a("strong",[t._v("地址空间布局随机化(Address-Space Layout Randomization, ASLR)")])])])])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("栈破坏检测")]),t._v(" "),a("ul",[a("li",[t._v("在栈帧的任何局部缓冲与栈状态之间存储一个特殊的金丝雀(canary)值，也叫做哨兵值\n"),a("ul",[a("li",[a("details",{staticClass:"custom-block details"},[a("summary",[t._v("示意图")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/sbwcwso/PicBed/master/20220114134235.png",alt:"20220114134235"}})])])]),t._v(" "),a("li",[t._v("程序每次运行时随机产生")]),t._v(" "),a("li",[t._v("在恢复寄存器或从函数返回时，检查这个金丝雀值是否被修改\n"),a("ul",[a("li",[t._v("如果被修改，则程序异常中止")])])]),t._v(" "),a("li",[t._v("只会带来很少的性能损失，gcc 只在函数中有局部 "),a("code",[t._v("char")]),t._v(" 类型缓冲区的时候才会插入这样的代码\n"),a("ul",[a("li",[t._v("gcc 的命令行选项 "),a("code",[t._v("-fno-stack-protector")]),t._v(" 可以阻止生成相应的保护代码")])])])])])])]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("限制可执行代码区域")]),t._v(" "),a("ul",[a("li",[t._v("目的是消除攻击者向系统中插入可执行代码的能力")])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("常用的对抗缓冲区溢出攻击的方法不需要程序员做出特殊的努力，带来的性能代价也非常小")])]),t._v(" "),a("h3",{attrs:{id:"3105-支持可变长栈帧"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#3105-支持可变长栈帧"}},[t._v("#")]),t._v(" 3.10.5 支持可变长栈帧")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("使用情形")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("alloca")]),t._v(" 是一个标准库函数，可以在栈上分配任意字节数量的存储")]),t._v(" "),a("li",[t._v("当函数声明一个局变可变数组时，也要求栈帧的长度可变")])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("x86-64 使用寄存器 `%rbp` 作为帧指针(frame pointer) 来管理可变长栈帧")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("%rbp")]),t._v(" 也称为基指针(base pointer)")]),t._v(" "),a("li",[a("details",{staticClass:"custom-block details"},[a("summary",[t._v("使用示意图")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/sbwcwso/PicBed/master/20220114135630.png",alt:"20220114135630"}})])])]),t._v(" "),a("li",[a("code",[t._v("leave")]),t._v(" 指令\n"),a("ul",[a("li",[a("p",[t._v("相当于以下两条指令")]),t._v(" "),a("div",{staticClass:"language-nasm line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nasm"}},[a("code",[t._v("movq "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("rbp")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("rsp")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(";Set stack pointer to beginning of frame")]),t._v("\npopq "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("rbp")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(";Restore saved %rbp and set stack ptr to end of caller’s frame")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])])]),t._v(" "),a("li",[a("p",[t._v("用于在函数返回时，将帧指针恢复到之间有状态")])])])])])]),t._v(" "),a("h2",{attrs:{id:"311-浮点代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#311-浮点代码"}},[t._v("#")]),t._v(" 3.11 浮点代码")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("笔记")]),t._v(" "),a("ul",[a("li",[a("em",[t._v("单指令多数据")]),t._v(" 或 SIMD\n"),a("ul",[a("li",[t._v("媒体指令，支持图形和图像处理")]),t._v(" "),a("li",[t._v("允许对不同的数据并行执行同一操作")]),t._v(" "),a("li",[t._v("最新的为 AVX(Advanced Vector Extension，高级向量扩展)")]),t._v(" "),a("li",[t._v("给定命令行参数 "),a("code",[t._v("-mavx2")]),t._v("，gcc 会生成 AVX2 代码")])])])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("寄存器")]),t._v(" "),a("ul",[a("li",[t._v("AVX 浮点体系结构允许数据存储在 16 个 YMM 寄存器中，名字为 "),a("code",[t._v("%ymm0 ~ %ymm15")]),t._v(" "),a("ul",[a("li",[t._v("每个都是 256 位(32 字节)")]),t._v(" "),a("li",[t._v("当对标题(scalar)数据进行操作时，这些寄存器只保存浮点数\n"),a("ul",[a("li",[t._v("对于 "),a("code",[t._v("float")]),t._v("，只使用低 32 位")]),t._v(" "),a("li",[t._v("对于 "),a("code",[t._v("double")]),t._v("，只使用低 64 位")]),t._v(" "),a("li",[t._v("汇编代码用 "),a("code",[t._v("%xmm0 ~ %xmm15")]),t._v(" 来引用他们")])])])])]),t._v(" "),a("li",[a("details",{staticClass:"custom-block details"},[a("summary",[t._v("AVX 浮点体系媒体寄存器")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/sbwcwso/PicBed/master/20220112063241.png",alt:"20220112063241"}})])])])])]),t._v(" "),a("h3",{attrs:{id:"3111-浮点传送和转换操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#3111-浮点传送和转换操作"}},[t._v("#")]),t._v(" 3.11.1 浮点传送和转换操作")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("浮点传送指令")]),t._v(" "),a("ul",[a("li",[t._v("引用内存的指令是 "),a("em",[t._v("标量")]),t._v(" 指令\n"),a("ul",[a("li",[t._v("只对单个而不是一组封装好的数据值进行操作")])])]),t._v(" "),a("li",[t._v("浮点传送指令建议 32 位内存数据满足 4 字节对齐，64 位数据满足 8 字节对齐")]),t._v(" "),a("li",[a("details",{staticClass:"custom-block details"},[a("summary",[t._v("浮点传递指令图示")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/sbwcwso/PicBed/master/20220112064200.png",alt:"20220112064200"}})])])])])]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("浮点转换")]),t._v(" "),a("ul",[a("li",[t._v("双操作数浮点转换指令\n"),a("ul",[a("li",[a("details",{staticClass:"custom-block details"},[a("summary",[t._v("命令说明")]),t._v(" "),a("ul",[a("li",[a("img",{attrs:{src:"https://raw.githubusercontent.com/sbwcwso/PicBed/master/20220112064657.png",alt:"20220112064657"}})])])])]),t._v(" "),a("li",[t._v("将浮点数转换为整数")]),t._v(" "),a("li",[t._v("会进行截断(truncation)，把值向 0 进行舍入")])])]),t._v(" "),a("li",[t._v("三操作数浮点转换指令\n"),a("ul",[a("li",[a("details",{staticClass:"custom-block details"},[a("summary",[t._v("命令说明")]),t._v(" "),a("ul",[a("li",[a("img",{attrs:{src:"https://raw.githubusercontent.com/sbwcwso/PicBed/master/20220112064546.png",alt:"20220112064546"}})])])])]),t._v(" "),a("li",[t._v("可以忽略第二个操作数，因为其只影响高位字节\n"),a("ul",[a("li",[t._v("在常见的使用场景中，第二个源和目的操作数是一样的")])])])])])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[a("code",[t._v("float")]),t._v(" 和 "),a("code",[t._v("double")]),t._v(" 之间的转换")]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("float")]),t._v(" to "),a("code",[t._v("double")])]),t._v(" "),a("div",{staticClass:"language-nasm line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nasm"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(";Conversion from single to double precision")]),t._v("\nvunpcklps "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("xmm0")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("xmm0")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("xmm0")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(";Replicate first vector element")]),t._v("\nvcvtps2pd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("xmm0")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("xmm0")]),t._v("          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(";Convert two vector elements to double")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("double")]),t._v(" to "),a("code",[t._v("float")])]),t._v(" "),a("div",{staticClass:"language-nasm line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nasm"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(";Conversion from double to single precision")]),t._v("\nvmovddup "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("xmm0")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("xmm0")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(";Replicate first vector element")]),t._v("\nvcvtpd2psx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("xmm0")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("xmm0")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(";Convert two vector elements to single")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])])])])]),t._v(" "),a("h3",{attrs:{id:"3112-过程中的浮点代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#3112-过程中的浮点代码"}},[t._v("#")]),t._v(" 3.11.2 过程中的浮点代码")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("寄存器使用规则")]),t._v(" "),a("ul",[a("li",[t._v("XMM 寄存器 "),a("code",[t._v("%xmm0 ~ %xmm7")]),t._v(" 最多可以传递 8 个浮点参数\n"),a("ul",[a("li",[t._v("按照参数列出的顺序使用这些寄存器")]),t._v(" "),a("li",[t._v("多余的参数通过栈进行传递")])])]),t._v(" "),a("li",[t._v("函数使用寄存器 "),a("code",[t._v("%xmm0")]),t._v(" 来返回浮点值")]),t._v(" "),a("li",[t._v("所有的 XMM 寄存器都是调用者保存的")])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("当函数包含指针、整数和浮点数混合的参数时")]),t._v(" "),a("ul",[a("li",[t._v("指针和整数通过通用寄存器传递")]),t._v(" "),a("li",[t._v("浮点值通过 XMM 寄存器传递")])])]),t._v(" "),a("h3",{attrs:{id:"3113-浮点运算操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#3113-浮点运算操作"}},[t._v("#")]),t._v(" 3.11.3 浮点运算操作")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("标题浮点算术运算操作指令")]),t._v(" "),a("ul",[a("li",[a("details",{staticClass:"custom-block details"},[a("summary",[t._v("图示")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/sbwcwso/PicBed/master/20220112070247.png",alt:"20220112070247"}})])])]),t._v(" "),a("li",[t._v("每条指令有一个("),a("mjx-container",{staticClass:"MathJax",attrs:{jax:"SVG"}},[a("svg",{staticStyle:{"vertical-align":"-0.339ex"},attrs:{xmlns:"http://www.w3.org/2000/svg",width:"2.375ex",height:"1.934ex",role:"img",focusable:"false",viewBox:"0 -705 1049.6 855","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[a("defs",[a("path",{attrs:{id:"MJX-575-TEX-I-1D446",d:"M308 24Q367 24 416 76T466 197Q466 260 414 284Q308 311 278 321T236 341Q176 383 176 462Q176 523 208 573T273 648Q302 673 343 688T407 704H418H425Q521 704 564 640Q565 640 577 653T603 682T623 704Q624 704 627 704T632 705Q645 705 645 698T617 577T585 459T569 456Q549 456 549 465Q549 471 550 475Q550 478 551 494T553 520Q553 554 544 579T526 616T501 641Q465 662 419 662Q362 662 313 616T263 510Q263 480 278 458T319 427Q323 425 389 408T456 390Q490 379 522 342T554 242Q554 216 546 186Q541 164 528 137T492 78T426 18T332 -20Q320 -22 298 -22Q199 -22 144 33L134 44L106 13Q83 -14 78 -18T65 -22Q52 -22 52 -14Q52 -11 110 221Q112 227 130 227H143Q149 221 149 216Q149 214 148 207T144 186T142 153Q144 114 160 87T203 47T255 29T308 24Z"}}),a("path",{attrs:{id:"MJX-575-TEX-N-31",d:"M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"}})]),a("g",{attrs:{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"}},[a("g",{attrs:{"data-mml-node":"math"}},[a("g",{attrs:{"data-mml-node":"msub"}},[a("g",{attrs:{"data-mml-node":"mi"}},[a("use",{attrs:{"data-c":"1D446","xlink:href":"#MJX-575-TEX-I-1D446"}})]),a("g",{attrs:{"data-mml-node":"mn",transform:"translate(646,-150) scale(0.707)"}},[a("use",{attrs:{"data-c":"31","xlink:href":"#MJX-575-TEX-N-31"}})])])])])])]),t._v(")或两个("),a("mjx-container",{staticClass:"MathJax",attrs:{jax:"SVG"}},[a("svg",{staticStyle:{"vertical-align":"-0.439ex"},attrs:{xmlns:"http://www.w3.org/2000/svg",width:"5.755ex",height:"2.034ex",role:"img",focusable:"false",viewBox:"0 -705 2543.8 899","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[a("defs",[a("path",{attrs:{id:"MJX-1193-TEX-I-1D446",d:"M308 24Q367 24 416 76T466 197Q466 260 414 284Q308 311 278 321T236 341Q176 383 176 462Q176 523 208 573T273 648Q302 673 343 688T407 704H418H425Q521 704 564 640Q565 640 577 653T603 682T623 704Q624 704 627 704T632 705Q645 705 645 698T617 577T585 459T569 456Q549 456 549 465Q549 471 550 475Q550 478 551 494T553 520Q553 554 544 579T526 616T501 641Q465 662 419 662Q362 662 313 616T263 510Q263 480 278 458T319 427Q323 425 389 408T456 390Q490 379 522 342T554 242Q554 216 546 186Q541 164 528 137T492 78T426 18T332 -20Q320 -22 298 -22Q199 -22 144 33L134 44L106 13Q83 -14 78 -18T65 -22Q52 -22 52 -14Q52 -11 110 221Q112 227 130 227H143Q149 221 149 216Q149 214 148 207T144 186T142 153Q144 114 160 87T203 47T255 29T308 24Z"}}),a("path",{attrs:{id:"MJX-1193-TEX-N-31",d:"M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"}}),a("path",{attrs:{id:"MJX-1193-TEX-N-2C",d:"M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"}}),a("path",{attrs:{id:"MJX-1193-TEX-N-32",d:"M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"}})]),a("g",{attrs:{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"}},[a("g",{attrs:{"data-mml-node":"math"}},[a("g",{attrs:{"data-mml-node":"msub"}},[a("g",{attrs:{"data-mml-node":"mi"}},[a("use",{attrs:{"data-c":"1D446","xlink:href":"#MJX-1193-TEX-I-1D446"}})]),a("g",{attrs:{"data-mml-node":"mn",transform:"translate(646,-150) scale(0.707)"}},[a("use",{attrs:{"data-c":"31","xlink:href":"#MJX-1193-TEX-N-31"}})])]),a("g",{attrs:{"data-mml-node":"mo",transform:"translate(1049.6,0)"}},[a("use",{attrs:{"data-c":"2C","xlink:href":"#MJX-1193-TEX-N-2C"}})]),a("g",{attrs:{"data-mml-node":"msub",transform:"translate(1494.2,0)"}},[a("g",{attrs:{"data-mml-node":"mi"}},[a("use",{attrs:{"data-c":"1D446","xlink:href":"#MJX-1193-TEX-I-1D446"}})]),a("g",{attrs:{"data-mml-node":"mn",transform:"translate(646,-150) scale(0.707)"}},[a("use",{attrs:{"data-c":"32","xlink:href":"#MJX-1193-TEX-N-32"}})])])])])])]),t._v(")源操作数和一个目的操作数 "),a("mjx-container",{staticClass:"MathJax",attrs:{jax:"SVG"}},[a("svg",{staticStyle:{"vertical-align":"0"},attrs:{xmlns:"http://www.w3.org/2000/svg",width:"1.873ex",height:"1.545ex",role:"img",focusable:"false",viewBox:"0 -683 828 683","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[a("defs",[a("path",{attrs:{id:"MJX-797-TEX-I-1D437",d:"M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"}})]),a("g",{attrs:{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"}},[a("g",{attrs:{"data-mml-node":"math"}},[a("g",{attrs:{"data-mml-node":"mi"}},[a("use",{attrs:{"data-c":"1D437","xlink:href":"#MJX-797-TEX-I-1D437"}})])])])])]),t._v(" "),a("ul",[a("li",[a("mjx-container",{staticClass:"MathJax",attrs:{jax:"SVG"}},[a("svg",{staticStyle:{"vertical-align":"-0.339ex"},attrs:{xmlns:"http://www.w3.org/2000/svg",width:"2.375ex",height:"1.934ex",role:"img",focusable:"false",viewBox:"0 -705 1049.6 855","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[a("defs",[a("path",{attrs:{id:"MJX-576-TEX-I-1D446",d:"M308 24Q367 24 416 76T466 197Q466 260 414 284Q308 311 278 321T236 341Q176 383 176 462Q176 523 208 573T273 648Q302 673 343 688T407 704H418H425Q521 704 564 640Q565 640 577 653T603 682T623 704Q624 704 627 704T632 705Q645 705 645 698T617 577T585 459T569 456Q549 456 549 465Q549 471 550 475Q550 478 551 494T553 520Q553 554 544 579T526 616T501 641Q465 662 419 662Q362 662 313 616T263 510Q263 480 278 458T319 427Q323 425 389 408T456 390Q490 379 522 342T554 242Q554 216 546 186Q541 164 528 137T492 78T426 18T332 -20Q320 -22 298 -22Q199 -22 144 33L134 44L106 13Q83 -14 78 -18T65 -22Q52 -22 52 -14Q52 -11 110 221Q112 227 130 227H143Q149 221 149 216Q149 214 148 207T144 186T142 153Q144 114 160 87T203 47T255 29T308 24Z"}}),a("path",{attrs:{id:"MJX-576-TEX-N-32",d:"M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"}})]),a("g",{attrs:{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"}},[a("g",{attrs:{"data-mml-node":"math"}},[a("g",{attrs:{"data-mml-node":"msub"}},[a("g",{attrs:{"data-mml-node":"mi"}},[a("use",{attrs:{"data-c":"1D446","xlink:href":"#MJX-576-TEX-I-1D446"}})]),a("g",{attrs:{"data-mml-node":"mn",transform:"translate(646,-150) scale(0.707)"}},[a("use",{attrs:{"data-c":"32","xlink:href":"#MJX-576-TEX-N-32"}})])])])])])]),t._v(" 和 "),a("mjx-container",{staticClass:"MathJax",attrs:{jax:"SVG"}},[a("svg",{staticStyle:{"vertical-align":"0"},attrs:{xmlns:"http://www.w3.org/2000/svg",width:"1.873ex",height:"1.545ex",role:"img",focusable:"false",viewBox:"0 -683 828 683","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[a("defs",[a("path",{attrs:{id:"MJX-797-TEX-I-1D437",d:"M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"}})]),a("g",{attrs:{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"}},[a("g",{attrs:{"data-mml-node":"math"}},[a("g",{attrs:{"data-mml-node":"mi"}},[a("use",{attrs:{"data-c":"1D437","xlink:href":"#MJX-797-TEX-I-1D437"}})])])])])]),t._v(" 都必须是 XMM 寄存器")],1)])],1)])]),t._v(" "),a("h3",{attrs:{id:"3114-定义和使用浮点常数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#3114-定义和使用浮点常数"}},[t._v("#")]),t._v(" 3.11.4 定义和使用浮点常数")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("笔记")]),t._v(" "),a("ul",[a("li",[t._v("AVX 浮点操作不能以立即数值作为操作数\n"),a("ul",[a("li",[t._v("编译器必须为所有的常量值分配和初始化存储空间")])])]),t._v(" "),a("li",[a("details",{staticClass:"custom-block details"},[a("summary",[t._v("示例")]),t._v(" "),a("ul",[a("li",[t._v("C code")])]),t._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("double")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cel2fahr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("double")]),t._v(" temp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.8")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" temp "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("32.0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("ul",[a("li",[t._v("汇编代码")])]),t._v(" "),a("div",{staticClass:"language-nasm line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nasm"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(";double cel2fahr(double temp)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(";temp in %xmm0")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token label function"}},[t._v("cel2fahr:")]),t._v("\n  vmulsd .LC2("),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("rip), "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("xmm0")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("xmm0")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(";Multiply by 1.8")]),t._v("\n  vaddsd .LC3("),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("rip), "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("xmm0")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[t._v("xmm0")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(";Add 32.0")]),t._v("\n  ret\n"),a("span",{pre:!0,attrs:{class:"token label function"}},[t._v(".LC2:")]),t._v("\n  .long "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3435973837")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(";Low-order 4 bytes of 1.8")]),t._v("\n  .long "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1073532108")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(";High-order 4 bytes of 1.8")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token label function"}},[t._v(".LC3:")]),t._v("\n  .long "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("             "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(";Low-order 4 bytes of 32.0")]),t._v("\n  .long "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1077936128")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(";High-order 4 bytes of 32.0")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br")])]),a("ul",[a("li",[t._v("注意常量是以十进制的形式书写的，而且由于小端字节序，低位字节在前，高位字节在后")])])])])])]),t._v(" "),a("h3",{attrs:{id:"3115-在浮点代码中使用位级操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#3115-在浮点代码中使用位级操作"}},[t._v("#")]),t._v(" 3.11.5 在浮点代码中使用位级操作")]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("位级操作指令")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/sbwcwso/PicBed/master/20220112071457.png",alt:"20220112071457"}})]),t._v(" "),a("ul",[a("li",[t._v("注意会更新整个目的 XMM 寄存器")])])]),t._v(" "),a("h3",{attrs:{id:"3116-浮点比较操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#3116-浮点比较操作"}},[t._v("#")]),t._v(" 3.11.6 浮点比较操作")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("浮点比较指令")]),t._v(" "),a("ul",[a("li",[a("details",{staticClass:"custom-block details"},[a("summary",[t._v("指令详情")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/sbwcwso/PicBed/master/20220112071856.png",alt:"20220112071856"}})])])]),t._v(" "),a("li",[t._v("参数 "),a("mjx-container",{staticClass:"MathJax",attrs:{jax:"SVG"}},[a("svg",{staticStyle:{"vertical-align":"-0.339ex"},attrs:{xmlns:"http://www.w3.org/2000/svg",width:"2.375ex",height:"1.934ex",role:"img",focusable:"false",viewBox:"0 -705 1049.6 855","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[a("defs",[a("path",{attrs:{id:"MJX-576-TEX-I-1D446",d:"M308 24Q367 24 416 76T466 197Q466 260 414 284Q308 311 278 321T236 341Q176 383 176 462Q176 523 208 573T273 648Q302 673 343 688T407 704H418H425Q521 704 564 640Q565 640 577 653T603 682T623 704Q624 704 627 704T632 705Q645 705 645 698T617 577T585 459T569 456Q549 456 549 465Q549 471 550 475Q550 478 551 494T553 520Q553 554 544 579T526 616T501 641Q465 662 419 662Q362 662 313 616T263 510Q263 480 278 458T319 427Q323 425 389 408T456 390Q490 379 522 342T554 242Q554 216 546 186Q541 164 528 137T492 78T426 18T332 -20Q320 -22 298 -22Q199 -22 144 33L134 44L106 13Q83 -14 78 -18T65 -22Q52 -22 52 -14Q52 -11 110 221Q112 227 130 227H143Q149 221 149 216Q149 214 148 207T144 186T142 153Q144 114 160 87T203 47T255 29T308 24Z"}}),a("path",{attrs:{id:"MJX-576-TEX-N-32",d:"M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"}})]),a("g",{attrs:{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"}},[a("g",{attrs:{"data-mml-node":"math"}},[a("g",{attrs:{"data-mml-node":"msub"}},[a("g",{attrs:{"data-mml-node":"mi"}},[a("use",{attrs:{"data-c":"1D446","xlink:href":"#MJX-576-TEX-I-1D446"}})]),a("g",{attrs:{"data-mml-node":"mn",transform:"translate(646,-150) scale(0.707)"}},[a("use",{attrs:{"data-c":"32","xlink:href":"#MJX-576-TEX-N-32"}})])])])])])]),t._v(" 必须在 XMM 寄存器中")],1)])]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("条件码")]),t._v(" "),a("ul",[a("li",[t._v("浮点比较指令会设置如下 3 个条件码\n"),a("ul",[a("li",[a("code",[t._v("ZF")])]),t._v(" "),a("li",[a("code",[t._v("CF")])]),t._v(" "),a("li",[a("code",[t._v("PF")]),t._v(" "),a("ul",[a("li",[t._v("为奇偶标志位")]),t._v(" "),a("li",[t._v("对于整数操作，当最近一次运算产生的值的最低位字节是偶校验的，则会设置这个标志位\n"),a("ul",[a("li",[t._v("偶校验是指字节中有偶数个 1")])])]),t._v(" "),a("li",[t._v("对于浮点比较，则当两个操作数中的任一个是 "),a("code",[t._v("NaN")]),t._v(" 时，就会设置该位")]),t._v(" "),a("li",[a("code",[t._v("jp(jump on parity)")]),t._v(" 是针对此标志位的条件跳转")])])])])]),t._v(" "),a("li",[a("details",{staticClass:"custom-block details"},[a("summary",[t._v("条件码的设置条件")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/sbwcwso/PicBed/master/20220112072333.png",alt:"20220112072333"}})]),t._v(" "),a("ul",[a("li",[t._v("注意当任一操作数为 "),a("code",[t._v("NaN")]),t._v(" 时， "),a("code",[t._v("jb")]),t._v("、 "),a("code",[t._v("je")]),t._v(" 和 "),a("code",[t._v("jbe")]),t._v(" 都会发生跳转，参照 "),a("a",{attrs:{href:"#363-%E8%B7%B3%E8%BD%AC%E6%8C%87%E4%BB%A4"}},[t._v("跳转指令")]),t._v(" "),a("ul",[a("li",[t._v("因为无序时其会设置 "),a("code",[t._v("CF")]),t._v(" 和 "),a("code",[t._v("ZF")]),t._v(" 为 "),a("code",[t._v("1")])])])])])])])])]),t._v(" "),a("h3",{attrs:{id:"3117-对浮点代码的观察结论"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#3117-对浮点代码的观察结论"}},[t._v("#")]),t._v(" 3.11.7 对浮点代码的观察结论")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("ul",[a("li",[t._v("AVX2 有能力在封装好的数据上执行并行操作，便计算执行得更快\n"),a("ul",[a("li",[t._v("从标量代码到并行代码的转换可以使用 GCC 支持的、操纵向量数据的 C 语言扩展，参照 P376 页")])])])])])],1)}),[],!1,null,null,null);"function"==typeof r&&r(l);s.default=l.exports}}]);