<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第 8 章 异常控制流 | mznote</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/img/note.png">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" def=""></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/d3@6"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/markmap-view"></script>
    <script src="https://cdn.jsdelivr.net/npm/react/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-XF5DN574WN"></script>
    <script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-XF5DN574WN');</script>
    <meta name="description" content="计算机基础知识博客, 个人博客">
    <meta name="keywords" content="个人技术博客,前端,技术文档,学习,c,c++,python,css3,html5,git,github,markdown">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/assets/css/0.styles.b7548b6d.css" as="style"><link rel="preload" href="/assets/js/app.095f6a1f.js" as="script"><link rel="preload" href="/assets/js/2.6bb19404.js" as="script"><link rel="preload" href="/assets/js/3.6d4bd9fe.js" as="script"><link rel="preload" href="/assets/js/102.7d38a1c6.js" as="script"><link rel="prefetch" href="/assets/js/10.494491dd.js"><link rel="prefetch" href="/assets/js/100.445a49dc.js"><link rel="prefetch" href="/assets/js/101.1d120680.js"><link rel="prefetch" href="/assets/js/103.33d325d0.js"><link rel="prefetch" href="/assets/js/104.94fbd3e4.js"><link rel="prefetch" href="/assets/js/105.5041358a.js"><link rel="prefetch" href="/assets/js/106.ecbd6f91.js"><link rel="prefetch" href="/assets/js/107.61002796.js"><link rel="prefetch" href="/assets/js/108.663b0f72.js"><link rel="prefetch" href="/assets/js/109.65ca5949.js"><link rel="prefetch" href="/assets/js/11.3b561095.js"><link rel="prefetch" href="/assets/js/110.79e92a1e.js"><link rel="prefetch" href="/assets/js/111.6ebb7462.js"><link rel="prefetch" href="/assets/js/112.89ec46d8.js"><link rel="prefetch" href="/assets/js/113.a8de6828.js"><link rel="prefetch" href="/assets/js/114.84e36fe5.js"><link rel="prefetch" href="/assets/js/115.fb5f54e6.js"><link rel="prefetch" href="/assets/js/116.3abf0f89.js"><link rel="prefetch" href="/assets/js/117.7f428d6c.js"><link rel="prefetch" href="/assets/js/118.9c0b2ba8.js"><link rel="prefetch" href="/assets/js/119.08d71f5c.js"><link rel="prefetch" href="/assets/js/12.c5d338bc.js"><link rel="prefetch" href="/assets/js/120.e5cdff04.js"><link rel="prefetch" href="/assets/js/121.aec618f0.js"><link rel="prefetch" href="/assets/js/122.ad75fdea.js"><link rel="prefetch" href="/assets/js/123.be419d92.js"><link rel="prefetch" href="/assets/js/124.287b7fef.js"><link rel="prefetch" href="/assets/js/125.1ce6a62e.js"><link rel="prefetch" href="/assets/js/126.61c19597.js"><link rel="prefetch" href="/assets/js/127.3a39216d.js"><link rel="prefetch" href="/assets/js/128.d0796efe.js"><link rel="prefetch" href="/assets/js/129.674ca3bf.js"><link rel="prefetch" href="/assets/js/13.89018181.js"><link rel="prefetch" href="/assets/js/130.a196f0ff.js"><link rel="prefetch" href="/assets/js/131.5ceae5b3.js"><link rel="prefetch" href="/assets/js/132.1f1df86b.js"><link rel="prefetch" href="/assets/js/133.5ff23d0c.js"><link rel="prefetch" href="/assets/js/134.d48d2bfb.js"><link rel="prefetch" href="/assets/js/135.034f0e0f.js"><link rel="prefetch" href="/assets/js/136.004d8b5b.js"><link rel="prefetch" href="/assets/js/137.d85175ad.js"><link rel="prefetch" href="/assets/js/138.8e156841.js"><link rel="prefetch" href="/assets/js/139.ac8f1585.js"><link rel="prefetch" href="/assets/js/14.bc808c38.js"><link rel="prefetch" href="/assets/js/140.de8cdddc.js"><link rel="prefetch" href="/assets/js/141.531b6dd2.js"><link rel="prefetch" href="/assets/js/142.f2235d30.js"><link rel="prefetch" href="/assets/js/143.71ad6ab0.js"><link rel="prefetch" href="/assets/js/144.2bbd7bed.js"><link rel="prefetch" href="/assets/js/145.bacdda91.js"><link rel="prefetch" href="/assets/js/146.17b42b03.js"><link rel="prefetch" href="/assets/js/147.deed8eea.js"><link rel="prefetch" href="/assets/js/148.4cda262d.js"><link rel="prefetch" href="/assets/js/149.3efd5184.js"><link rel="prefetch" href="/assets/js/15.0b48cdef.js"><link rel="prefetch" href="/assets/js/150.b2cd8144.js"><link rel="prefetch" href="/assets/js/151.b0cecdb1.js"><link rel="prefetch" href="/assets/js/152.29206387.js"><link rel="prefetch" href="/assets/js/153.f48bceb4.js"><link rel="prefetch" href="/assets/js/154.1e4a452e.js"><link rel="prefetch" href="/assets/js/155.44a5d1d2.js"><link rel="prefetch" href="/assets/js/156.06967467.js"><link rel="prefetch" href="/assets/js/157.edb441f9.js"><link rel="prefetch" href="/assets/js/158.d50e91dc.js"><link rel="prefetch" href="/assets/js/159.292cf499.js"><link rel="prefetch" href="/assets/js/16.43137832.js"><link rel="prefetch" href="/assets/js/160.6d859c92.js"><link rel="prefetch" href="/assets/js/161.46411040.js"><link rel="prefetch" href="/assets/js/162.eb19ae85.js"><link rel="prefetch" href="/assets/js/163.1c9f0ce4.js"><link rel="prefetch" href="/assets/js/164.127bd326.js"><link rel="prefetch" href="/assets/js/165.010f558e.js"><link rel="prefetch" href="/assets/js/166.1ada777c.js"><link rel="prefetch" href="/assets/js/167.f825f7e3.js"><link rel="prefetch" href="/assets/js/168.5e679311.js"><link rel="prefetch" href="/assets/js/169.08ca9e36.js"><link rel="prefetch" href="/assets/js/17.1236efa3.js"><link rel="prefetch" href="/assets/js/170.ffcdd3bb.js"><link rel="prefetch" href="/assets/js/171.1cff3d08.js"><link rel="prefetch" href="/assets/js/172.8e22c29c.js"><link rel="prefetch" href="/assets/js/173.14d0b4cb.js"><link rel="prefetch" href="/assets/js/174.12a70c34.js"><link rel="prefetch" href="/assets/js/175.76382f27.js"><link rel="prefetch" href="/assets/js/176.7df0d862.js"><link rel="prefetch" href="/assets/js/177.05db80cf.js"><link rel="prefetch" href="/assets/js/178.456f29eb.js"><link rel="prefetch" href="/assets/js/179.7f4c20a2.js"><link rel="prefetch" href="/assets/js/18.b1c77070.js"><link rel="prefetch" href="/assets/js/180.fda6f184.js"><link rel="prefetch" href="/assets/js/181.839acd60.js"><link rel="prefetch" href="/assets/js/182.b7b6a43f.js"><link rel="prefetch" href="/assets/js/183.ab2f05d8.js"><link rel="prefetch" href="/assets/js/184.fad21c92.js"><link rel="prefetch" href="/assets/js/185.d24a44da.js"><link rel="prefetch" href="/assets/js/186.9d066e53.js"><link rel="prefetch" href="/assets/js/187.96e7bdd8.js"><link rel="prefetch" href="/assets/js/188.c13b3ed3.js"><link rel="prefetch" href="/assets/js/189.879efb22.js"><link rel="prefetch" href="/assets/js/19.d79c58a1.js"><link rel="prefetch" href="/assets/js/190.a7096791.js"><link rel="prefetch" href="/assets/js/191.9e78de26.js"><link rel="prefetch" href="/assets/js/192.3b4df334.js"><link rel="prefetch" href="/assets/js/193.f9a14cad.js"><link rel="prefetch" href="/assets/js/194.9ed427d7.js"><link rel="prefetch" href="/assets/js/195.ee62ad15.js"><link rel="prefetch" href="/assets/js/196.5eadb168.js"><link rel="prefetch" href="/assets/js/197.19cb6f7b.js"><link rel="prefetch" href="/assets/js/198.33798b2a.js"><link rel="prefetch" href="/assets/js/199.c3cf1fe3.js"><link rel="prefetch" href="/assets/js/20.dd41c2ed.js"><link rel="prefetch" href="/assets/js/200.4bb57f89.js"><link rel="prefetch" href="/assets/js/201.578612bb.js"><link rel="prefetch" href="/assets/js/202.d7a48484.js"><link rel="prefetch" href="/assets/js/203.d11aed73.js"><link rel="prefetch" href="/assets/js/204.e74a7f9d.js"><link rel="prefetch" href="/assets/js/205.8e68b482.js"><link rel="prefetch" href="/assets/js/206.1c7d40bd.js"><link rel="prefetch" href="/assets/js/207.abef77d7.js"><link rel="prefetch" href="/assets/js/208.b0e820df.js"><link rel="prefetch" href="/assets/js/209.a567a864.js"><link rel="prefetch" href="/assets/js/21.eea6bdce.js"><link rel="prefetch" href="/assets/js/210.02af4494.js"><link rel="prefetch" href="/assets/js/211.caf7e3fe.js"><link rel="prefetch" href="/assets/js/212.1509c5da.js"><link rel="prefetch" href="/assets/js/213.25d1fe48.js"><link rel="prefetch" href="/assets/js/214.c49b28fe.js"><link rel="prefetch" href="/assets/js/215.43d106a8.js"><link rel="prefetch" href="/assets/js/216.97ed69f8.js"><link rel="prefetch" href="/assets/js/217.189b5316.js"><link rel="prefetch" href="/assets/js/218.f8eec35b.js"><link rel="prefetch" href="/assets/js/219.917288c7.js"><link rel="prefetch" href="/assets/js/22.ff0c971e.js"><link rel="prefetch" href="/assets/js/220.1ee01431.js"><link rel="prefetch" href="/assets/js/221.2f54ce07.js"><link rel="prefetch" href="/assets/js/222.9905809e.js"><link rel="prefetch" href="/assets/js/223.8c3f0494.js"><link rel="prefetch" href="/assets/js/224.ae6e47e8.js"><link rel="prefetch" href="/assets/js/225.c9ae592f.js"><link rel="prefetch" href="/assets/js/226.3b025908.js"><link rel="prefetch" href="/assets/js/227.6f4e9a52.js"><link rel="prefetch" href="/assets/js/228.ca0cfe8b.js"><link rel="prefetch" href="/assets/js/229.3433290b.js"><link rel="prefetch" href="/assets/js/23.ca2349d0.js"><link rel="prefetch" href="/assets/js/230.efb73cea.js"><link rel="prefetch" href="/assets/js/231.7b4b904f.js"><link rel="prefetch" href="/assets/js/232.1f3a96cd.js"><link rel="prefetch" href="/assets/js/233.53d419ad.js"><link rel="prefetch" href="/assets/js/234.0dc63c2c.js"><link rel="prefetch" href="/assets/js/235.130f09e8.js"><link rel="prefetch" href="/assets/js/236.af6fda35.js"><link rel="prefetch" href="/assets/js/237.c61e25ba.js"><link rel="prefetch" href="/assets/js/238.0ad2ec5f.js"><link rel="prefetch" href="/assets/js/239.e649c2a6.js"><link rel="prefetch" href="/assets/js/24.7abc0828.js"><link rel="prefetch" href="/assets/js/240.ae9d9ac3.js"><link rel="prefetch" href="/assets/js/241.7df959df.js"><link rel="prefetch" href="/assets/js/242.4ae5abf9.js"><link rel="prefetch" href="/assets/js/243.b9bfcba5.js"><link rel="prefetch" href="/assets/js/244.14e35685.js"><link rel="prefetch" href="/assets/js/245.fa48c854.js"><link rel="prefetch" href="/assets/js/246.56ec32b5.js"><link rel="prefetch" href="/assets/js/247.d7eef1f1.js"><link rel="prefetch" href="/assets/js/248.5b71c9af.js"><link rel="prefetch" href="/assets/js/249.f9f5e0ec.js"><link rel="prefetch" href="/assets/js/25.78279337.js"><link rel="prefetch" href="/assets/js/250.3c7a188c.js"><link rel="prefetch" href="/assets/js/251.fa1f591f.js"><link rel="prefetch" href="/assets/js/252.9840ca7b.js"><link rel="prefetch" href="/assets/js/253.9bec1d1d.js"><link rel="prefetch" href="/assets/js/254.501ec471.js"><link rel="prefetch" href="/assets/js/255.2b24b056.js"><link rel="prefetch" href="/assets/js/256.25cda263.js"><link rel="prefetch" href="/assets/js/257.00f5862c.js"><link rel="prefetch" href="/assets/js/258.7b0a0fe7.js"><link rel="prefetch" href="/assets/js/259.9065e975.js"><link rel="prefetch" href="/assets/js/26.317c2e67.js"><link rel="prefetch" href="/assets/js/260.1e2db99f.js"><link rel="prefetch" href="/assets/js/261.45463f74.js"><link rel="prefetch" href="/assets/js/262.780183d7.js"><link rel="prefetch" href="/assets/js/263.71e994c1.js"><link rel="prefetch" href="/assets/js/264.51f2afd6.js"><link rel="prefetch" href="/assets/js/265.bebf5d26.js"><link rel="prefetch" href="/assets/js/266.0f1f8efe.js"><link rel="prefetch" href="/assets/js/267.780f225e.js"><link rel="prefetch" href="/assets/js/268.5fb493e2.js"><link rel="prefetch" href="/assets/js/269.3497cb87.js"><link rel="prefetch" href="/assets/js/27.b530259c.js"><link rel="prefetch" href="/assets/js/270.d08461de.js"><link rel="prefetch" href="/assets/js/271.6ea44863.js"><link rel="prefetch" href="/assets/js/272.3c81f719.js"><link rel="prefetch" href="/assets/js/273.bc63655d.js"><link rel="prefetch" href="/assets/js/274.42335b12.js"><link rel="prefetch" href="/assets/js/275.a4b0b2f6.js"><link rel="prefetch" href="/assets/js/276.8c742b20.js"><link rel="prefetch" href="/assets/js/277.9c930787.js"><link rel="prefetch" href="/assets/js/278.a7086dae.js"><link rel="prefetch" href="/assets/js/279.bfccffdd.js"><link rel="prefetch" href="/assets/js/28.8579f37b.js"><link rel="prefetch" href="/assets/js/280.7d5c0869.js"><link rel="prefetch" href="/assets/js/281.0c13798e.js"><link rel="prefetch" href="/assets/js/282.78bb2100.js"><link rel="prefetch" href="/assets/js/283.102a9ac9.js"><link rel="prefetch" href="/assets/js/284.9c65d687.js"><link rel="prefetch" href="/assets/js/285.46df33cb.js"><link rel="prefetch" href="/assets/js/286.d5334f4a.js"><link rel="prefetch" href="/assets/js/287.b56768ba.js"><link rel="prefetch" href="/assets/js/288.4e8672cf.js"><link rel="prefetch" href="/assets/js/289.3b512333.js"><link rel="prefetch" href="/assets/js/29.4b34cb2e.js"><link rel="prefetch" href="/assets/js/290.13f5cb4f.js"><link rel="prefetch" href="/assets/js/291.9442af0c.js"><link rel="prefetch" href="/assets/js/292.fe087795.js"><link rel="prefetch" href="/assets/js/293.aca3b34f.js"><link rel="prefetch" href="/assets/js/294.c4a0d801.js"><link rel="prefetch" href="/assets/js/295.307848e1.js"><link rel="prefetch" href="/assets/js/296.9303a7fd.js"><link rel="prefetch" href="/assets/js/297.97b72c2d.js"><link rel="prefetch" href="/assets/js/298.304f4b36.js"><link rel="prefetch" href="/assets/js/299.f0f15709.js"><link rel="prefetch" href="/assets/js/30.801059de.js"><link rel="prefetch" href="/assets/js/300.4629592a.js"><link rel="prefetch" href="/assets/js/301.df68b2bd.js"><link rel="prefetch" href="/assets/js/302.3ed42c51.js"><link rel="prefetch" href="/assets/js/303.78b9243b.js"><link rel="prefetch" href="/assets/js/304.2956c5ab.js"><link rel="prefetch" href="/assets/js/305.626ccbda.js"><link rel="prefetch" href="/assets/js/306.72ce3f1d.js"><link rel="prefetch" href="/assets/js/307.db6afaf3.js"><link rel="prefetch" href="/assets/js/308.80a3800c.js"><link rel="prefetch" href="/assets/js/309.13b3f8b1.js"><link rel="prefetch" href="/assets/js/31.6710aa93.js"><link rel="prefetch" href="/assets/js/310.6333970d.js"><link rel="prefetch" href="/assets/js/311.e45ad1b0.js"><link rel="prefetch" href="/assets/js/312.cd1f4ba3.js"><link rel="prefetch" href="/assets/js/313.90ab428b.js"><link rel="prefetch" href="/assets/js/314.eb920c76.js"><link rel="prefetch" href="/assets/js/315.14575706.js"><link rel="prefetch" href="/assets/js/316.da5dc340.js"><link rel="prefetch" href="/assets/js/317.7447df2d.js"><link rel="prefetch" href="/assets/js/318.891c52cd.js"><link rel="prefetch" href="/assets/js/319.56c19bd9.js"><link rel="prefetch" href="/assets/js/32.b9f02dcb.js"><link rel="prefetch" href="/assets/js/320.bc490a46.js"><link rel="prefetch" href="/assets/js/321.24b2a71e.js"><link rel="prefetch" href="/assets/js/322.735d4197.js"><link rel="prefetch" href="/assets/js/323.a9c788f0.js"><link rel="prefetch" href="/assets/js/324.0827164a.js"><link rel="prefetch" href="/assets/js/325.902ab440.js"><link rel="prefetch" href="/assets/js/326.76f9509e.js"><link rel="prefetch" href="/assets/js/327.b1155a77.js"><link rel="prefetch" href="/assets/js/328.d888aec4.js"><link rel="prefetch" href="/assets/js/329.6ff51aa8.js"><link rel="prefetch" href="/assets/js/33.16e702fa.js"><link rel="prefetch" href="/assets/js/330.793a12c0.js"><link rel="prefetch" href="/assets/js/331.d939f25b.js"><link rel="prefetch" href="/assets/js/332.1b358cc1.js"><link rel="prefetch" href="/assets/js/333.2c0791ff.js"><link rel="prefetch" href="/assets/js/334.9c7488c6.js"><link rel="prefetch" href="/assets/js/335.69a6e4d2.js"><link rel="prefetch" href="/assets/js/336.924e2aa5.js"><link rel="prefetch" href="/assets/js/337.7bb62c80.js"><link rel="prefetch" href="/assets/js/338.cfa5930a.js"><link rel="prefetch" href="/assets/js/339.3568d177.js"><link rel="prefetch" href="/assets/js/34.7e8835da.js"><link rel="prefetch" href="/assets/js/340.82a4d9b8.js"><link rel="prefetch" href="/assets/js/341.f191985d.js"><link rel="prefetch" href="/assets/js/342.46cb268d.js"><link rel="prefetch" href="/assets/js/343.c5c2ec3a.js"><link rel="prefetch" href="/assets/js/344.7d3b5d58.js"><link rel="prefetch" href="/assets/js/345.7cd2a55a.js"><link rel="prefetch" href="/assets/js/346.1d67532d.js"><link rel="prefetch" href="/assets/js/347.e5746dbe.js"><link rel="prefetch" href="/assets/js/348.54850172.js"><link rel="prefetch" href="/assets/js/349.696a8b0a.js"><link rel="prefetch" href="/assets/js/35.afc00612.js"><link rel="prefetch" href="/assets/js/350.7d3afa7e.js"><link rel="prefetch" href="/assets/js/351.bc7aaf03.js"><link rel="prefetch" href="/assets/js/352.7e3238ce.js"><link rel="prefetch" href="/assets/js/353.4c200924.js"><link rel="prefetch" href="/assets/js/354.2bf378ee.js"><link rel="prefetch" href="/assets/js/355.8c826b92.js"><link rel="prefetch" href="/assets/js/356.2f11fc87.js"><link rel="prefetch" href="/assets/js/357.f6c43c27.js"><link rel="prefetch" href="/assets/js/358.062234c4.js"><link rel="prefetch" href="/assets/js/359.cdfd0d09.js"><link rel="prefetch" href="/assets/js/36.db4b98e4.js"><link rel="prefetch" href="/assets/js/360.ed79bd84.js"><link rel="prefetch" href="/assets/js/361.20be9591.js"><link rel="prefetch" href="/assets/js/362.366bda21.js"><link rel="prefetch" href="/assets/js/363.38340179.js"><link rel="prefetch" href="/assets/js/364.0d9a33d7.js"><link rel="prefetch" href="/assets/js/365.e52c5af6.js"><link rel="prefetch" href="/assets/js/366.80eeffd8.js"><link rel="prefetch" href="/assets/js/367.cfd266f9.js"><link rel="prefetch" href="/assets/js/368.bd3cc78d.js"><link rel="prefetch" href="/assets/js/369.b568de16.js"><link rel="prefetch" href="/assets/js/37.9fbc5926.js"><link rel="prefetch" href="/assets/js/370.8865233a.js"><link rel="prefetch" href="/assets/js/371.56772f61.js"><link rel="prefetch" href="/assets/js/372.d4c2cf3e.js"><link rel="prefetch" href="/assets/js/373.997d462c.js"><link rel="prefetch" href="/assets/js/374.4e8bbb79.js"><link rel="prefetch" href="/assets/js/375.4fe8075a.js"><link rel="prefetch" href="/assets/js/376.42e8f3bb.js"><link rel="prefetch" href="/assets/js/377.72220464.js"><link rel="prefetch" href="/assets/js/378.45808f14.js"><link rel="prefetch" href="/assets/js/379.446d58c4.js"><link rel="prefetch" href="/assets/js/38.abff2811.js"><link rel="prefetch" href="/assets/js/380.930f5de1.js"><link rel="prefetch" href="/assets/js/381.f5385e93.js"><link rel="prefetch" href="/assets/js/382.d3551ecd.js"><link rel="prefetch" href="/assets/js/383.4344d201.js"><link rel="prefetch" href="/assets/js/384.6b86db19.js"><link rel="prefetch" href="/assets/js/385.6491cce1.js"><link rel="prefetch" href="/assets/js/386.69c9b62b.js"><link rel="prefetch" href="/assets/js/387.55ddd1af.js"><link rel="prefetch" href="/assets/js/388.e62fd98d.js"><link rel="prefetch" href="/assets/js/389.487083d1.js"><link rel="prefetch" href="/assets/js/39.de548a46.js"><link rel="prefetch" href="/assets/js/390.4ebe9975.js"><link rel="prefetch" href="/assets/js/391.2adb910a.js"><link rel="prefetch" href="/assets/js/392.cca72635.js"><link rel="prefetch" href="/assets/js/393.9b1c2435.js"><link rel="prefetch" href="/assets/js/394.d85b4431.js"><link rel="prefetch" href="/assets/js/395.d3288ae2.js"><link rel="prefetch" href="/assets/js/396.b3bfe727.js"><link rel="prefetch" href="/assets/js/397.8e8c329f.js"><link rel="prefetch" href="/assets/js/398.18d752d3.js"><link rel="prefetch" href="/assets/js/399.060021a5.js"><link rel="prefetch" href="/assets/js/4.289dc493.js"><link rel="prefetch" href="/assets/js/40.155c5f23.js"><link rel="prefetch" href="/assets/js/400.d0ec2779.js"><link rel="prefetch" href="/assets/js/401.aae12d2c.js"><link rel="prefetch" href="/assets/js/402.4c1e36ee.js"><link rel="prefetch" href="/assets/js/403.27b40602.js"><link rel="prefetch" href="/assets/js/404.f1e342ca.js"><link rel="prefetch" href="/assets/js/405.8b78b984.js"><link rel="prefetch" href="/assets/js/406.6175a4f4.js"><link rel="prefetch" href="/assets/js/407.49b22b20.js"><link rel="prefetch" href="/assets/js/408.917027d3.js"><link rel="prefetch" href="/assets/js/409.ef934658.js"><link rel="prefetch" href="/assets/js/41.9d17ef6e.js"><link rel="prefetch" href="/assets/js/410.4394cdfa.js"><link rel="prefetch" href="/assets/js/411.639427b2.js"><link rel="prefetch" href="/assets/js/412.39fa66e7.js"><link rel="prefetch" href="/assets/js/413.655206dd.js"><link rel="prefetch" href="/assets/js/414.9c71744c.js"><link rel="prefetch" href="/assets/js/415.815804fb.js"><link rel="prefetch" href="/assets/js/416.f16833eb.js"><link rel="prefetch" href="/assets/js/417.e36ce3b2.js"><link rel="prefetch" href="/assets/js/418.13401265.js"><link rel="prefetch" href="/assets/js/419.fb48320b.js"><link rel="prefetch" href="/assets/js/42.ea0dd33b.js"><link rel="prefetch" href="/assets/js/420.e7d0acc3.js"><link rel="prefetch" href="/assets/js/421.f0974b18.js"><link rel="prefetch" href="/assets/js/422.71bb1214.js"><link rel="prefetch" href="/assets/js/423.2933f26c.js"><link rel="prefetch" href="/assets/js/424.d73e5d07.js"><link rel="prefetch" href="/assets/js/425.76efc0b6.js"><link rel="prefetch" href="/assets/js/426.f3cc0d4e.js"><link rel="prefetch" href="/assets/js/427.f460718e.js"><link rel="prefetch" href="/assets/js/428.7a2e0b51.js"><link rel="prefetch" href="/assets/js/429.d396e33b.js"><link rel="prefetch" href="/assets/js/43.a4bcd5c1.js"><link rel="prefetch" href="/assets/js/430.cd2c1221.js"><link rel="prefetch" href="/assets/js/431.41d92cf2.js"><link rel="prefetch" href="/assets/js/432.4c961f1e.js"><link rel="prefetch" href="/assets/js/433.fd9590fb.js"><link rel="prefetch" href="/assets/js/434.a071a883.js"><link rel="prefetch" href="/assets/js/435.b43d72f5.js"><link rel="prefetch" href="/assets/js/436.b6cc4c7e.js"><link rel="prefetch" href="/assets/js/437.b82f1ba6.js"><link rel="prefetch" href="/assets/js/438.c7cdd003.js"><link rel="prefetch" href="/assets/js/439.62205b84.js"><link rel="prefetch" href="/assets/js/44.60a3a5c4.js"><link rel="prefetch" href="/assets/js/440.1bb4c051.js"><link rel="prefetch" href="/assets/js/441.bb2ab767.js"><link rel="prefetch" href="/assets/js/442.fd634853.js"><link rel="prefetch" href="/assets/js/443.2c83c8a0.js"><link rel="prefetch" href="/assets/js/444.2a65abd8.js"><link rel="prefetch" href="/assets/js/445.c67e96eb.js"><link rel="prefetch" href="/assets/js/446.1f229940.js"><link rel="prefetch" href="/assets/js/447.bdda1c4c.js"><link rel="prefetch" href="/assets/js/448.dc52e6f4.js"><link rel="prefetch" href="/assets/js/449.23958348.js"><link rel="prefetch" href="/assets/js/45.4ecc9166.js"><link rel="prefetch" href="/assets/js/450.7ea48cd3.js"><link rel="prefetch" href="/assets/js/451.2f4ef468.js"><link rel="prefetch" href="/assets/js/452.232a3747.js"><link rel="prefetch" href="/assets/js/453.c19c9493.js"><link rel="prefetch" href="/assets/js/454.10ef5ecd.js"><link rel="prefetch" href="/assets/js/455.8b534044.js"><link rel="prefetch" href="/assets/js/456.97cc7756.js"><link rel="prefetch" href="/assets/js/457.47caf365.js"><link rel="prefetch" href="/assets/js/458.b642097f.js"><link rel="prefetch" href="/assets/js/459.6c0f0bab.js"><link rel="prefetch" href="/assets/js/46.a2a97498.js"><link rel="prefetch" href="/assets/js/460.d4b716da.js"><link rel="prefetch" href="/assets/js/461.b3bc6aa1.js"><link rel="prefetch" href="/assets/js/462.261958e2.js"><link rel="prefetch" href="/assets/js/463.d2522029.js"><link rel="prefetch" href="/assets/js/464.fc287b93.js"><link rel="prefetch" href="/assets/js/465.e1b6a702.js"><link rel="prefetch" href="/assets/js/466.603fd881.js"><link rel="prefetch" href="/assets/js/467.4be682df.js"><link rel="prefetch" href="/assets/js/468.867411e9.js"><link rel="prefetch" href="/assets/js/469.9abd953c.js"><link rel="prefetch" href="/assets/js/47.2f079d35.js"><link rel="prefetch" href="/assets/js/470.57efab94.js"><link rel="prefetch" href="/assets/js/471.986e8f8c.js"><link rel="prefetch" href="/assets/js/472.06c4fa13.js"><link rel="prefetch" href="/assets/js/473.bb917d33.js"><link rel="prefetch" href="/assets/js/474.a96a06da.js"><link rel="prefetch" href="/assets/js/475.be817991.js"><link rel="prefetch" href="/assets/js/476.d8e6aab7.js"><link rel="prefetch" href="/assets/js/477.8a154034.js"><link rel="prefetch" href="/assets/js/478.74ab706c.js"><link rel="prefetch" href="/assets/js/479.c68341d9.js"><link rel="prefetch" href="/assets/js/48.5eeb8a44.js"><link rel="prefetch" href="/assets/js/480.d8f2fef3.js"><link rel="prefetch" href="/assets/js/481.3b1e928d.js"><link rel="prefetch" href="/assets/js/482.fd62d7b9.js"><link rel="prefetch" href="/assets/js/483.644a32e4.js"><link rel="prefetch" href="/assets/js/484.2c56c65a.js"><link rel="prefetch" href="/assets/js/485.75f8e02c.js"><link rel="prefetch" href="/assets/js/486.f169c4a6.js"><link rel="prefetch" href="/assets/js/487.c0fc1d0e.js"><link rel="prefetch" href="/assets/js/488.2450c255.js"><link rel="prefetch" href="/assets/js/489.36f0d0ed.js"><link rel="prefetch" href="/assets/js/49.43b5a8fe.js"><link rel="prefetch" href="/assets/js/490.c0fbfc79.js"><link rel="prefetch" href="/assets/js/491.4ef937f8.js"><link rel="prefetch" href="/assets/js/492.814248ac.js"><link rel="prefetch" href="/assets/js/493.65c8c9ff.js"><link rel="prefetch" href="/assets/js/494.e9fd53b1.js"><link rel="prefetch" href="/assets/js/495.06ce1b89.js"><link rel="prefetch" href="/assets/js/496.6ef29da3.js"><link rel="prefetch" href="/assets/js/497.d2b567f2.js"><link rel="prefetch" href="/assets/js/498.a696783a.js"><link rel="prefetch" href="/assets/js/499.3519597a.js"><link rel="prefetch" href="/assets/js/5.bdbe3014.js"><link rel="prefetch" href="/assets/js/50.51e57417.js"><link rel="prefetch" href="/assets/js/500.2da4db9f.js"><link rel="prefetch" href="/assets/js/501.9e84d79d.js"><link rel="prefetch" href="/assets/js/502.0b1f1ee6.js"><link rel="prefetch" href="/assets/js/503.16853c6e.js"><link rel="prefetch" href="/assets/js/504.01ff87fe.js"><link rel="prefetch" href="/assets/js/505.bb7450bf.js"><link rel="prefetch" href="/assets/js/506.fc2f8a19.js"><link rel="prefetch" href="/assets/js/507.6f711555.js"><link rel="prefetch" href="/assets/js/508.35c48a49.js"><link rel="prefetch" href="/assets/js/509.221af1e6.js"><link rel="prefetch" href="/assets/js/51.aef419f4.js"><link rel="prefetch" href="/assets/js/510.c96e4dc0.js"><link rel="prefetch" href="/assets/js/511.a1d377ff.js"><link rel="prefetch" href="/assets/js/512.88776012.js"><link rel="prefetch" href="/assets/js/513.c708de91.js"><link rel="prefetch" href="/assets/js/514.db14718e.js"><link rel="prefetch" href="/assets/js/515.879b8ccc.js"><link rel="prefetch" href="/assets/js/516.7152f397.js"><link rel="prefetch" href="/assets/js/517.21928a12.js"><link rel="prefetch" href="/assets/js/518.b6368128.js"><link rel="prefetch" href="/assets/js/519.d4c0d627.js"><link rel="prefetch" href="/assets/js/52.0ea32a87.js"><link rel="prefetch" href="/assets/js/520.7261308b.js"><link rel="prefetch" href="/assets/js/521.effa00ad.js"><link rel="prefetch" href="/assets/js/522.7922068d.js"><link rel="prefetch" href="/assets/js/523.ca05bb88.js"><link rel="prefetch" href="/assets/js/524.847464a8.js"><link rel="prefetch" href="/assets/js/525.6ea37be1.js"><link rel="prefetch" href="/assets/js/526.c2ffdc32.js"><link rel="prefetch" href="/assets/js/527.a42e0cb4.js"><link rel="prefetch" href="/assets/js/528.3036c125.js"><link rel="prefetch" href="/assets/js/529.5f35b218.js"><link rel="prefetch" href="/assets/js/53.a675003b.js"><link rel="prefetch" href="/assets/js/530.32e6ff9a.js"><link rel="prefetch" href="/assets/js/531.1d052765.js"><link rel="prefetch" href="/assets/js/532.e193e281.js"><link rel="prefetch" href="/assets/js/533.46144301.js"><link rel="prefetch" href="/assets/js/534.527e1550.js"><link rel="prefetch" href="/assets/js/535.48d8f2ef.js"><link rel="prefetch" href="/assets/js/536.daa89088.js"><link rel="prefetch" href="/assets/js/537.754ebdfe.js"><link rel="prefetch" href="/assets/js/538.29948ac3.js"><link rel="prefetch" href="/assets/js/539.7ee98087.js"><link rel="prefetch" href="/assets/js/54.69b15868.js"><link rel="prefetch" href="/assets/js/540.bb605d82.js"><link rel="prefetch" href="/assets/js/541.3c1a92e4.js"><link rel="prefetch" href="/assets/js/542.f720dc45.js"><link rel="prefetch" href="/assets/js/543.e3300b33.js"><link rel="prefetch" href="/assets/js/544.aa2be3bc.js"><link rel="prefetch" href="/assets/js/545.1be71ebc.js"><link rel="prefetch" href="/assets/js/546.2ae30677.js"><link rel="prefetch" href="/assets/js/547.f1eb5c82.js"><link rel="prefetch" href="/assets/js/548.afe053b3.js"><link rel="prefetch" href="/assets/js/549.0fa20de2.js"><link rel="prefetch" href="/assets/js/55.16e31180.js"><link rel="prefetch" href="/assets/js/550.d1218c6b.js"><link rel="prefetch" href="/assets/js/551.03bbe561.js"><link rel="prefetch" href="/assets/js/552.4258de00.js"><link rel="prefetch" href="/assets/js/553.fae22d64.js"><link rel="prefetch" href="/assets/js/554.a1de6989.js"><link rel="prefetch" href="/assets/js/555.89299f39.js"><link rel="prefetch" href="/assets/js/556.b3a3e1bf.js"><link rel="prefetch" href="/assets/js/557.7571494d.js"><link rel="prefetch" href="/assets/js/558.39dcf4cc.js"><link rel="prefetch" href="/assets/js/559.35b2ac5d.js"><link rel="prefetch" href="/assets/js/56.b0c4f131.js"><link rel="prefetch" href="/assets/js/560.a24a7313.js"><link rel="prefetch" href="/assets/js/561.824ea25f.js"><link rel="prefetch" href="/assets/js/562.a814d4ff.js"><link rel="prefetch" href="/assets/js/563.7b26c068.js"><link rel="prefetch" href="/assets/js/564.69a310f3.js"><link rel="prefetch" href="/assets/js/565.1574e33b.js"><link rel="prefetch" href="/assets/js/566.13564bd4.js"><link rel="prefetch" href="/assets/js/567.469eb27c.js"><link rel="prefetch" href="/assets/js/568.a21fc9be.js"><link rel="prefetch" href="/assets/js/569.9451d87f.js"><link rel="prefetch" href="/assets/js/57.cc5907e3.js"><link rel="prefetch" href="/assets/js/570.23a93abd.js"><link rel="prefetch" href="/assets/js/571.329379b7.js"><link rel="prefetch" href="/assets/js/572.8eae719e.js"><link rel="prefetch" href="/assets/js/573.e9f66fb2.js"><link rel="prefetch" href="/assets/js/574.13437590.js"><link rel="prefetch" href="/assets/js/575.89a62043.js"><link rel="prefetch" href="/assets/js/576.c65ea9c1.js"><link rel="prefetch" href="/assets/js/577.3feeffe3.js"><link rel="prefetch" href="/assets/js/578.1e3a138e.js"><link rel="prefetch" href="/assets/js/579.99e0d91b.js"><link rel="prefetch" href="/assets/js/58.f18a0092.js"><link rel="prefetch" href="/assets/js/580.14d6039b.js"><link rel="prefetch" href="/assets/js/581.673167b5.js"><link rel="prefetch" href="/assets/js/582.f5d7d5a1.js"><link rel="prefetch" href="/assets/js/583.cbd2660c.js"><link rel="prefetch" href="/assets/js/584.ce096077.js"><link rel="prefetch" href="/assets/js/585.03aa88fc.js"><link rel="prefetch" href="/assets/js/586.05599247.js"><link rel="prefetch" href="/assets/js/587.05947a43.js"><link rel="prefetch" href="/assets/js/588.732a8f38.js"><link rel="prefetch" href="/assets/js/589.bbe25597.js"><link rel="prefetch" href="/assets/js/59.ce268dd0.js"><link rel="prefetch" href="/assets/js/590.deae8a16.js"><link rel="prefetch" href="/assets/js/591.6dda25a3.js"><link rel="prefetch" href="/assets/js/592.d0b12c8f.js"><link rel="prefetch" href="/assets/js/593.1485ac69.js"><link rel="prefetch" href="/assets/js/594.27aa9f1b.js"><link rel="prefetch" href="/assets/js/595.62dd1621.js"><link rel="prefetch" href="/assets/js/596.76ea6f8c.js"><link rel="prefetch" href="/assets/js/597.0a6db182.js"><link rel="prefetch" href="/assets/js/598.b5a7d148.js"><link rel="prefetch" href="/assets/js/599.c5d6769d.js"><link rel="prefetch" href="/assets/js/6.9180a290.js"><link rel="prefetch" href="/assets/js/60.452b59a7.js"><link rel="prefetch" href="/assets/js/600.b1118e84.js"><link rel="prefetch" href="/assets/js/601.8cb2cb8e.js"><link rel="prefetch" href="/assets/js/602.017d72ed.js"><link rel="prefetch" href="/assets/js/603.3040f246.js"><link rel="prefetch" href="/assets/js/604.e5368b8d.js"><link rel="prefetch" href="/assets/js/605.e553dced.js"><link rel="prefetch" href="/assets/js/606.ce7c0bd5.js"><link rel="prefetch" href="/assets/js/607.cf6f6fdf.js"><link rel="prefetch" href="/assets/js/608.e2118d62.js"><link rel="prefetch" href="/assets/js/609.099a7557.js"><link rel="prefetch" href="/assets/js/61.d2fd31d6.js"><link rel="prefetch" href="/assets/js/610.218a0531.js"><link rel="prefetch" href="/assets/js/611.7a61e18d.js"><link rel="prefetch" href="/assets/js/612.5e138a18.js"><link rel="prefetch" href="/assets/js/613.5d73afd8.js"><link rel="prefetch" href="/assets/js/614.d8af26b5.js"><link rel="prefetch" href="/assets/js/615.1de79450.js"><link rel="prefetch" href="/assets/js/616.9555b7dd.js"><link rel="prefetch" href="/assets/js/617.59ac4db7.js"><link rel="prefetch" href="/assets/js/618.e0b4e9d8.js"><link rel="prefetch" href="/assets/js/619.c74fbc7d.js"><link rel="prefetch" href="/assets/js/62.bfb787fa.js"><link rel="prefetch" href="/assets/js/620.6437df6e.js"><link rel="prefetch" href="/assets/js/621.cc3cb0ac.js"><link rel="prefetch" href="/assets/js/622.87c8979a.js"><link rel="prefetch" href="/assets/js/623.d284c9e3.js"><link rel="prefetch" href="/assets/js/624.fea80144.js"><link rel="prefetch" href="/assets/js/625.c3475da3.js"><link rel="prefetch" href="/assets/js/626.791c8f03.js"><link rel="prefetch" href="/assets/js/627.4ad1941b.js"><link rel="prefetch" href="/assets/js/628.9dac6ee1.js"><link rel="prefetch" href="/assets/js/629.bac92225.js"><link rel="prefetch" href="/assets/js/63.301d0aa4.js"><link rel="prefetch" href="/assets/js/630.2218fa92.js"><link rel="prefetch" href="/assets/js/631.4be1487c.js"><link rel="prefetch" href="/assets/js/632.e527e02d.js"><link rel="prefetch" href="/assets/js/633.8f2e6120.js"><link rel="prefetch" href="/assets/js/634.67cfe34b.js"><link rel="prefetch" href="/assets/js/635.98750be5.js"><link rel="prefetch" href="/assets/js/636.fc68c03d.js"><link rel="prefetch" href="/assets/js/637.b1e71f2a.js"><link rel="prefetch" href="/assets/js/638.bcc97a8e.js"><link rel="prefetch" href="/assets/js/639.d528f731.js"><link rel="prefetch" href="/assets/js/64.bf8570fc.js"><link rel="prefetch" href="/assets/js/640.68b5f79d.js"><link rel="prefetch" href="/assets/js/641.02f53b72.js"><link rel="prefetch" href="/assets/js/642.730c56e8.js"><link rel="prefetch" href="/assets/js/643.7e79d5d8.js"><link rel="prefetch" href="/assets/js/644.d3d41010.js"><link rel="prefetch" href="/assets/js/645.ef636ddd.js"><link rel="prefetch" href="/assets/js/646.499ed862.js"><link rel="prefetch" href="/assets/js/647.31e78ba4.js"><link rel="prefetch" href="/assets/js/648.6b61b9ea.js"><link rel="prefetch" href="/assets/js/649.e703d5aa.js"><link rel="prefetch" href="/assets/js/65.77132072.js"><link rel="prefetch" href="/assets/js/650.ee63cc59.js"><link rel="prefetch" href="/assets/js/651.33b9eb36.js"><link rel="prefetch" href="/assets/js/652.ef35a0a8.js"><link rel="prefetch" href="/assets/js/653.2fba33b4.js"><link rel="prefetch" href="/assets/js/654.2fce6f2b.js"><link rel="prefetch" href="/assets/js/655.aa43d15a.js"><link rel="prefetch" href="/assets/js/656.1a43a0a6.js"><link rel="prefetch" href="/assets/js/657.a4641a43.js"><link rel="prefetch" href="/assets/js/658.8a7d1c0a.js"><link rel="prefetch" href="/assets/js/659.22529255.js"><link rel="prefetch" href="/assets/js/66.15254072.js"><link rel="prefetch" href="/assets/js/660.ff29789d.js"><link rel="prefetch" href="/assets/js/661.13e524e6.js"><link rel="prefetch" href="/assets/js/662.b3fe9d78.js"><link rel="prefetch" href="/assets/js/663.fa72128b.js"><link rel="prefetch" href="/assets/js/664.8920984a.js"><link rel="prefetch" href="/assets/js/665.5c33957c.js"><link rel="prefetch" href="/assets/js/666.541f7ff0.js"><link rel="prefetch" href="/assets/js/667.9a8c270f.js"><link rel="prefetch" href="/assets/js/668.daee2330.js"><link rel="prefetch" href="/assets/js/669.08e9f304.js"><link rel="prefetch" href="/assets/js/67.17fe092c.js"><link rel="prefetch" href="/assets/js/670.6cc1963a.js"><link rel="prefetch" href="/assets/js/671.5d3d74d1.js"><link rel="prefetch" href="/assets/js/672.7c74299d.js"><link rel="prefetch" href="/assets/js/673.f6d5b553.js"><link rel="prefetch" href="/assets/js/674.2969064d.js"><link rel="prefetch" href="/assets/js/68.60afc773.js"><link rel="prefetch" href="/assets/js/69.452131e8.js"><link rel="prefetch" href="/assets/js/7.c5dab81d.js"><link rel="prefetch" href="/assets/js/70.9b3bf8ad.js"><link rel="prefetch" href="/assets/js/71.b66684c1.js"><link rel="prefetch" href="/assets/js/72.97945bdf.js"><link rel="prefetch" href="/assets/js/73.871989da.js"><link rel="prefetch" href="/assets/js/74.931a6b08.js"><link rel="prefetch" href="/assets/js/75.f59920eb.js"><link rel="prefetch" href="/assets/js/76.631f9db0.js"><link rel="prefetch" href="/assets/js/77.c36f7b96.js"><link rel="prefetch" href="/assets/js/78.2f61eda3.js"><link rel="prefetch" href="/assets/js/79.8c723213.js"><link rel="prefetch" href="/assets/js/8.1a320525.js"><link rel="prefetch" href="/assets/js/80.f2ae23ce.js"><link rel="prefetch" href="/assets/js/81.bbb60795.js"><link rel="prefetch" href="/assets/js/82.06c7ca81.js"><link rel="prefetch" href="/assets/js/83.a83fc715.js"><link rel="prefetch" href="/assets/js/84.edcd8c27.js"><link rel="prefetch" href="/assets/js/85.d31eee28.js"><link rel="prefetch" href="/assets/js/86.10ec3513.js"><link rel="prefetch" href="/assets/js/87.051fdd23.js"><link rel="prefetch" href="/assets/js/88.4f49be9c.js"><link rel="prefetch" href="/assets/js/89.59877c73.js"><link rel="prefetch" href="/assets/js/9.a9688781.js"><link rel="prefetch" href="/assets/js/90.fd306930.js"><link rel="prefetch" href="/assets/js/91.8ba84d12.js"><link rel="prefetch" href="/assets/js/92.8660a55b.js"><link rel="prefetch" href="/assets/js/93.f5aa6f9d.js"><link rel="prefetch" href="/assets/js/94.f6320e1d.js"><link rel="prefetch" href="/assets/js/95.7aee9644.js"><link rel="prefetch" href="/assets/js/96.270b077f.js"><link rel="prefetch" href="/assets/js/97.2bf3e71f.js"><link rel="prefetch" href="/assets/js/98.7925b0c9.js"><link rel="prefetch" href="/assets/js/99.d45e8282.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b7548b6d.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/note.png" alt="mznote" class="logo"> <span class="site-name can-hide">mznote</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础知识" class="dropdown-title"><a href="/knowledge/" class="link-title">基础知识</a> <span class="title" style="display:none;">基础知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/01.基础知识/10.离散数学/" class="nav-link">离散数学</a></li><li class="dropdown-item"><!----> <a href="/01.基础知识/11.具体数学/" class="nav-link">具体数学</a></li><li class="dropdown-item"><!----> <a href="/01.基础知识/12.CSAPP/" class="nav-link">CSAPP</a></li><li class="dropdown-item"><!----> <a href="/01.基础知识/13.数据结构/" class="nav-link">数据结构</a></li><li class="dropdown-item"><!----> <a href="/01.基础知识/15.算法导论/" class="nav-link">算法导论</a></li><li class="dropdown-item"><!----> <a href="/01.基础知识/17.计算机组成原理/" class="nav-link">计算机组成原理</a></li><li class="dropdown-item"><!----> <a href="/01.基础知识/20.编译原理/" class="nav-link">编译原理</a></li><li class="dropdown-item"><!----> <a href="/01.基础知识/25.计算机网络/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/01.基础知识/27.操作系统/" class="nav-link">操作系统</a></li><li class="dropdown-item"><!----> <a href="/01.基础知识/30.数据库系统/" class="nav-link">数据库系统</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程语言" class="dropdown-title"><a href="/language/" class="link-title">编程语言</a> <span class="title" style="display:none;">编程语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/02.编程语言/02.C/" class="nav-link">C</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实用技术" class="dropdown-title"><a href="/technology/" class="link-title">实用技术</a> <span class="title" style="display:none;">实用技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/03.实用技术/01.Linux/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/03.实用技术/02.VScode/" class="nav-link">VScode</a></li><li class="dropdown-item"><!----> <a href="/03.实用技术/03.GitHub/" class="nav-link">GitHub</a></li><li class="dropdown-item"><!----> <a href="/03.实用技术/19.Vuepress/" class="nav-link">Vuepress</a></li><li class="dropdown-item"><!----> <a href="/03.实用技术/20.实用工具/" class="nav-link">实用工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/99.日课/2022.2022年/01.01月/" class="nav-link">学习日课</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/sbwcwso/sbwcwso.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avatar.png"> <div class="blogger-info"><h3>木子识时务</h3> <span>CS小白，努力进步中 🏃</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础知识" class="dropdown-title"><a href="/knowledge/" class="link-title">基础知识</a> <span class="title" style="display:none;">基础知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/01.基础知识/10.离散数学/" class="nav-link">离散数学</a></li><li class="dropdown-item"><!----> <a href="/01.基础知识/11.具体数学/" class="nav-link">具体数学</a></li><li class="dropdown-item"><!----> <a href="/01.基础知识/12.CSAPP/" class="nav-link">CSAPP</a></li><li class="dropdown-item"><!----> <a href="/01.基础知识/13.数据结构/" class="nav-link">数据结构</a></li><li class="dropdown-item"><!----> <a href="/01.基础知识/15.算法导论/" class="nav-link">算法导论</a></li><li class="dropdown-item"><!----> <a href="/01.基础知识/17.计算机组成原理/" class="nav-link">计算机组成原理</a></li><li class="dropdown-item"><!----> <a href="/01.基础知识/20.编译原理/" class="nav-link">编译原理</a></li><li class="dropdown-item"><!----> <a href="/01.基础知识/25.计算机网络/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/01.基础知识/27.操作系统/" class="nav-link">操作系统</a></li><li class="dropdown-item"><!----> <a href="/01.基础知识/30.数据库系统/" class="nav-link">数据库系统</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程语言" class="dropdown-title"><a href="/language/" class="link-title">编程语言</a> <span class="title" style="display:none;">编程语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/02.编程语言/02.C/" class="nav-link">C</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实用技术" class="dropdown-title"><a href="/technology/" class="link-title">实用技术</a> <span class="title" style="display:none;">实用技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/03.实用技术/01.Linux/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/03.实用技术/02.VScode/" class="nav-link">VScode</a></li><li class="dropdown-item"><!----> <a href="/03.实用技术/03.GitHub/" class="nav-link">GitHub</a></li><li class="dropdown-item"><!----> <a href="/03.实用技术/19.Vuepress/" class="nav-link">Vuepress</a></li><li class="dropdown-item"><!----> <a href="/03.实用技术/20.实用工具/" class="nav-link">实用工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/99.日课/2022.2022年/01.01月/" class="nav-link">学习日课</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/sbwcwso/sbwcwso.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/01.%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/10.%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6/" class="sidebar-heading clickable"><span>离散数学</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/01.%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/11.%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/" class="sidebar-heading clickable"><span>具体数学</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/01.%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/12.CSAPP/" class="sidebar-heading clickable open"><span>CSAPP</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/01.%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/12.CSAPP/01.%E4%B9%A6%E6%9C%AC%E9%98%85%E8%AF%BB/" class="sidebar-heading clickable open"><span>书本阅读</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/cad752/" class="sidebar-link">第 2 章 信息的表示和处理</a></li><li><a href="/pages/306a79/" class="sidebar-link">第 3 章 程序的机器级表示</a></li><li><a href="/pages/e760c3/" class="sidebar-link">第 4 章 处理器体系结构</a></li><li><a href="/pages/ac0011/" class="sidebar-link">第 5 章 优化程序性能</a></li><li><a href="/pages/4d33d6/" class="sidebar-link">第 6 章 存储器层次结构</a></li><li><a href="/pages/c4f6e6/" class="sidebar-link">第 7 章 链接</a></li><li><a href="/pages/fb3a2a/" aria-current="page" class="active sidebar-link">第 8 章 异常控制流</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/fb3a2a/#81-异常" class="sidebar-link">8.1 异常</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/fb3a2a/#811-异常处理" class="sidebar-link">8.1.1 异常处理</a></li><li class="sidebar-sub-header"><a href="/pages/fb3a2a/#812-异常类别" class="sidebar-link">8.1.2 异常类别</a></li><li class="sidebar-sub-header"><a href="/pages/fb3a2a/#813-linuxx86-64-系统中的异常" class="sidebar-link">8.1.3 Linux/x86-64 系统中的异常</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/fb3a2a/#82-进程" class="sidebar-link">8.2 进程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/fb3a2a/#821-逻辑控制流" class="sidebar-link">8.2.1 逻辑控制流</a></li><li class="sidebar-sub-header"><a href="/pages/fb3a2a/#822-并发流" class="sidebar-link">8.2.2 并发流</a></li><li class="sidebar-sub-header"><a href="/pages/fb3a2a/#823-私有地址空间" class="sidebar-link">8.2.3 私有地址空间</a></li><li class="sidebar-sub-header"><a href="/pages/fb3a2a/#824-用户模式和内核模式" class="sidebar-link">8.2.4 用户模式和内核模式</a></li><li class="sidebar-sub-header"><a href="/pages/fb3a2a/#825-上下文切换" class="sidebar-link">8.2.5 上下文切换</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/fb3a2a/#83-系统调用异常处理" class="sidebar-link">8.3 系统调用异常处理</a></li><li class="sidebar-sub-header"><a href="/pages/fb3a2a/#84-进程控制" class="sidebar-link">8.4 进程控制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/fb3a2a/#841-获取进程-id" class="sidebar-link">8.4.1 获取进程 ID</a></li><li class="sidebar-sub-header"><a href="/pages/fb3a2a/#842-创建和终止进程" class="sidebar-link">8.4.2 创建和终止进程</a></li><li class="sidebar-sub-header"><a href="/pages/fb3a2a/#843-回收子进程" class="sidebar-link">8.4.3 回收子进程</a></li><li class="sidebar-sub-header"><a href="/pages/fb3a2a/#844-让进程休眠" class="sidebar-link">8.4.4 让进程休眠</a></li><li class="sidebar-sub-header"><a href="/pages/fb3a2a/#845-加载并运行程序" class="sidebar-link">8.4.5 加载并运行程序</a></li><li class="sidebar-sub-header"><a href="/pages/fb3a2a/#846-利用-fork-和-execve-来运行程序" class="sidebar-link">8.4.6 利用 fork 和 execve 来运行程序</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/fb3a2a/#85-信号" class="sidebar-link">8.5 信号</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/fb3a2a/#851-信号术语" class="sidebar-link">8.5.1 信号术语</a></li><li class="sidebar-sub-header"><a href="/pages/fb3a2a/#852-发送信号" class="sidebar-link">8.5.2 发送信号</a></li><li class="sidebar-sub-header"><a href="/pages/fb3a2a/#853-接收信号" class="sidebar-link">8.5.3 接收信号</a></li><li class="sidebar-sub-header"><a href="/pages/fb3a2a/#854-阻塞和解除阻塞信号" class="sidebar-link">8.5.4 阻塞和解除阻塞信号</a></li><li class="sidebar-sub-header"><a href="/pages/fb3a2a/#855-编写信号处理程序" class="sidebar-link">8.5.5 编写信号处理程序</a></li><li class="sidebar-sub-header"><a href="/pages/fb3a2a/#856-同步流以避免讨厌的并发错误" class="sidebar-link">8.5.6 同步流以避免讨厌的并发错误</a></li><li class="sidebar-sub-header"><a href="/pages/fb3a2a/#857-显式地等待信号" class="sidebar-link">8.5.7 显式地等待信号</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/fb3a2a/#86-非本地跳转" class="sidebar-link">8.6 非本地跳转</a></li><li class="sidebar-sub-header"><a href="/pages/fb3a2a/#87-操作进程的工具" class="sidebar-link">8.7 操作进程的工具</a></li></ul></li><li><a href="/pages/b732ba/" class="sidebar-link">第 9 章 虚拟内存</a></li><li><a href="/pages/41d266/" class="sidebar-link">第 10 章 系统级I/O</a></li><li><a href="/pages/e95797/" class="sidebar-link">第 11 章 网络编程</a></li><li><a href="/pages/6f6eba/" class="sidebar-link">第 12 章 并发编程</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/01.%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/12.CSAPP/02.lab/" class="sidebar-heading clickable"><span>lab</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/01.%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/12.CSAPP/03.%E5%85%AC%E5%BC%80%E8%AF%BE%E7%AC%94%E8%AE%B0/" class="sidebar-heading clickable"><span>公开课笔记</span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/01.%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/13.%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" class="sidebar-heading clickable"><span>数据结构</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/01.%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/15.%E7%AE%97%E6%B3%95/" class="sidebar-heading clickable"><span>算法</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/01.%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/17.%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" class="sidebar-heading clickable"><span>计算机组成原理</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/01.%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/20.%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/" class="sidebar-heading clickable"><span>编译原理</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/01.%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/25.%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" class="sidebar-heading clickable"><span>计算机网络</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/01.%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/27.%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" class="sidebar-heading clickable"><span>操作系统</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/01.%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/30.%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F/" class="sidebar-heading clickable"><span>数据库系统</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/01.%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/40.%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/" class="sidebar-heading clickable"><span>软件工程</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-67beffb9><div class="articleInfo" data-v-67beffb9><ul class="breadcrumbs" data-v-67beffb9><li data-v-67beffb9><a href="/" class="iconfont icon-home router-link-active" data-v-67beffb9></a></li> <li data-v-67beffb9><a href="/01.%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" data-v-67beffb9>
          基础知识
        </a></li><li data-v-67beffb9><a href="/01.%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/12.CSAPP/" data-v-67beffb9>
          CSAPP
        </a></li><li data-v-67beffb9><a href="/01.%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/12.CSAPP/01.%E4%B9%A6%E6%9C%AC%E9%98%85%E8%AF%BB/" data-v-67beffb9>
          书本阅读
        </a></li> <li data-v-67beffb9>第 8 章 异常控制流</li></ul> <div class="info" data-v-67beffb9><div title="作者" class="author iconfont icon-touxiang" data-v-67beffb9><a href="https://github.com/sbwcwso" target="_blank" title="作者" class="beLink" data-v-67beffb9>木子识时务</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-67beffb9><a href="javascript:;" data-v-67beffb9>2022-02-19</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">
          第 8 章 异常控制流
        </h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="第-8-章-异常控制流"><a href="#第-8-章-异常控制流" class="header-anchor">#</a> 第 8 章 异常控制流</h1> <div class="custom-block tip"><p class="custom-block-title">引言</p> <ul><li><div class="custom-block note"><p class="custom-block-title">控制流 (flow of control 或 control flow) 的定义</p> <ul><li>从当前指令到下一条指令的过渡称为控制转换 (control transfer)</li> <li>控制转移的序列称为控制流</li></ul></div></li> <li><div class="custom-block note"><p class="custom-block-title">异常控制流 (Exception Control FLow，ECF) 的定义</p> <ul><li>系统必须能够对系统状态的变化做出反应</li> <li>现代系统通过使控制流发生突变来对系统状态的变化做出反应
<ul><li>把这些突变称为异常控制流</li> <li>突变是相对于平滑的控制流而言的</li></ul></li></ul></div></li> <li><div class="custom-block warning"><p class="custom-block-title">ECF 的应用</p> <ul><li>ECF 是操作系统用来实现 I/O、进程和虚拟内存的基本机制</li> <li>应用程序通过使用一个叫做陷阱（trap）或者系统调用（system call）的 ECF 形式，向操作系统请求服务
<ul><li>操作系统为应用程序提供了强大的 ECF 机制
<ul><li>用来创建新进程、等待进程终止</li> <li>通知其他进程系统中的异常事件，以及检测和响应这些事件</li></ul></li></ul></li> <li>ECF 是计算机系统中实现并发的基本机制</li> <li>软件异常允许程序进行非本地跳转（即违反通常的调用/返回栈规则的跳转）来响应错误情况
<ul><li>非本地跳转是一种应用层 ECF</li></ul></li></ul></div></li></ul></div> <div class="vuepress-markmap"><svg id="markmap_64a570e4"></svg></div><h2 id="81-异常"><a href="#81-异常" class="header-anchor">#</a> 8.1 异常</h2> <div class="custom-block note"><p class="custom-block-title">异常的基本概念</p> <ul><li>异常是异常控制流的一种形式，它一部分由硬件实现，一部分由操作系统实现</li> <li>异常（exception）就是控制流中的突变，用来响应处理器状态中的某些变化
<ul><li>处理器状态中的变化（事件）触发从应用程序到异常处理程序的突发的控制转移（异常）</li> <li>在异常处理程序完成处理后，它将控制返回给被中断的程序或者终止</li> <li><details class="custom-block details"><summary>示意图</summary> <p><img src="https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20220228111651-2022-02-28-11-16-51.png" alt="20220228111651-2022-02-28-11-16-51"></p></details></li></ul></li> <li>状态变化称为<strong>事件</strong>（event)
<ul><li>事件可能和当前指令的执行直接相关
<ul><li>发生虚拟内存缺页、算术溢出，或者一条指令试图除以零</li></ul></li> <li>事件也可能和当前指令的执行没有关系
<ul><li>一个系统定时器产生信号或者一个 I/O 请求完成</li></ul></li></ul></li></ul></div> <h3 id="811-异常处理"><a href="#811-异常处理" class="header-anchor">#</a> 8.1.1 异常处理</h3> <div class="custom-block tip"><p class="custom-block-title">异常号与异常表</p> <ul><li>系统中可能的每种类型的异常都分配了一个唯一的非负整数的<strong>异常号</strong>（exception number）
<ul><li>一些号码是由处理器的设计者分配的
<ul><li>包括被零除、缺页、内存访问违例、断点以及算术运算溢出</li></ul></li> <li>其他号码是由操作系统内核（操作系统常驻内存的部分）的设计者分配的
<ul><li>包括系统调用和来自外部 I/O 设备的信号</li></ul></li></ul></li> <li>在系统启动时（当计算机重启或者加电时），操作系统分配和初始化一张称为<strong>异常表</strong>的<strong>跳转表</strong>，使得表目 <mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="1.179ex" height="1.595ex" role="img" focusable="false" viewBox="0 -694 521 705" xmlns:xlink="http://www.w3.org/1999/xlink" style="vertical-align:-0.025ex;"><defs><path id="MJX-63-TEX-I-1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D458" xlink:href="#MJX-63-TEX-I-1D458"></use></g></g></g></svg></mjx-container> 包含异常 <mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="1.179ex" height="1.595ex" role="img" focusable="false" viewBox="0 -694 521 705" xmlns:xlink="http://www.w3.org/1999/xlink" style="vertical-align:-0.025ex;"><defs><path id="MJX-63-TEX-I-1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D458" xlink:href="#MJX-63-TEX-I-1D458"></use></g></g></g></svg></mjx-container> 的处理程序的地址
<ul><li><details class="custom-block details"><summary>异常表的示意图</summary> <ul><li><img src="https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20220228112319-2022-02-28-11-23-19.png" alt="20220228112319-2022-02-28-11-23-19"></li></ul></details></li></ul></li> <li>异常表的起始地址放在一个叫做<strong>异常表基址寄存器</strong>（exception table base register）的特殊 CPU 寄存器里
<ul><li><details class="custom-block details"><summary>异常处理程序地址的生成</summary> <p><img src="https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20220228112519-2022-02-28-11-25-19.png" alt="20220228112519-2022-02-28-11-25-19"></p></details></li></ul></li></ul></div> <h3 id="812-异常类别"><a href="#812-异常类别" class="header-anchor">#</a> 8.1.2 异常类别</h3> <div class="custom-block tip"><p class="custom-block-title">四类异常</p> <ul><li>异常可以分为四类：<strong>中断</strong>（interrupt），<strong>陷阱</strong>（trap）、<strong>故障</strong>（fault）和<strong>终止</strong>（abort）
<ul><li><img src="https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20220228112713-2022-02-28-11-27-13.png" alt="20220228112713-2022-02-28-11-27-13"></li></ul></li></ul></div> <div class="custom-block note"><p class="custom-block-title">中断</p> <ul><li>中断是异步发生的，是来自处理器外部的 I/O 设备的信号的结果
<ul><li>硬件中断不是由任何一条专门的指令造成的，从这个意义上来说它是异步的</li></ul></li> <li>硬件中断的异常处理程序常常称为中断处理程序（interrupt handler）</li> <li>中断处理过程
<ul><li><img src="https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20220228113311-2022-02-28-11-33-11.png" alt="20220228113311-2022-02-28-11-33-11"></li></ul></li></ul></div> <div class="custom-block tip"><p class="custom-block-title">陷阱和系统调用</p> <ul><li>陷阱是有意的异常，是执行一条指令的结果
<ul><li>陷阱处理程序将控制返回到下一条指令</li></ul></li> <li>陷阱最重要的用途是在用户程序和内核之间提供一个像过程一样的接口，叫做系统调用</li> <li>陷阱处理过程
<ul><li><img src="https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20220228113500-2022-02-28-11-35-01.png" alt="20220228113500-2022-02-28-11-35-01"></li></ul></li> <li><div class="custom-block note"><p class="custom-block-title">系统调用和普通函数调用的区别</p> <ul><li>普通的函数运行在用户模式中
<ul><li>用户模式限制了函数可以执行的指令的类型</li> <li>而且它们只能访问与调用函数相同的栈</li></ul></li> <li>系统调用运行在内核模式中
<ul><li>内核模式允许系统调用执行特权指令</li> <li>并访问定义在内核中的栈</li></ul></li></ul></div></li></ul></div> <div class="custom-block note"><p class="custom-block-title">故障</p> <ul><li>故障由错误情况引起，它可能能够被故障处理程序修正</li> <li>当故障发生时，处理器将控制转移给故障处理程序
<ul><li>如果处理程序能够修正这个错误情况，它就将控制返回到引起故障的指令，从而重新执行它
<ul><li>比如虚拟内存中的缺页异常</li></ul></li> <li>否则，处理程序返回到内核中的 <code>abort</code> 例程</li> <li><code>abort</code> 例程会终止引起故障的应用程序</li></ul></li> <li>故障处理示意图
<ul><li><img src="https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20220228113953-2022-02-28-11-39-53.png" alt="20220228113953-2022-02-28-11-39-53"></li></ul></li></ul></div> <div class="custom-block tip"><p class="custom-block-title">终止</p> <ul><li>终止是不可恢复的致命错误造成的结果
<ul><li>通常是一些硬件错误，比如 DRAM 或者 SRAM 位被损坏时发生的奇偶错误</li></ul></li> <li>终止处理程序从不将控制返回给应用程序</li> <li>终止处理示意图
<ul><li><img src="https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20220228114037-2022-02-28-11-40-37.png" alt="20220228114037-2022-02-28-11-40-37"></li></ul></li></ul></div> <h3 id="813-linuxx86-64-系统中的异常"><a href="#813-linuxx86-64-系统中的异常" class="header-anchor">#</a> 8.1.3 Linux/x86-64 系统中的异常</h3> <div class="custom-block note"><p class="custom-block-title">x86-64 系统中定义的一些异常</p> <ul><li>有 256 种不同的异常类型
<ul><li>0-31 的号码对应的是由 Intel 架构师定义的异常</li> <li>32 - 255 的号码对应的是操作系统定义的中断和陷阱</li></ul></li> <li>异常示例
<ul><li><img src="https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20220228114502-2022-02-28-11-45-02.png" alt="20220228114502-2022-02-28-11-45-02"></li> <li>一般保护故障（异常 13）
<ul><li>通常是因为一个程序引用了一个未定义的虚拟内存区域</li> <li>或者因为程序试图写一个只读的文本段</li> <li>Linux 不会尝试恢复这类故障
<ul><li>Linux shell 通常会把这种一般保护故障报告为 <code>Segmentation fault</code></li></ul></li></ul></li></ul></li></ul></div> <div class="custom-block tip"><p class="custom-block-title">Linux x86-64 系统调用</p> <ul><li>常用的系统调用
<ul><li><img src="https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20220228114808-2022-02-28-11-48-08.png" alt="20220228114808-2022-02-28-11-48-08"></li></ul></li> <li>C 程序用 <code>syscall</code> 函数可以直接调用任何系统调用
<ul><li>将系统调用和与它们相关联的包装函数都称为<strong>系统级函数</strong></li></ul></li> <li>所有到 Linux 系统调用的参数都是通过通用寄存器而不是栈传递的，按照惯例
<ul><li>寄存器 <code>%rax</code> 包含系统调用号</li> <li>寄存器 <code>%rdi、%rsi、%rdx、%r10、%r8</code>  和 <code>%r9</code> 包含最多 6 个参数</li> <li><code>%rax</code> 包含返回值</li></ul></li></ul></div> <h2 id="82-进程"><a href="#82-进程" class="header-anchor">#</a> 8.2 进程</h2> <div class="custom-block note"><p class="custom-block-title">进程的基本概念</p> <ul><li>异常是允许操作系统内核提供进程（process）概念的基本构造块
<ul><li>进程是计算机科学中最深刻、最成功的概念之一</li></ul></li> <li>进程是一个执行中程序的实例
<ul><li>系统中的每个程序都运行在某个进程的<strong>上下文</strong>（context）中</li> <li>上下文是由程序正确运行所需的状态组成的
<ul><li>这个状态包括
<ul><li>存放在内存中的程序的代码和数据</li> <li>栈、通用目的寄存器的内容、程序计数器</li> <li>打开文件描述符的集合</li> <li>内核栈和各种内核数据结构
<ul><li>比如描述地址空间的页表</li> <li>包含有关当前进程信息的进程表</li></ul></li></ul></li></ul></li></ul></li> <li>进程提供给应用程序的关键抽象
<ul><li>一个独立的逻辑控制流
<ul><li>它提供一个假象，好像我们的程序独占地使用处理器</li></ul></li> <li>一个私有的地址空间
<ul><li>它提供一个假象，好像我们的程序独占地使用内存系统</li></ul></li></ul></li></ul></div> <h3 id="821-逻辑控制流"><a href="#821-逻辑控制流" class="header-anchor">#</a> 8.2.1 逻辑控制流</h3> <div class="custom-block tip"><p class="custom-block-title">逻辑控制流示意图</p> <ul><li><img src="https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20220228120226-2022-02-28-12-02-26.png" alt="20220228120226-2022-02-28-12-02-26"></li> <li>关键点在于进程是轮流使用处理器的
<ul><li>每个进程执行它的流的一部分，然后被<strong>抢占</strong>（preempted）（暂时挂起）</li> <li>然后轮到其他进程</li></ul></li></ul></div> <h3 id="822-并发流"><a href="#822-并发流" class="header-anchor">#</a> 8.2.2 并发流</h3> <div class="custom-block note"><p class="custom-block-title">并发流的概念</p> <ul><li>一个逻辑流的执行在<strong>时间上</strong>与另一个流重叠，称为<strong>并发流</strong>（concurrent flow），这两个流被称为<strong>并发地运行</strong></li> <li>多个流并发地执行的一般现象被称为<strong>并发</strong>（concurrency</li> <li>一个进程和其他进程轮流运行的概念称为<strong>多任务</strong>（multitasking）
<ul><li>一个进程执行它的控制流的一部分的每一时间段叫做<strong>时间片</strong>（time slice）</li> <li>因此，多任务也叫做<strong>时间分片</strong>（time slicing）</li></ul></li></ul></div> <div class="custom-block tip"><p class="custom-block-title">并行的概念</p> <ul><li>如果两个流并发地运行在<strong>不同的处理器核或者计算机</strong>上，那么我们称它们为<strong>并行流</strong>（parallel flow）</li> <li>它们<strong>并行地运行</strong>（running in parallel），且<strong>并行地执行</strong>（parallel execution）</li></ul></div> <h3 id="823-私有地址空间"><a href="#823-私有地址空间" class="header-anchor">#</a> 8.2.3 私有地址空间</h3> <div class="custom-block note"><p class="custom-block-title">私有地址空间的内容</p> <ul><li>进程为每个程序提供它自己的私有地址空间
<ul><li>一般而言，和这个空间中某个地址相关联的那个内存字节是不能被其他进程读或者写的</li> <li>从这个意义上说，这个地址空间是私有的</li></ul></li> <li>私有空间有相同的通用结构
<ul><li>进程地址空间示意图
<ul><li><img src="https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20220228121532-2022-02-28-12-15-32.png" alt="20220228121532-2022-02-28-12-15-32"></li></ul></li> <li>地址空间底部是保留给用户程序的
<ul><li>包括通常的代码、数据、堆和栈段</li> <li>代码段总是从地址 0x400000 开始</li></ul></li> <li>地址空间顶部保留给内核（操作系统常驻内存的部分）
<ul><li>包含内核在代表进程执行指令时（比如当应用程序执行系统调用时）使用的代码、数据和栈</li></ul></li></ul></li></ul></div> <h3 id="824-用户模式和内核模式"><a href="#824-用户模式和内核模式" class="header-anchor">#</a> 8.2.4 用户模式和内核模式</h3> <div class="custom-block tip"><p class="custom-block-title">用户模式和内核模式的主要内容</p> <ul><li>为了给操作系统内核提供一个进程抽象，处理器需要限制一个应用可以执行的指令以及它可以访问的地址空间范围</li> <li>处理器通常是用某个控制寄存器中的一个模式位（mode bit）来描述进程当前享有的特权
<ul><li>当设置了模式位时，进程就运行在<strong>内核模式</strong>中（有时叫做超级用户模式）
<ul><li>一个运行在内核模式的进程可以执行指令集中的任何指令，并且可以访问系统中的任何内存位置</li></ul></li> <li>没有设置模式位时，进程就运行在<strong>用户模式</strong>中
<ul><li>用户模式中的进程不允许执行特权指令（privileged instruction）
<ul><li>比如停止处理器、改变模式位，或者发起一个 I/O 操作</li></ul></li> <li>也不允许用户模式中的进程直接引用地址空间中内核区内的代码和数据
<ul><li>任何这样的尝试都会导致致命的保护故障</li></ul></li> <li>用户程序必须通过系统调用接口间接地访问内核代码和数据</li></ul></li></ul></li> <li>进程从用户模式变为内核模式的唯一方法是通过诸如中断、故障或者陷入系统调用这样的异常</li> <li>Linux 中的 <code>/proc</code> 文件系统，它允许用户模式进程访问内核数据结构的内容
<ul><li>比如 CPU 类型（<code>/proc/cpuinfo</code>）</li> <li>或者某个特殊的进程使用的内存段（<code>/proc/&lt;process-id&gt;/maps</code>)</li></ul></li></ul></div> <h3 id="825-上下文切换"><a href="#825-上下文切换" class="header-anchor">#</a> 8.2.5 上下文切换</h3> <div class="custom-block note"><p class="custom-block-title">上下文切换的基本内容</p> <ul><li>操作系统内核使用一种称为上下文切换（context switch）的较高层形式的异常控制流来实现多任务
<ul><li>上下文可以理解为内核重新启动一个被抢占的进程所需的状态</li></ul></li> <li>调度（scheduling）
<ul><li>在进程执行的某些时刻，内核可以决定抢占当前进程，并重新开始一个先前被抢占了的进程。这种决策就叫做调度（scheduling)</li> <li>调度是由内核中称为调度器（scheduler）的代码处理的</li> <li>当内核选择一个新的进程运行时，我们说内核调度了这个进程</li> <li>在内核调度了一个新的进程运行后，它就抢占当前进程，并使用一种称为上下文切换的机制来将控制转移到新的进程</li></ul></li> <li>上下文切换的过程
<ul><li>保存当前进程的上下文</li> <li>恢复某个先前被抢占的进程被保存的上下文</li> <li>将控制传递给这个新恢复的进程</li></ul></li></ul></div> <div class="custom-block tip"><p class="custom-block-title">DMA 传输示例</p> <ul><li><img src="https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20220228123554-2022-02-28-12-35-55.png" alt="20220228123554-2022-02-28-12-35-55"></li> <li>在等待磁盘传输数据的过程中， CPU 可以去执行其它进程</li> <li>磁盘传输完成后，会产生磁盘中断信号，这时操作系统可以切换到进程 A 继续执行</li></ul></div> <h2 id="83-系统调用异常处理"><a href="#83-系统调用异常处理" class="header-anchor">#</a> 8.3 系统调用异常处理</h2> <div class="custom-block tip"><p class="custom-block-title">当 Unix 系统级函数遇到错误时，它们通常会返回 —1，并设置全局整数变量 <code>errno </code> 来表示什么出错了</p></div> <div class="custom-block note"><p class="custom-block-title">错误处理包装函数</p> <ul><li>为了避免代码变得臃肿，可以对系统级函数使用错误处理包装函数
<ul><li>包装函数调用基本函数，检査错误，如果有任何问题就终止</li></ul></li> <li><details class="custom-block details"><summary>程序示例</summary> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">unix_error</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>msg<span class="token punctuation">)</span> <span class="token comment">/* Unix-style error */</span>
<span class="token punctuation">{</span>
  <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">&quot;%s: %s\n&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">pid_t</span> <span class="token function">Fork</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token class-name">pid_t</span> pid<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
      <span class="token function">unix_error</span><span class="token punctuation">(</span><span class="token string">&quot;Fork error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> pid<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></details></li></ul></div> <h2 id="84-进程控制"><a href="#84-进程控制" class="header-anchor">#</a> 8.4 进程控制</h2> <h3 id="841-获取进程-id"><a href="#841-获取进程-id" class="header-anchor">#</a> 8.4.1 获取进程 ID</h3> <div class="custom-block tip"><p class="custom-block-title">提示</p> <ul><li><p>每个进程都有一个唯一的正数（非零）进程 ID（PID）</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>

<span class="token class-name">pid_t</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">pid_t</span> <span class="token function">getppid</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 返回：调用者或其父进程的 PID</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ul></div> <h3 id="842-创建和终止进程"><a href="#842-创建和终止进程" class="header-anchor">#</a> 8.4.2 创建和终止进程</h3> <div class="custom-block note"><p class="custom-block-title">从程序员的角度来看，进程总是处于下面三种状态之一</p> <ul><li>运行
<ul><li>进程要么在 CPU 上 执行，要么在等待被执行且最终会被内核调度</li></ul></li> <li>停止
<ul><li>进程的执行被挂起（suspended），且不会被调度</li> <li>当收到 <code>SIGSTOP、SIGTSTP、SIGTTIN</code> 或者 <code>SIGTTOU</code> 信号时，进程就停止</li> <li>并且保持停止直到它收到一个 <code>SIGCONT</code> 信号，在这个时刻，进程再次开始运行</li></ul></li> <li>终止
<ul><li>进程永远地停止了。进程会因为三种原因终止：
<ul><li>收到一个信号，该信号的默认行为是终止进程</li> <li>从主程序返回</li> <li>调用 <code>exit</code> 函数</li></ul></li></ul></li></ul></div> <div class="custom-block tip"><p class="custom-block-title"><code>exit</code> 函数以 <code>status</code> 退出状态来终止进程</p> <ul><li>另一种设置退出状态的方法是从主程序中返回一个整数值</li></ul> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>

<span class="token keyword">void</span> <span class="token function">exit</span><span class="token punctuation">(</span><span class="token keyword">int</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 该函数不返回</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div> <div class="custom-block note"><p class="custom-block-title">父进程通过调用 <code>fork</code> 函数创建一个新的运行的子进程</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>

<span class="token class-name">pid_t</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 返回：子进程返回 0，父进程返回子进程的 PID，如果出错，则为 -1。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>新创建的子进程几乎但不完全与父进程相同
<ul><li>子进程得到与父进程用户级虚拟地址空间相同的（但是独立的）一份副本
<ul><li>包括代码和数据段、堆、共享库以及用户栈</li></ul></li> <li>子进程还获得与父进程任何打开文件描述符相同的副本
<ul><li>意味着当父进程调用 fork 时，子进程可以读写父进程中打开的任何文件</li></ul></li> <li>父进程和新创建的子进程之间最大的区别在于它们有不同的 PID</li></ul></li> <li><code>fork</code> 函数只被调用一次，却会返回两次
<ul><li>一次是在调用进程（父进程）中
<ul><li>在父进程中，<code>fork</code> 返回子进程的 PID</li></ul></li> <li>一次是在新创建的子进程中
<ul><li>在子进程中，<code>fork</code> 返回 0</li></ul></li> <li><div class="custom-block tip"><p class="custom-block-title">因为子进程的 PID 总是为非零，返回值就提供一个明确的方法来分辨程序是在父进程还是在子进程中执行</p></div></li></ul></li> <li>父进程和子进程是并发运行的独立进程
<ul><li>内核能够以<strong>任意方式</strong>交替执行它们的逻辑控制流中的指令</li></ul></li></ul></div> <div class="custom-block warning"><p class="custom-block-title">使用 <code>fork</code> 时，编译时的命令</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>gcc fork.c <span class="token punctuation">..</span>/src/csapp.c -o fork -I <span class="token punctuation">..</span>/include -lpthread
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div> <h3 id="843-回收子进程"><a href="#843-回收子进程" class="header-anchor">#</a> 8.4.3 回收子进程</h3> <div class="custom-block tip"><p class="custom-block-title">僵死进程 (zombie)</p> <ul><li>当一个进程由于某种原因终止时，内核并不是立即把它从系统中清除
<ul><li>相反，进程被保持在一种已终止的状态中，直到被它的父进程回收（reaped）</li> <li>当父进程回收已终止的子进程时，内核将子进程的退出状态传递给父进程，然后抛弃已终止的进程
<ul><li>从此时开始，该进程就不存在了</li></ul></li></ul></li> <li><strong>一个终止了但还未被回收的进程</strong>称为僵死进程</li> <li>如果一个父进程终止了，内核会安排 <code>init</code> 进程成为它的孤儿进程的养父
<ul><li><code>init</code> 进程的 PID 为 <code>1</code> <ul><li>是在系统启动时由内核创建的，它不会终止，是所有进程的祖先</li></ul></li></ul></li> <li>但对于长时间运行的程序，比如 shell 或者服务器，总是应该回收它们的僵死子进程
<ul><li>因为即使僵死子进程没有运行，它们仍然消耗系统的内存资源</li></ul></li></ul></div> <div class="custom-block note"><p class="custom-block-title">一个进程可以通过调用 `waitpid` 函数来等待它的子进程终止或者停止</p> <ul><li><p>函数原型</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/wait.h&gt;</span></span>

<span class="token class-name">pid_t</span> <span class="token function">waitpid</span><span class="token punctuation">(</span><span class="token class-name">pid_t</span> pid<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>statusp<span class="token punctuation">,</span> <span class="token keyword">int</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 返回：如果成功，则为子进程的 PID，如果 options 为 WNOHANG，且任何子进程都还没有终止，则为 0，如果其他错误，则为 -1。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><div class="custom-block tip"><p class="custom-block-title">默认情况</p> <ul><li>默认情况下（当 <code>options=0</code> 时）
<ul><li><code>waitpid</code> 挂起调用进程的执行，直到它的等待集合（wait set）中的一个子进程终止</li> <li>如果等待集合中的一个进程在刚调用的时刻就已经终止了，那么 <code>waitpid</code> 就立即返回</li></ul></li> <li>在这两种情况中，<code>waitpid</code> 返回导致 <code>waitpid</code> 返回的已终止子进程的 PID
<ul><li>此时，已终止的子进程已经被回收，内核会从系统中删除掉它的所有痕迹</li></ul></li></ul></div></li> <li><div class="custom-block tip"><p class="custom-block-title">指定等待集合的成员， <code>pid</code> 参数</p> <ul><li>由参数 <code>pid</code> 来确定
<ul><li>如果 <code>pid&gt;0</code>，那么等待集合就是一个单独的子进程，它的进程 ID 等于 <code>pid</code></li> <li>如果 <code>pid=-1</code>，那么等待集合就是由父进程所有的子进程组成的</li></ul></li></ul></div></li> <li><div class="custom-block tip"><p class="custom-block-title">修改默认行为，<code>options</code> 参数</p> <ul><li><code>WNOHANG</code> <ul><li>如果等待集合中的任何子进程都还没有终止，那么就立即返回（返回值为 0）</li> <li>默认的行为是挂起调用进程，直到有子进程终止</li></ul></li> <li><code>WUNTRACED</code> <ul><li>挂起调用进程的执行，直到等待集合中的一个进程变成已终止或者被停止</li> <li>默认的行为是只返回已终止的子进程</li></ul></li> <li><code>WCONTINUED</code> <ul><li>挂起调用进程的执行，直到等待集合中一个正在运行的进程终止或等待集合中一个被停止的进程收到 <code>SIGCONT</code> 信号重新开始执行</li></ul></li> <li><div class="custom-block note"><p class="custom-block-title">可以用或运算把这些选项组合起来</p></div></li></ul></div></li> <li><div class="custom-block tip"><p class="custom-block-title">检查已回收子进程的退出状态 <code>statusp</code></p> <ul><li>如果 <code>statusp</code> 参数是非空的
<ul><li>那么 <code>waitpid</code> 就会在 <code>status</code> 中放上关于导致返回的子进程的状态信息</li> <li><code>status</code> 是 <code>statusp</code> 指向的值</li></ul></li> <li>wait.h 头文件定义了解释 <code>status</code> 参数的几个宏
<ul><li><code>WIFEXITED(status)</code> <ul><li>如果于进程通过调用 <code>exit</code> 或者一个返回（<code>return</code>）正常终止，就返回真</li></ul></li> <li><code>WEXITSTATUS(status)</code> <ul><li>返回一令正常终止的子进程的退出状态</li> <li>只有在 <code>WIFEXITED()</code> 返回为真时，才会定义这个状态</li></ul></li> <li><code>WIFSIGNALED(status)</code> <ul><li>如果子进程是因为一个未被捕获的信号终止的，那么就返回真</li></ul></li> <li><code>WTERMSIG(status)</code> <ul><li>返回导致子进程终止的信号的编号</li> <li>只有在 <code>WIFSIGNALED()</code> 返回为真时，才定义这个状态</li></ul></li> <li><code>WIFSTOPPED(status)</code> <ul><li>如果引起返回的子进程当前是停止的，那么就返回真</li></ul></li> <li><code>WSTOPSIG(status)</code> <ul><li>返回引起子进程停止的信号的编号</li> <li>只有在 <code>WIFSTOPPED()</code> 返回为真时，才定义这个状态</li></ul></li> <li><code>WIFCONTINUED(status)</code> <ul><li>如果子进程收到 <code>SIGCONT</code> 信号重新启动，则返回真</li></ul></li></ul></li></ul></div></li> <li><div class="custom-block warning"><p class="custom-block-title">错误时的返回</p> <ul><li>如果调用进程没有子进程，那么 <code>waitpid</code> 返回 -1，并且设置 <code>errno</code> 为 <code>ECHILD</code></li> <li>如果 <code>waitpid</code> 函数被一个信号中断，那么它返回 -1，并设置 <code>errno</code> 为 <code>EINTR</code></li></ul></div></li> <li><div class="custom-block note"><p class="custom-block-title"><code>wait</code> 函数</p> <ul><li><code>wait</code> 函数是 <code>waitpid</code> 的简单版本</li></ul> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/wait.h&gt;</span></span>

<span class="token class-name">pid_t</span> <span class="token function">wait</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span>statusp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 返回：如果成功，则为子进程的 PID，如果出错，则为 -1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>调用 <code>wait(&amp;status)</code> 等价于调用 <code>waitpid(-1, &amp;status, 0)</code></li></ul></div></li></ul></div> <h3 id="844-让进程休眠"><a href="#844-让进程休眠" class="header-anchor">#</a> 8.4.4 让进程休眠</h3> <div class="custom-block tip"><p class="custom-block-title"><code>sleep</code> 函数</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> secs<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 返回：还要休眠的秒数。如果 sleep 函数被一个信号中断而过早地返回，其返回值可能大于 0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div> <div class="custom-block note"><p class="custom-block-title"><code>pause</code> 函数</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">pause</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 总是返回 -1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>该函数让调用函数休眠，直到该进程收到一个信号</li></ul></div> <h3 id="845-加载并运行程序"><a href="#845-加载并运行程序" class="header-anchor">#</a> 8.4.5 加载并运行程序</h3> <div class="custom-block tip"><p class="custom-block-title"><code>execve</code> 函数</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">execve</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>filename<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
           <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>envp<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 如果成功，则不返回，如果错误，则返回 -1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><p><code>execve</code> 函数在当前进程的上下文中加载并运行一个新程序</p></li> <li><p><code>execve</code> 函数加载并运行可执行目标文件 <code>filename</code></p> <ul><li>且带参数列表 <code>argv</code> 和环境变量列表 <code>envp</code></li> <li>只有当出现错误时，例如找不到 <code>filename</code>，<code>execve</code> 才会返回到调用程序</li> <li>否则，<code>execve</code> 调用一次并从不返回</li></ul></li> <li><p>新程序的主函数有如下形式的原型</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>参数列表的组织结构
<img src="https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20220228151322-2022-02-28-15-13-22.png" alt="20220228151322-2022-02-28-15-13-22"></p></li> <li><p>环境变量列表的组织结构
<img src="https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20220228151330-2022-02-28-15-13-30.png" alt="20220228151330-2022-02-28-15-13-30"></p></li> <li><p>一个新程序开始时，用户栈的典型组织结构
<img src="https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20220228151825-2022-02-28-15-18-25.png" alt="20220228151825-2022-02-28-15-18-25"></p></li></ul></div> <h6 id="env" class="anchor-user-defined"><a href="#env" class="header-anchor">#</a></h6> <div class="custom-block note"><p class="custom-block-title">操纵环境数组的函数</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 返回：若存在则为指向 name 的指针，若无匹配的，则为 NULL</span>

<span class="token keyword">int</span> <span class="token function">setenv</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>newvalue<span class="token punctuation">,</span> <span class="token keyword">int</span> overwrite<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 返回：若成功则为 0，若错误则为 -1</span>

<span class="token keyword">void</span> <span class="token function">unsetenv</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 返回：无</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></div> <div class="custom-block warning"><p class="custom-block-title">程序和进程的区别</p> <ul><li>程序是一堆代码和数据</li> <li>程序可以作为目标文件存在于磁盘上，或者作为段存在于地址空间中</li> <li>进程是执行中程序的一个具体的实例</li> <li>程序总是运行在某个进程的上下文中</li></ul></div> <div class="custom-block danger"><p class="custom-block-title"><code>fork</code> 函数与 <code>execve</code> 函数的区别</p> <ul><li><code>fork</code> 函数在新的子进程中运行相同的程序
<ul><li>新的子进程是父进程的一个复制品</li></ul></li> <li><code>execve</code> 函数在当前进程的上下文中加载并运行一个新的程序
<ul><li>它会覆盖当前进程的地址空间，但并没有创建一个新进程</li> <li>新的程序仍然有相同的 PID</li> <li>并且继承了调用 execve 函数时已打开的所有文件描述符</li></ul></li></ul></div> <h3 id="846-利用-fork-和-execve-来运行程序"><a href="#846-利用-fork-和-execve-来运行程序" class="header-anchor">#</a> 8.4.6 利用 <code>fork</code> 和 <code>execve</code> 来运行程序</h3> <div class="custom-block tip"><p class="custom-block-title">实际应用</p> <ul><li>像 Unix shell 和 Web 服务器这样的程序大量使用了 <code>fork</code> 和 <code>execve</code> 函数</li> <li>shell 是一个交互型的应用级程序，它代表用户运行其他程序
<ul><li>shell 执行一系列的读/求值（read/evaluate）步骤，然后终止
<ul><li>读步骤读取来自用户的一个命令行</li> <li>求值步骤解析命令行，并代表用户运行程序</li></ul></li></ul></li></ul></div> <h2 id="85-信号"><a href="#85-信号" class="header-anchor">#</a> 8.5 信号</h2> <div class="custom-block note"><p class="custom-block-title">Linux 信号是一种更高层的软件形式的异常，它允许进程和内核中断其他进程</p> <ul><li>内核通知用户进程发生异常的信号，比如
<ul><li>如果一个进程试图除以 0，那么内核就发送给它一个 <code>SIGFPE</code> 信号（号码 8）
<ul><li><a href="/pages/9ed0a9/#q7">有时浮点数除 0，不会产生这个信号</a></li></ul></li> <li>如果一个进程执行一条非法指令，那么内核就发送给它一个 <code>SIGILL</code> 信号（号码 4）</li> <li>如果进程进行非法内存引用，内核就发送给它一个 <code>SIGSEGV</code> 信号（号码 11）</li></ul></li> <li>其他信号对应于内核或者其他用户进程中较高层的软件事件，比如
<ul><li>如果当进程在前台运行时，键入 <code>Ctrl+C</code>，那么内核就会发送一个 <code>SIGINT</code> 信号（号码 2）给这个前台进程组中的每个进程</li> <li>一个进程可以通过向另一个进程发送一个 <code>SIGKILL</code> 信号（号码 9）强制终止它</li> <li>当一个子进程终止或者停止时，内核会发送一个 <code>SIGCHLD</code> 信号（号码 17）给父进程</li></ul></li></ul> <details class="custom-block details"><summary>Linux 中的信号</summary> <p><img src="https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20220304111105-2022-03-04-11-11-06.png" alt="20220304111105-2022-03-04-11-11-06"></p></details></div> <h3 id="851-信号术语"><a href="#851-信号术语" class="header-anchor">#</a> 8.5.1 信号术语</h3> <div class="custom-block tip"><p class="custom-block-title">信号处理程序 (signal handler)</p> <ul><li>收到信号会触发控制转移到信号处理程序</li> <li>在信号处理程序完成处理之后，它将控制返回给被中断的程序
<img src="https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20220304112122-2022-03-04-11-21-22.png" alt="20220304112122-2022-03-04-11-21-22"></li></ul></div> <div class="custom-block note"><p class="custom-block-title">待处理信号 (pending signal)</p> <ul><li>一个发出而没有被接收的信号叫做待处理信号（pending signal）
<ul><li>接收可以理解为被信号处理程序处理</li></ul></li> <li>在任何时刻，一种类型至多只会有一个待处理信号
<ul><li>如果一个进程有一个类型为 <mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="1.179ex" height="1.595ex" role="img" focusable="false" viewBox="0 -694 521 705" xmlns:xlink="http://www.w3.org/1999/xlink" style="vertical-align:-0.025ex;"><defs><path id="MJX-63-TEX-I-1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D458" xlink:href="#MJX-63-TEX-I-1D458"></use></g></g></g></svg></mjx-container> 的待处理信号
<ul><li>那么任何接下来发送到这个进程的类型为 <mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="1.179ex" height="1.595ex" role="img" focusable="false" viewBox="0 -694 521 705" xmlns:xlink="http://www.w3.org/1999/xlink" style="vertical-align:-0.025ex;"><defs><path id="MJX-63-TEX-I-1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D458" xlink:href="#MJX-63-TEX-I-1D458"></use></g></g></g></svg></mjx-container> 的信号都不会排队等待</li> <li>它们只是被简单地丢弃</li> <li><div class="custom-block tip"><p class="custom-block-title">因此，不可以使用信号对其它进程中发生的事件进行计数</p></div></li></ul></li> <li>内核为每个进程在 <code>pending</code> 位向量中维护着待处理信号的集合
<ul><li>只要传送了一个类型为 <mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="1.179ex" height="1.595ex" role="img" focusable="false" viewBox="0 -694 521 705" xmlns:xlink="http://www.w3.org/1999/xlink" style="vertical-align:-0.025ex;"><defs><path id="MJX-63-TEX-I-1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D458" xlink:href="#MJX-63-TEX-I-1D458"></use></g></g></g></svg></mjx-container> 的信号，内核就会设置 <code>pending</code> 中的第 <mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="1.179ex" height="1.595ex" role="img" focusable="false" viewBox="0 -694 521 705" xmlns:xlink="http://www.w3.org/1999/xlink" style="vertical-align:-0.025ex;"><defs><path id="MJX-63-TEX-I-1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D458" xlink:href="#MJX-63-TEX-I-1D458"></use></g></g></g></svg></mjx-container> 位</li></ul></li></ul></li> <li>一个进程可以有选择性地阻塞接收某种信号
<ul><li>内核在 <code>blocked</code> 位向量中维护着被阻塞的信号集合</li> <li>当一种信号被阻塞时，它仍可以被发送
<ul><li>通过设置 <code>pending</code> 位向量来实现</li></ul></li> <li>但是产生的待处理信号不会被接收，直到进程取消对这种信号的阻塞</li></ul></li></ul> <div class="custom-block tip"><p class="custom-block-title">一个待处理信号最多只能被接收一次</p> <ul><li>只要接收了一个类型为 <mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="1.179ex" height="1.595ex" role="img" focusable="false" viewBox="0 -694 521 705" xmlns:xlink="http://www.w3.org/1999/xlink" style="vertical-align:-0.025ex;"><defs><path id="MJX-63-TEX-I-1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D458" xlink:href="#MJX-63-TEX-I-1D458"></use></g></g></g></svg></mjx-container> 的信号，内核就会清除 <code>pending</code> 中的第 <mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="1.179ex" height="1.595ex" role="img" focusable="false" viewBox="0 -694 521 705" xmlns:xlink="http://www.w3.org/1999/xlink" style="vertical-align:-0.025ex;"><defs><path id="MJX-63-TEX-I-1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D458" xlink:href="#MJX-63-TEX-I-1D458"></use></g></g></g></svg></mjx-container> 位</li></ul></div></div> <h3 id="852-发送信号"><a href="#852-发送信号" class="header-anchor">#</a> 8.5.2 发送信号</h3> <div class="custom-block tip"><p class="custom-block-title">Unix 系统提供了大量向进程发送信号的机制。所有这些机制都是基于进程组（process group）这个概念的</p> <ul><li><p>每个进程都只属于一个进程组，进程组是由一个正整数进程组 ID 来标识的</p> <ul><li><p><code>getpgrp</code> 函数返回当前进程的进程组 ID</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token class-name">pid_t</span> <span class="token function">getpgrp</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 返回：调用进程的进程组 ID</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul></li> <li><p>默认地，<strong>一个子进程和它的父进程同属于一个进程组</strong></p></li> <li><p>一个进程可以通过使用 <code>setpgid</code> 函数来改变自己或者其他进程的进程组</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">setpgid</span><span class="token punctuation">(</span><span class="token class-name">pid_t</span> pid<span class="token punctuation">,</span> <span class="token class-name">pid_t</span> pgid<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 返回：若成功则为o，若错误则为 -1。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>如果 <code>pid</code> 是 0，那么就使用当前进程的 PID</li> <li>如果 <code>pgid</code> 是 0，那么就用 <code>pid</code> 指定的进程的 PID 作为进程组 ID</li> <li>如果 <code>pid</code> 和 <code>pgid</code> 均为 0，则使用当前进程的 PID 作为进程组 ID</li></ul></li></ul></div> <div class="custom-block note"><p class="custom-block-title">使用 <code>/bin/kill</code> 程序发送信号</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>linux<span class="token operator">&gt;</span> /bin/kill -9 <span class="token number">15213</span>   <span class="token comment"># 发送信号 9（SIGKILL）给进程 15213</span>
linux<span class="token operator">&gt;</span> /bin/kill -9 -15213  <span class="token comment"># 发送一个 SIGKILL 信号给进程组 15213 中的每个进程</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div> <div class="custom-block tip"><p class="custom-block-title">从键盘发送信号</p> <ul><li>Unix shell 使用<strong>作业</strong>（job）这个抽象概念来表示为对一条命令行求值而创建的进程</li> <li>在键盘上输入 Ctrl+C 会导致内核发送一个 <code>SIGINT</code> 信号到前台进程组中的每个进程
<ul><li>默认情况下，结果是终止前台作业</li></ul></li> <li>输入 Ctrl+Z 会发送一个 <code>SIGTSTP</code> 信号到前台进程组中的每个进程
<ul><li>默认情况下，结果是停止（挂起）前台作业</li></ul></li></ul></div> <div class="custom-block note"><p class="custom-block-title">用 <code>kill</code> 函数发送信号</p> <ul><li><p>进程通过调用 <code>kill</code> 函数发送信号给其他进程（包括它们自己）</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">kill</span><span class="token punctuation">(</span><span class="token class-name">pid_t</span> pid<span class="token punctuation">,</span> <span class="token keyword">int</span> sig<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 返回：若成功则为 0，若错误则为 -1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>如果 <code>pid</code> 大于零，那么 <code>kill</code> 函数发送信号号码 <code>sig</code> 给进程 <code>pid</code></p></li> <li><p>如果 <code>pid</code> 等于零，那么 <code>kill</code> 发送信号 <code>sig</code> 给调用进程所在进程组中的每个进程</p> <ul><li>包括调用进程自己</li></ul></li> <li><p>如果 <code>pid</code> 小于零，<code>kill</code> 发送信号 <code>sig</code> 给进程组 <code>|pid|</code>（ <code>pid</code> 的绝对值）中的每个进程</p></li></ul></div> <div class="custom-block tip"><p class="custom-block-title">用 <code>alarm</code> 函数发送信号</p> <ul><li><p>进程可以通过调用 <code>alarm</code> 函数向它自己发送 <code>SIGALRM</code> 信号</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token function">alarm</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> secs<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 返回：前一次闹钟剩余的秒数，若以前没有设定闹钟，则为0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p><code>alarm</code> 函数安排内核在 <code>secs</code> 秒后发送一个 <code>SIGALRM</code> 信号给调用进程</p></li></ul></div> <h3 id="853-接收信号"><a href="#853-接收信号" class="header-anchor">#</a> 8.5.3 接收信号</h3> <div class="custom-block note"><p class="custom-block-title">接收信号的过程</p> <ul><li>当内核把进程 <code>p</code> 从内核模式切换到用户模式时
<ul><li>例如，从系统调用返回或是完成了一次上下文切换</li></ul></li> <li>它会检查进程 <code>p</code> 的未被阻塞的待处理信号的集合（pending &amp;~blocked）
<ul><li>如果这个集合为空（通常情况下）
<ul><li>那么内核将控制传递到 <code>p</code> 的逻辑控制流中的下一条指令</li></ul></li> <li>然而，如果集合是非空的
<ul><li>那么内核选择集合中的某个信号 <mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="1.179ex" height="1.595ex" role="img" focusable="false" viewBox="0 -694 521 705" xmlns:xlink="http://www.w3.org/1999/xlink" style="vertical-align:-0.025ex;"><defs><path id="MJX-63-TEX-I-1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D458" xlink:href="#MJX-63-TEX-I-1D458"></use></g></g></g></svg></mjx-container> （通常是最小的 <mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="1.179ex" height="1.595ex" role="img" focusable="false" viewBox="0 -694 521 705" xmlns:xlink="http://www.w3.org/1999/xlink" style="vertical-align:-0.025ex;"><defs><path id="MJX-63-TEX-I-1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D458" xlink:href="#MJX-63-TEX-I-1D458"></use></g></g></g></svg></mjx-container>），并且强制 <mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="1.138ex" height="1.439ex" role="img" focusable="false" viewBox="0 -442 503 636" xmlns:xlink="http://www.w3.org/1999/xlink" style="vertical-align:-0.439ex;"><defs><path id="MJX-59-TEX-I-1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D45D" xlink:href="#MJX-59-TEX-I-1D45D"></use></g></g></g></svg></mjx-container> 接收信号 <mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="1.179ex" height="1.595ex" role="img" focusable="false" viewBox="0 -694 521 705" xmlns:xlink="http://www.w3.org/1999/xlink" style="vertical-align:-0.025ex;"><defs><path id="MJX-63-TEX-I-1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D458" xlink:href="#MJX-63-TEX-I-1D458"></use></g></g></g></svg></mjx-container></li> <li>收到这个信号会触发进程采取某种行为</li> <li>一旦进程完成了这个行为，那么控制就传递回 <mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="1.138ex" height="1.439ex" role="img" focusable="false" viewBox="0 -442 503 636" xmlns:xlink="http://www.w3.org/1999/xlink" style="vertical-align:-0.439ex;"><defs><path id="MJX-59-TEX-I-1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D45D" xlink:href="#MJX-59-TEX-I-1D45D"></use></g></g></g></svg></mjx-container> 的逻辑控制流中的下一条指令</li></ul></li></ul></li></ul></div> <div class="custom-block tip"><p class="custom-block-title">每个信号类型都有一个预定义的默认行为，是下面中的一种</p> <ul><li>进程终止</li> <li>进程终止并转储内存</li> <li>进程停止（挂起）直到被 <code>SIGCONT</code> 信号重启</li> <li>进程忽略该信号</li></ul></div> <div class="custom-block note"><p class="custom-block-title">进程可以通过使用 <code>signal</code> 函数修改和信号相关联的默认行为</p> <ul><li><code>SIGSTOP</code> 和 <code>SIGKILL</code>，它们的默认行为是不能修改的</li></ul> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>
<span class="token keyword">typedef</span> <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token class-name">sighandler_t</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">sighandler_t</span> <span class="token function">signal</span><span class="token punctuation">(</span><span class="token keyword">int</span> signum<span class="token punctuation">,</span> <span class="token class-name">sighandler_t</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 返回：若成功则为指向前次处理程序的指针，若出错则为 SIG_ERR（不设置 errno）</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><code>signal</code> 函数可以通过下列三种方法之一来改变和信号 <code>signum</code> 相关联的行为
<ul><li>如果 <code>handler</code> 是 <code>SIG_IGN</code>，那么忽略类型为 <code>signum</code> 的信号</li> <li>如果 <code>handler</code> 是 <code>SIG_DFL</code>，那么类型为 <code>signum</code> 的信号行为恢复为默认行为</li> <li>否则，<code>handler</code> 就是用户定义的函数的地址，这个函数被称为<strong>信号处理程序</strong> <ul><li>只要进程接收到一个类型为 <code>signum</code> 的信号，就会调用这个程序</li> <li>通过把处理程序的地址传递到 <code>signal</code> 函数从而改变默认行为，这叫做设置信号处理程序（installing the handler）</li> <li>调用信号处理程序被称为捕获信号
<ul><li>即是接收信号</li></ul></li> <li>执行信号处理程序被称为处理信号</li></ul></li></ul></li> <li>信息处理程序可以被其他信号处理程序中断
<ul><li><img src="https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20220304124612-2022-03-04-12-46-12.png" alt="20220304124612-2022-03-04-12-46-12"></li></ul></li></ul></div> <h3 id="854-阻塞和解除阻塞信号"><a href="#854-阻塞和解除阻塞信号" class="header-anchor">#</a> 8.5.4 阻塞和解除阻塞信号</h3> <div class="custom-block tip"><p class="custom-block-title">Linux 阻塞信号的隐式和显式的机制</p> <ul><li>隐式阻塞机制
<ul><li>内核默认阻塞任何当前处理程序正在处理信号类型的待处理的信号</li></ul></li> <li>显式阻塞机制
<ul><li>应用程序可以使用 <code>sigprocmask</code> 函数和它的辅助函数，明确地阻塞和解除阻塞选定的信号</li></ul></li></ul></div> <div class="custom-block note"><p class="custom-block-title"><code>sigprocmask</code> 函数及其辅助函数</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">sigprocmask</span><span class="token punctuation">(</span><span class="token keyword">int</span> how<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token class-name">sigset_t</span> <span class="token operator">*</span>set<span class="token punctuation">,</span> <span class="token class-name">sigset_t</span> <span class="token operator">*</span>oldset<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">sigemptyset</span><span class="token punctuation">(</span><span class="token class-name">sigset_t</span> <span class="token operator">*</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">sigfillset</span><span class="token punctuation">(</span><span class="token class-name">sigset_t</span> <span class="token operator">*</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">sigaddset</span><span class="token punctuation">(</span><span class="token class-name">sigset_t</span> <span class="token operator">*</span>set<span class="token punctuation">,</span> <span class="token keyword">int</span> signum<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">sigdelset</span><span class="token punctuation">(</span><span class="token class-name">sigset_t</span> <span class="token operator">*</span>set<span class="token punctuation">,</span> <span class="token keyword">int</span> signum<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//返回；如果成功则为 0，若出错则为 -1</span>

<span class="token keyword">int</span> <span class="token function">sigismember</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token class-name">sigset_t</span> <span class="token operator">*</span>set<span class="token punctuation">,</span> <span class="token keyword">int</span> signum<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 返回：若 signum 是 set 的成员则为 1，如果不是则为 0，若出错则为 -1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li><code>sigprocmask</code> 函数改变当前阻塞的信号集合（<a href="#851-%E4%BF%A1%E5%8F%B7%E6%9C%AF%E8%AF%AD">8.5.1 节中描述的 blocked 位向量</a>）
<ul><li>具体的行为依赖于 <code>how</code> 的值
<ul><li><code>SIG_BLOCK</code>：把 set 中的信号添加到 blocked 中（blocked=blocked | set）。</li> <li><code>SIG_UNBLOCK</code>：从 blocked 中删除 set 中的信号（blocked=blocked &amp;~set）。</li> <li><code>SIG_SETMASK</code>：block=set</li></ul></li> <li>如果 <code>oldset</code> 不为 <code>NULL</code>，那么 blocked 位向量之前的值保存在 <code>oldset</code> 中</li></ul></li> <li><code>sigemptyset</code> 初始化 set 为空集合</li> <li><code>sigfillset</code> 函数把每个信号都添加到 set 中</li> <li><code>sigaddset</code> 函数把 <code>signum</code> 添加到 set</li> <li><code>sigdelset</code> 从 set 中删除 <code>signum</code></li> <li>如果 <code>signum</code> 是 <code>set</code> 的成员，那么 <code>sigismember</code> 返回 <code>1</code>，否则返回 <code>0</code></li></ul></div> <h3 id="855-编写信号处理程序"><a href="#855-编写信号处理程序" class="header-anchor">#</a> 8.5.5 编写信号处理程序</h3> <div class="custom-block tip"><p class="custom-block-title">处理程序有几个属性使得它们很难推理分析</p> <ul><li>处理程序与主程序并发运行，共享同样的全局变量，因此可能与主程序和其他处理程序互相干扰</li> <li>如何以及何时接收信号的规则常常有违人的直觉</li> <li>不同的系统有不同的信号处理语义</li></ul></div> <div class="custom-block note"><p class="custom-block-title">编写安全、正确和可移植的信号处理程序的一些基本规则</p> <ul><li><div class="custom-block tip"><p class="custom-block-title">G0. 处理程序要尽可能简单</p></div></li> <li><div class="custom-block tip"><p class="custom-block-title">G1. 在处理程序中只调用异步信号安全的函数</p> <ul><li>所谓异步信号安全的函数（或简称安全的函数）能够被信号处理程序安全地调用，原因有二
<ul><li>要么它是可重入的（例如只访问局部变量，见 12.7.2 节）</li> <li>要么它不能被信号处理程序中断</li></ul></li> <li>许多常见的函数（例如 <code>printf</code>、<code>sprintf</code>、<code>malloc</code> 和 <code>exit</code>）都不在此列</li> <li><details class="custom-block details"><summary>异步信号安全的函数</summary> <ul><li><img src="https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20220304133210-2022-03-04-13-32-11.png" alt="20220304133210-2022-03-04-13-32-11"></li></ul></details></li></ul></div></li> <li><div class="custom-block tip"><p class="custom-block-title">G2. 保存和恢复 <code>errno</code></p></div></li> <li><div class="custom-block tip"><p class="custom-block-title">G3. 对共享的全局数据结构进行访问时，阻塞所有的信号</p></div></li> <li><div class="custom-block tip"><p class="custom-block-title">G4. 用  <code>volatile</code> 声明全局变量</p> <ul><li>用 <code>volatile</code> 类型限定符来定义一个变量，告诉编译器不要缓存这个变量
<ul><li>强迫编译器每次在代码中引用变量时，都要从内存中读取变量的值</li></ul></li></ul></div></li> <li><div class="custom-block tip"><p class="custom-block-title">G5. 用 <code>sig_atomic_t</code> 声明标志</p> <ul><li>在常见的处理程序设计中，处理程序会写全局标志来记录收到了信号
<ul><li>主程序周期性地读这个标志，响应信号，再清除该标志</li></ul></li> <li>C 提供一种整型数据类型 <code>sig_atomic_t</code>，对它的<strong>单个的</strong>读和写保证会是原子的（不可中断的）
<ul><li>因为可以用一条指令来实现它们</li> <li>不适用于像 <code>flag++</code> 或 <code>flag=flag+10</code> 这样的更新</li></ul></li></ul></div></li></ul></div> <div class="custom-block todo_list"><p class="custom-block-title">🔲 待做事项</p> <ul><li>补全 12.7.2 节的链接</li> <li>Shell lab
<ul><li>后台子程序回收时，使用了 <code>sprintf</code> 函数，这个需要尽量避免
<ul><li>可以考虑换用 <code>csapp.c</code> 中的函数</li></ul></li></ul></li></ul></div> <div class="custom-block tip"><p class="custom-block-title">可称植的信号处理</p> <ul><li><p>Posix 标准定义了 <code>sigaction</code> 函数，它允许用户在设置信号处理时，明确指定他们想要的信号处理语义</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">sigaction</span><span class="token punctuation">(</span><span class="token keyword">int</span> signum<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">sigaction</span> <span class="token operator">*</span>act<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">sigaction</span> <span class="token operator">*</span>oldact<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 返回：若成功则为 0，若出错则为 -1。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>借助 <code>sigaction</code> 实现的 <code>Signal</code> 包装函数</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token class-name">handler_t</span> <span class="token operator">*</span><span class="token function">Signal</span><span class="token punctuation">(</span><span class="token keyword">int</span> signum<span class="token punctuation">,</span> <span class="token class-name">handler_t</span> <span class="token operator">*</span>handler<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">struct</span> <span class="token class-name">sigaction</span> action<span class="token punctuation">,</span> old_action<span class="token punctuation">;</span>

  action<span class="token punctuation">.</span>sa_handler <span class="token operator">=</span> handler<span class="token punctuation">;</span>
  <span class="token function">sigemptyset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>action<span class="token punctuation">.</span>sa_mask<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* Block sigs of type being handled */</span>
  action<span class="token punctuation">.</span>sa_flags <span class="token operator">=</span> SA_RESTART<span class="token punctuation">;</span> <span class="token comment">/* Restart syscalls if possible */</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sigaction</span><span class="token punctuation">(</span>signum<span class="token punctuation">,</span> <span class="token operator">&amp;</span>action<span class="token punctuation">,</span> <span class="token operator">&amp;</span>old_action<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
      <span class="token function">unix_error</span><span class="token punctuation">(</span><span class="token string">&quot;Signal error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>old_action<span class="token punctuation">.</span>sa_handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>其信号处理语义如下
<ul><li>只有这个处理程序当前正在处理的那种类型的信号被阻塞</li> <li>和所有信号实现一样，信号不会排队等待</li> <li>只要可能，被中断的系统调用会自动重启</li> <li>一旦设置了信号处理程序，它就会一直保持
<ul><li>直到 <code>Signal</code> 带着 <code>handler</code> 参数为 <code>SIG_IGN</code> 或者 <code>SIG_DFL</code> 被调用</li></ul></li></ul></li></ul></li></ul></div> <h3 id="856-同步流以避免讨厌的并发错误"><a href="#856-同步流以避免讨厌的并发错误" class="header-anchor">#</a> 8.5.6 同步流以避免讨厌的并发错误</h3> <div class="custom-block warning"><p class="custom-block-title">注意子进程继承了它们父进程的被阻塞集合</p> <ul><li>所以在调用 <code>execve</code> 之前，或者调用 <code>fork</code> 之后
<ul><li>需要根据实际情况小心地解除原主进程中被阻塞的相关信号</li></ul></li></ul></div> <h3 id="857-显式地等待信号"><a href="#857-显式地等待信号" class="header-anchor">#</a> 8.5.7 显式地等待信号</h3> <div class="custom-block note"><p class="custom-block-title"><code>sigsuspend</code> 函数</p> <ul><li><p>函数原型</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">sigsuspend</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token class-name">sigset_t</span> <span class="token operator">*</span>mask<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 返回：-1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>其相当于下到语句</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token function">sigprocmask</span><span class="token punctuation">(</span>SIG_BLOCK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>mask<span class="token punctuation">,</span> <span class="token operator">&amp;</span>prev<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">sigprocmask</span><span class="token punctuation">(</span>SIG_SETMASK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>prev<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>其中，原子属性保证对 <code>sigprocmask</code>（第 1 行）和 <code>pause</code>（第 2 行）的调用总是一起发生的，不会被中断
<ul><li>这样就消除了潜在的竞争，即在调用 <code>sigprocmask</code> 之后但在调用 <code>pause</code> 之前收到了一个信号</li></ul></li></ul></li> <li><details class="custom-block details"><summary>使用示例</summary> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">/* $begin sigsuspend */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;csapp.h&quot;</span></span>

<span class="token keyword">volatile</span> <span class="token class-name">sig_atomic_t</span> pid<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">sigchld_handler</span><span class="token punctuation">(</span><span class="token keyword">int</span> s<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> olderrno <span class="token operator">=</span> errno<span class="token punctuation">;</span>
    pid <span class="token operator">=</span> <span class="token function">Waitpid</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    errno <span class="token operator">=</span> olderrno<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">sigint_handler</span><span class="token punctuation">(</span><span class="token keyword">int</span> s<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    <span class="token class-name">sigset_t</span> mask<span class="token punctuation">,</span> prev<span class="token punctuation">;</span>

    <span class="token function">Signal</span><span class="token punctuation">(</span>SIGCHLD<span class="token punctuation">,</span> sigchld_handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Signal</span><span class="token punctuation">(</span>SIGINT<span class="token punctuation">,</span> sigint_handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Sigemptyset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mask<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Sigaddset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mask<span class="token punctuation">,</span> SIGCHLD<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Sigprocmask</span><span class="token punctuation">(</span>SIG_BLOCK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>mask<span class="token punctuation">,</span> <span class="token operator">&amp;</span>prev<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* Block SIGCHLD */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">Fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">/* Child */</span>
            <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/* Wait for SIGCHLD to be received */</span>
        pid <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>pid<span class="token punctuation">)</span> 
            <span class="token function">Sigsuspend</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>prev<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/* Optionally unblock SIGCHLD */</span>
        <span class="token function">Sigprocmask</span><span class="token punctuation">(</span>SIG_SETMASK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>prev<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

        <span class="token comment">/* Do some work after receiving SIGCHLD */</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/* $end sigsuspend */</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div></details></li></ul></div> <h2 id="86-非本地跳转"><a href="#86-非本地跳转" class="header-anchor">#</a> 8.6 非本地跳转</h2> <div class="custom-block tip"><p class="custom-block-title">非本地跳转（non local jump）是一种用户级异常控制流形式</p> <ul><li>将控制直接从一个函数转移到另一个当前正在执行的函数，而不需要经过正常的调用—返回序列</li> <li>非本地跳转是通过 <code>setjmp</code> 和 <code>longjmp</code> 函数来提供的</li></ul></div> <div class="custom-block note"><p class="custom-block-title"><code>setjmp</code> 和 <code>longjmp</code></p> <ul><li><p>函数原型</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;setjmp.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">setjmp</span><span class="token punctuation">(</span>jmp_buf env<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">sigsetjmp</span><span class="token punctuation">(</span>sigjmp_buf env<span class="token punctuation">,</span> <span class="token keyword">int</span> savesigs<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">longjmp</span><span class="token punctuation">(</span>jmp_buf env<span class="token punctuation">,</span> <span class="token keyword">int</span> retval<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">siglongjmp</span><span class="token punctuation">(</span>sigjmp_buf env<span class="token punctuation">,</span> <span class="token keyword">int</span> retval<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p><code>setjmp</code> 函数在 <code>env</code> 缓冲区中保存当前调用环境，以供后面的 <code>longjmp</code> 使用，并返回 0</p> <ul><li>调用环境包括程序计数器、栈指针和通用目的寄存器</li></ul></li> <li><div class="custom-block warning"><p class="custom-block-title"><code>setjmp</code> 的返回的值不能被赋值给变量</p> <ul><li>不过它可以安全地用在 <code>switch</code> 或条件语句的测试中</li></ul></div></li> <li><p><code>longjmp</code> 函数从 <code>env</code> 缓冲区中恢复调用环境，然后触发一个从最近一次初始化 <code>env</code> 的 <code>setjmp</code> 调用的返回</p> <ul><li>然后 <code>setjmp</code> 返回，其返回值为 <code>retval</code> <ul><li><code>retval</code> 一般设置为非 0</li></ul></li></ul></li> <li><p><code>sigsetjmp</code> 和 <code>siglongjmp</code> 函数是 setjmp 和 longjmp 的可以被信号处理程序使用的版本</p> <ul><li>在 <code>siglongjmp</code> 可达的代码中，应该只调用安全的函数</li></ul></li></ul></div> <div class="custom-block tip"><p class="custom-block-title">用法示例</p> <ul><li><p>用于错误处理</p> <ul><li>如果在一个深层嵌套的函数调用中发现了一个错误情况
<ul><li>可以使用非本地跳转直接返回到一个普通的本地化的错误处理程序</li> <li>而不是费力地解开调用栈</li></ul></li> <li><details class="custom-block details"><summary>示例</summary> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">/* $begin setjmp */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;csapp.h&quot;</span></span>

jmp_buf buf<span class="token punctuation">;</span>

<span class="token keyword">int</span> error1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token keyword">int</span> error2 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token function">setjmp</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span> 
	<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> 
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Detected an error1 condition in foo\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span> 
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Detected an error2 condition in foo\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Unknown error condition in foo\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* Deeply nested function foo */</span>
<span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>error1<span class="token punctuation">)</span>
	<span class="token function">longjmp</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>error2<span class="token punctuation">)</span>
	<span class="token function">longjmp</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
<span class="token comment">/* $end setjmp */</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div></details></li></ul></li> <li><p>在信号处理中用于软重启</p> <ul><li><details class="custom-block details"><summary>示例</summary> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">/* $begin restart */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;csapp.h&quot;</span></span>

sigjmp_buf buf<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">int</span> sig<span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    <span class="token function">siglongjmp</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">sigsetjmp</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Signal</span><span class="token punctuation">(</span>SIGINT<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Sio_puts</span><span class="token punctuation">(</span><span class="token string">&quot;starting\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> 
	<span class="token function">Sio_puts</span><span class="token punctuation">(</span><span class="token string">&quot;restarting\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Sio_puts</span><span class="token punctuation">(</span><span class="token string">&quot;processing...\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* Control never reaches here */</span>
<span class="token punctuation">}</span>
<span class="token comment">/* $end restart */</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div></details></li></ul></li></ul></div> <h2 id="87-操作进程的工具"><a href="#87-操作进程的工具" class="header-anchor">#</a> 8.7 操作进程的工具</h2> <div class="custom-block note"><p class="custom-block-title">Linux 系统提供了大量的监控和操作进程的有用工具</p> <ul><li>STRACE
<ul><li>打印一个正在运行的程序和它的子进程调用的每个系统调用的轨迹</li> <li>用 <code>-static</code> 编译的程序，可以得到一个更干净的、不带有大量与共享库相关的输出的轨迹</li></ul></li> <li>PS
<ul><li>列出当前系统中的进程（包括僵死进程）</li></ul></li> <li>TOP
<ul><li>打印出关于当前进程资源使用的信息</li></ul></li> <li>PMAP
<ul><li>显示进程的内存映射</li></ul></li> <li>/proc
<ul><li>一个虚拟文件系统，以 ASCII 文本格式输出大量内核数据结构的内容，用户程序可以读取这些内容</li> <li>比如，输入 <code>cat /proc/loadavg</code>，可以看到 Linux 系统上当前的平均负载</li></ul></li></ul></div></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/sbwcwso/sbwcwso.github.io/edit/master/docs/01.基础知识/12.CSAPP/01.书本阅读/08.第 8 章 异常控制流.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/tags/?tag=csapp" title="标签">#csapp</a></div> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/c4f6e6/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">第 7 章 链接</div></a> <a href="/pages/b732ba/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">第 9 章 虚拟内存</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/c4f6e6/" class="prev">第 7 章 链接</a></span> <span class="next"><a href="/pages/b732ba/">第 9 章 虚拟内存</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/01.%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/27.%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/02.MIT6_S081%E7%BF%BB%E8%AF%91%5B%E6%90%AC%E8%BF%90%5D/"><div>MIT6_S081翻译[搬运]</div></a> <span>10-05</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/a5ff04/"><div>SUMMARY</div></a> <span>10-05</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/a0b5b4/"><div>1.1 课程内容简介</div></a> <span>10-05</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="https://github.com/sbwcwso" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2023
    <span>lijunjie9502| <a href="https://github.com/sbwcwso/note/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.095f6a1f.js" defer></script><script src="/assets/js/2.6bb19404.js" defer></script><script src="/assets/js/3.6d4bd9fe.js" defer></script><script src="/assets/js/102.7d38a1c6.js" defer></script>
  </body>
</html>